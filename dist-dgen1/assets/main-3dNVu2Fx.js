(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();class Me extends Phaser.Scene{constructor(){super({key:"LoadingScene"})}preload(){}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}this.scene.start("SplashScene")}}const J={buildType:"dgen1",canvas:{width:720,height:720},game:{tileSize:32,floorWidth:22,floorSpacing:140,gravity:800,jumpVelocity:-350},scoring:{coinCollect:50},platform:{saveInterval:3e4}},R={canvas:{width:450,height:800},game:{tileSize:32,gravity:800,playerSpeed:160,climbSpeed:120,jumpVelocity:-350}},p=J;console.log("📐 Loading dgen1 settings (720x720)");class Pe extends Phaser.Scene{titleImage;transitionComplete=!1;constructor(){super({key:"SplashScene"})}preload(){this.registry.get("isDgen1")||window.location.port==="3001"?(console.log("🎮 Loading dgen1 splash (720x720)"),this.load.image("titleBackground","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/splash%20page%20dgen1-Fh7ukfdeGjMSeC55Peq00Ip9l8GzhI.png?d0YY")):(console.log("🎮 Loading regular splash (800x800)"),this.load.image("titleBackground","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/TREASURE%20QUEST%20Bizarre%20Beasts%20BIZarcade%20splash%20page-ydgNu2S0haL0dzmlz4oZLjqZMXaiQo.png?j2A1")),this.load.audio("splash-sound","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/splash%20page%20sfx-2Un9YwdWUGtqQ3ynYGocaBKgQmQTmD.wav?X7j7"),this.load.on("loaderror",t=>{console.error("❌ Failed to load:",t.key,"- CORS or network issue"),t.key==="splash-sound"&&this.registry.set("audioLoadFailed",!0)}),console.log("🎮 SplashScene: Loading title background and sound")}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}if(this.setupAudioUnlock(),this.registry.get("sfxEnabled")!==!1)try{this.sound.play("splash-sound",{volume:.5})}catch{console.log("🔇 Splash sound blocked - will play after user interaction")}this.setupTitleBackground(),this.startTimer()}setupAudioUnlock(){let e=!1;const t=()=>{if(!e&&(e=!0,console.log("🔊 Attempting to unlock audio context..."),this.sound.context)){if(console.log("🔊 Audio context state:",this.sound.context.state),this.sound.context.state==="suspended")this.sound.context.resume().then(()=>{console.log("✅ Audio context successfully resumed!");const o=this.sound.context,l=o.createBuffer(1,1,22050),r=o.createBufferSource();r.buffer=l,r.connect(o.destination),r.start(0),console.log("✅ Played empty buffer to unlock iOS audio");try{const c=this.sound.add("splash-sound",{volume:.001});c.play(),c.once("complete",()=>{c.destroy(),console.log("✅ Audio fully unlocked with silent sound")})}catch(c){console.log("⚠️ Could not play silent sound:",c)}this.registry.get("sfxEnabled")!==!1&&!this.registry.get("splashSoundPlayed")&&setTimeout(()=>{try{this.sound.play("splash-sound",{volume:.5}),this.registry.set("splashSoundPlayed",!0),console.log("✅ Splash sound played after unlock")}catch(c){console.log("⚠️ Could not play splash sound:",c)}},100)}).catch(o=>{console.error("❌ Failed to resume audio context:",o)});else if(this.sound.context.state==="running"){console.log("✅ Audio context already running");try{const o=this.sound.context,l=o.createBuffer(1,1,22050),r=o.createBufferSource();r.buffer=l,r.connect(o.destination),r.start(0),console.log("✅ Played empty buffer for iOS compatibility")}catch(o){console.log("⚠️ Could not play empty buffer:",o)}}}};this.input.on("pointerdown",t),this.input.on("pointerup",t);const s=this.add.zone(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height);s.setInteractive(),s.on("pointerdown",t),s.on("pointerup",t);const i=this.sys.canvas,a=o=>{t(),i.removeEventListener("touchstart",a),i.removeEventListener("touchend",a),i.removeEventListener("mousedown",a)};i.addEventListener("touchstart",a,{passive:!0}),i.addEventListener("touchend",a,{passive:!0}),i.addEventListener("mousedown",a,{passive:!0}),this.sys.game.device.input.touch&&this.input.addPointer(2)}setupTitleBackground(){const e=p.canvas.width,t=p.canvas.height;this.titleImage=this.add.image(e/2,t/2,"titleBackground"),this.titleImage.setDepth(0);const s=e/this.titleImage.width,i=t/this.titleImage.height,a=Math.max(s,i);this.titleImage.setScale(a),console.log("🎮 SplashScene: Title background positioned and scaled")}startTimer(){console.log("🎮 SplashScene: Starting 2-second timer"),this.time.delayedCall(2e3,()=>{this.transitionToGame()})}transitionToGame(){this.transitionComplete||(this.transitionComplete=!0,console.log("🎮 SplashScene: Auto-transitioning to instructions after 2 seconds"),this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("InstructionsScene")}))}update(){}}class ${static preloadedAssets=new Set;static loadingAssets=new Set;static markAsPreloaded(e){this.preloadedAssets.add(e),this.loadingAssets.delete(e),console.log(`✅ Asset preloaded: ${e}`)}static markAsLoading(e){this.loadingAssets.add(e)}static isPreloaded(e){return this.preloadedAssets.has(e)}static isLoading(e){return this.loadingAssets.has(e)}static getPreloadedCount(){return this.preloadedAssets.size}static clear(){this.preloadedAssets.clear(),this.loadingAssets.clear()}static getCriticalAssets(){return[{key:"visibilityOverlay",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO",type:"image"},{key:"background-treasure-quest-5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1",type:"image"},{key:"playerIdleEye1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%201-p01pa3z9fL9AyLQolMuYyBO3DIqgvB.png?FaaG",type:"image"},{key:"playerIdleEye2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%202-ngx0e1EF33iY14vRpcSvy8QOUjMKnl.png?lsFE",type:"image"},{key:"floor-tile-1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt",type:"image"},{key:"floor-tile-2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%202-EuITFMsdSDebMUmfcikeKCDLqDupml.png?C2mi",type:"image"},{key:"floor-tile-3",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%203-EBjnmTXXufdUFEuzmfnGnaZX4zdI2C.png?69bT",type:"image"},{key:"doorClosed",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U",type:"image"},{key:"tealLadder",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/new%20ladder-ULDbdT9I4h8apxhpJI6WT1PzmaMzLo.png?okOd",type:"image"},{key:"gem-collect",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/regular%20gem%20collect%20sfx-OXLLrrAXWUz21oDTEuQPFb2fxRWxXh.wav?pH1V",type:"audio"},{key:"jump-1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%201%20sfx-Cfx219m2NwhVClkP67iebiwcV0HiF5.wav?GDjY",type:"audio"}]}static getSecondaryAssets(){return[{key:"playerRunLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/running%20body%20eyes%20looking%20left%20foot%20forward-5O5kkQBPD5v2vMJvsBZrCmvWqE5PkV.png?z5EH",type:"image"},{key:"playerRunRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/running%20body%20eyes%20looking%20right%20foot%20forward-7xJdHJFy5Q9V4EhFXVqXRZo1hxKA1z.png?jd5P",type:"image"},{key:"blueCat",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed-HUXqx9HBdotEhJE2LBgzK8Z4kA7e2H.png?AVKZ",type:"image"},{key:"floor-tile-4",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%204-ecTwalLp4rzl9hegwIwVMuDBeN1YVJ.png?nxJJ",type:"image"}]}}class ae{static generatedScreens=new Map;static generateLoadingScreen(e,t){const s=`loading-screen-${t}`;if(e.textures.exists(s))return s;const i=e.cameras.main.width,a=e.cameras.main.height,o=e.add.renderTexture(0,0,i,a);o.setOrigin(0,0),o.fill(3023688);const l=i/2,r=a/2,n=e.add.text(l,r,"LOADING...",{fontSize:"24px",fontFamily:"Arial, sans-serif",color:"#FFFFFF",fontStyle:"bold"});return n.setOrigin(.5),o.draw(n),o.saveTexture(s),n.destroy(),o.destroy(),this.generatedScreens.set(s,"LOADING..."),console.log(`✨ Generated loading screen: ${s}`),s}static preGenerateAll(e){[1,11,21,31,41,51].forEach(s=>{this.generateLoadingScreen(e,s)})}static getLoadingScreenKey(e){return e>=51?"loading-screen-51":e>=41?"loading-screen-41":e>=31?"loading-screen-31":e>=21?"loading-screen-21":e>=11?"loading-screen-11":"loading-screen-1"}static showInstantLoadingScreen(e,t){const s=this.getLoadingScreenKey(t),i=e.add.image(e.cameras.main.centerX,e.cameras.main.centerY,s);return i.setOrigin(.5),i.setDepth(1e5),i.setScrollFactor(0),console.log(`⚡ Instant loading screen displayed: ${s}`),i}}class Be extends Phaser.Scene{bgImage;scrollContainer;maskGraphics;skipButton;scrollIndicator;titleText;scrollY=0;maxScrollY=0;contentHeight=0;isDragging=!1;dragStartY=0;scrollStartY=0;fromMenu=!1;reopenMenu=!1;constructor(){super({key:"InstructionsScene"})}init(e){this.fromMenu=e?.fromMenu||!1,this.reopenMenu=e?.reopenMenu||!1}preload(){this.load.image("instructionsBg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1"),this.loadGameSprites()}loadGameSprites(){this.load.image("playerIdleEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%201-aD6V48lNdWK5R1x5CPNs4XLX869cmI.png?0XJy"),this.load.image("playerJumpRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20right%20foot%20forward-3clf2KnwfbN3O6BsrtaeHSTAviNbnF.png?xx8e"),this.load.image("playerClimbInstructions","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20instructions%20sprite-1DYkU3H7zBfBhzSDEkjgUSCrDXYBRW.png?v0Zt"),this.load.image("playerThrowingGem","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%20throwing%20gem-7trW3lxLa5cH2ASj5SX3nkwO6dDh6z.png?uNG0"),this.load.image("playerBothFeetDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/both%20feet%20down-Df4cKPxtG04wJmnzY3QzaUeW22F1BN.png?Iekl"),this.load.image("crystal-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20hud%20icon-6cCEP7jp90eqI7W9LeBp7v4s3OgCPX.png?nMJm"),this.load.image("blueCoin","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem-GzKKZKUsDMh3CXMEIV4OmMl4ksrqqm.png?sill"),this.load.image("diamond","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond-LB22Ijoji8erIrMFMvtSwd5Y9rDDwS.png?LlEv"),this.load.image("crystalBallCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("cursedOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb-rHogWhnYUk2xThrTWajfHqMSfxeyfd.png?0wr6"),this.load.image("tealOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb-wupZvLrfiaRIZZyP4TbIOq5HLiVsXz.png?i2qV"),this.load.image("pendant","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pendant-cJISby3d7EEREasbi0gRZkn2u3rNrG.png?xf9m"),this.load.image("heart-crystal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/free%20life%20heart%20crystal-2EJMsIvSQKzdgrqytakBZcDbGf7Jpf.png?E1JG"),this.load.image("yellow-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20chest-QMRMmVk9i7S0qkLteaXfhjqQBI351B.png?sE5u"),this.load.image("blueEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20mid%20mouth-OvzgXzA7k4tlCopnJB6tiD0RqjATsS.png"),this.load.image("yellowEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillars%20for%20instructions-kZxgRN7GYjkDNz2YNyG01YlnoFmwHl.png"),this.load.image("redEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%201-RKF3p3F7fxdBSfen8UD9UGqIzf8zlv.png?xRpM"),this.load.image("greenEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20for%20instructions-id5JdSwy2HEqrh3atcd89xIimkk8fI.png"),this.load.image("stalkerEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%201-Xt3Vtu2FiWWLT9l2wfeakBAqVSZet8.png?gS6O"),this.load.image("beetle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2070-gToASj29g9XTDxUDHBKXDOfpYOKudu.png?uZh3"),this.load.image("rexEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20for%20instructions-nQEFZF5vjHMbWTsA9J6aVk3eAFyBDt.png"),this.load.image("baseblue-eyes-center","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20center-BWjYc09iCwYsTuEB3TEsa7GdmDc4Nj.png?NZtQ"),this.load.image("ladderInstructions","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/ladder%20for%20instructions-G7U9VNDZ8e7krygwL64remh9sNOppw.png?i8q2"),this.load.image("floor-tile-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt"),this.load.image("pink-floor-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20spikes%20floor%20tile-ncAVgIHazwYlznCBP4H6LWLiIhN7OF.png?n27v"),this.load.image("yellow-ceiling-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20spikes%20ceiling%20tile-8vq9W1Y2e1RSpgUfMl9sTp0ZILFHL3.png?mUEb"),this.load.image("doorClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U")}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}this.setupBackground(),this.createTitle(),this.createScrollableContainer(),this.createInstructionCategories(),this.createSkipButton(),this.createScrollIndicator(),this.setupScrolling(),this.generateLoadingScreens(),this.startBackgroundPreload()}setupBackground(){const e=p.canvas.width,t=p.canvas.height;this.bgImage=this.add.image(e/2,t/2,"instructionsBg"),this.bgImage.setDepth(0);const s=e/this.bgImage.width,i=t/this.bgImage.height,a=Math.max(s,i);this.bgImage.setScale(a)}createTitle(){const e=p.canvas.width;this.titleText=this.add.text(e/2,60,"HOW TO PLAY",{fontSize:"28px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",stroke:"#000000",strokeThickness:3}),this.titleText.setOrigin(.5,.5),this.titleText.setDepth(100);const t=this.add.graphics();t.fillStyle(4915330,.6),t.lineStyle(2,16711935);const s=this.titleText.getBounds();t.fillRoundedRect(s.x-20,s.y-10,s.width+40,s.height+20,10),t.strokeRoundedRect(s.x-20,s.y-10,s.width+40,s.height+20,10),t.setDepth(99)}createScrollableContainer(){const e=p.canvas.width,t=p.canvas.height,s=this.add.graphics();s.fillStyle(4915330,.6),s.lineStyle(2,16711935),s.fillRoundedRect(20,100,e-40,t-200,15),s.strokeRoundedRect(20,100,e-40,t-200,15),s.setDepth(5),this.scrollContainer=this.add.container(0,0),this.scrollContainer.setDepth(10),this.maskGraphics=this.add.graphics(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(20,100,e-40,t-200),this.maskGraphics.setVisible(!1);const i=this.maskGraphics.createGeometryMask();this.scrollContainer.setMask(i)}createInstructionCategories(){let e=120;[{title:"MOVEMENT & CONTROLS",items:[{sprite:"playerIdleEye1",title:"Move",description:"Use WASD/arrow keys or pink crystal D-pad to move",spriteSize:{width:38,height:58}},{sprite:"playerJumpRightFoot",title:"Jump",description:"Press SPACE or E to jump (or use pink crystal button)",spriteSize:{width:38,height:58}},{sprite:"playerClimbInstructions",title:"Climb",description:"Use UP/DOWN arrows or D-pad to climb ladders",spriteSize:{width:38,height:58}},{sprite:"playerThrow",title:"Throw",description:"Press Q, V, or M to throw crystal balls (use yellow crystal button)",spriteSize:{width:38,height:58}}]},{title:"COLLECTIBLES",items:[{sprite:"crystal-hud-icon",title:"Gems",description:"Collect for 50 points each. 150 gems = free life",spriteSize:{width:45,height:45}},{sprite:"blueCoin",title:"Blue Gems",description:"Rare gems worth 500 points each",spriteSize:{width:40,height:40}},{sprite:"diamond",title:"Diamonds",description:"Valuable gems worth 1000 points each",spriteSize:{width:35,height:35}},{sprite:"heart-crystal",title:"Heart Crystal",description:"Gain an extra life worth 2000 points",spriteSize:{width:35,height:35}},{sprite:"yellow-chest",title:"Treasure Chest",description:"Contains random rewards (2500 points + items)",spriteSize:{width:48,height:48}}]},{title:"POWER-UPS & CURSES",items:[{sprite:"pendant",title:"Pendant",description:"Power-up: Invincibility for 10 seconds",spriteSize:{width:40,height:40}},{sprite:"crystalBallCollectible",title:"Crystal Ball",description:"Power-up: Throw crystal balls for 20 seconds",spriteSize:{width:40,height:40}},{sprite:"cursedOrbCollectible",title:"Cursed Orb",description:"Curse: Darkness effect for 10 seconds",spriteSize:{width:40,height:40}},{sprite:"tealOrbCollectible",title:"Teal Orb",description:"Curse: Controls reversed for 10 seconds",spriteSize:{width:40,height:40}}]},{title:"ENEMIES",items:[{sprite:"yellowEnemy",title:"Caterpillar",description:"Slow random movement (50 points)",spriteSize:{width:58,height:58}},{sprite:"beetle",title:"Rollz",description:"Simple patrol enemy (75 points)",spriteSize:{width:54,height:54}},{sprite:"blueEnemy",title:"Chomper",description:"Standard patrol enemy (100 points)",spriteSize:{width:58,height:58}},{sprite:"redEnemy",title:"Snail",description:"Faster patrol movement (150 points)",spriteSize:{width:58,height:58}},{sprite:"greenEnemy",title:"Bouncer",description:"Fast bouncing movement (200 points)",spriteSize:{width:58,height:58}},{sprite:"stalkerEnemy",title:"Stalker",description:"Activates and chases you (300 points)",spriteSize:{width:58,height:58}},{sprite:"rexEnemy",title:"Rex",description:"Slow moving, nervous flipping jumper (500 points)",spriteSize:{width:58,height:58}},{sprite:"baseblue-eyes-center",title:"Blu",description:"Immovable blocker (1000 points when invincible)",spriteSize:{width:58,height:58}}]},{title:"ENVIRONMENT & HAZARDS",items:[{sprite:"ladderInstructions",title:"Ladders",description:"Climb up and down between floors",spriteSize:{width:48,height:72}},{sprite:"floor-tile-1",title:"Platforms",description:"Solid ground you can walk and jump on",spriteSize:{width:38,height:38}},{sprite:"pink-floor-spike-tile",title:"Floor Spikes",description:"Sharp floor hazards that damage you",spriteSize:{width:38,height:38}},{sprite:"yellow-ceiling-spike-tile",title:"Ceiling Spikes",description:"Sharp ceiling hazards that damage you",spriteSize:{width:38,height:38}},{sprite:"doorClosed",title:"Exit Door",description:"Press UP at the door to complete the level",spriteSize:{width:36,height:48}}]}].forEach(s=>{e=this.createCategory(s.title,s.items,e),e+=40}),this.contentHeight=e,this.maxScrollY=Math.max(0,this.contentHeight-(p.canvas.height-200))}createCategory(e,t,s){const i=p.canvas.width;let a=s;const o=this.add.text(i/2,a+20,e,{fontSize:"15px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFF00",fontStyle:"bold"});return o.setOrigin(.5,.5),this.scrollContainer.add(o),a+=60,t.forEach(l=>{a=this.createInstructionItem(l,a),a+=10}),a}createInstructionItem(e,t){const s=p.canvas.width,i=this.add.graphics();i.fillStyle(32896,.7),i.lineStyle(2,2142890);const a=e.sprite==="playerThrow"?130:110;if(i.fillRoundedRect(60,t,s-120,a,10),i.strokeRoundedRect(60,t,s-120,a,10),this.scrollContainer.add(i),e.sprite==="playerThrow"){if(this.textures.exists("playerThrowingGem")&&this.textures.exists("playerBothFeetDown")){const h=this.add.container(100,t+60),d=this.add.image(0,0,"playerBothFeetDown");d.setDisplaySize(e.spriteSize.width,e.spriteSize.height),h.add(d);const u=this.add.image(0,0,"playerThrowingGem");u.setDisplaySize(e.spriteSize.width,e.spriteSize.height),h.add(u),this.scrollContainer.add(h)}}else if(this.textures.exists(e.sprite)){const h=this.add.image(100,t+55,e.sprite);e.sprite==="pink-floor-spike-tile"?(h.setCrop(0,1,h.width,h.height-1),h.setDisplaySize(e.spriteSize.width,e.spriteSize.height-1)):e.sprite==="yellow-ceiling-spike-tile"?(h.setCrop(0,0,h.width,h.height-1),h.setDisplaySize(e.spriteSize.width,e.spriteSize.height-1)):h.setDisplaySize(e.spriteSize.width,e.spriteSize.height),this.scrollContainer.add(h)}const o=e.sprite==="playerThrow"?t+25:t+20,l=this.add.text(140,o,e.title,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",fontStyle:"bold"});l.setOrigin(0,.5),this.scrollContainer.add(l);const r=e.sprite==="playerThrow"?t+75:t+65,n=this.add.text(140,r,e.description,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFFFF",wordWrap:{width:s-200},lineSpacing:4});return n.setOrigin(0,.5),this.scrollContainer.add(n),e.sprite==="playerThrow"?t+140:t+120}createSkipButton(){const e=p.canvas.width,t=p.canvas.height;this.skipButton=this.add.container(e-80,t-50),this.skipButton.setDepth(101);const s=this.add.graphics();s.fillStyle(3329330,.9),s.lineStyle(2,16766720),s.fillRoundedRect(-60,-20,120,40,8),s.strokeRoundedRect(-60,-20,120,40,8),this.skipButton.add(s);const i=this.fromMenu?"CLOSE":"SKIP ALL",a=this.add.text(0,0,i,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#000000",fontStyle:"bold"});a.setOrigin(.5,.5),this.skipButton.add(a),this.skipButton.setSize(120,40),this.skipButton.setInteractive(),this.skipButton.on("pointerdown",()=>{console.log("🎮 InstructionsScene: Skip requested"),this.transitionToGame()}),this.skipButton.on("pointerover",()=>{s.clear(),s.fillStyle(3329330,1),s.lineStyle(3,16766720),s.fillRoundedRect(-60,-20,120,40,8),s.strokeRoundedRect(-60,-20,120,40,8)}),this.skipButton.on("pointerout",()=>{s.clear(),s.fillStyle(3329330,.9),s.lineStyle(2,16766720),s.fillRoundedRect(-60,-20,120,40,8),s.strokeRoundedRect(-60,-20,120,40,8)})}createScrollIndicator(){const e=p.canvas.height;this.scrollIndicator=this.add.container(p.canvas.width-20,e/2),this.scrollIndicator.setDepth(101);const t=this.add.graphics();t.fillStyle(0,.7),t.fillRoundedRect(-8,-155,16,310,8),this.scrollIndicator.add(t);const s=this.add.graphics();s.lineStyle(2,16766720,1),s.fillStyle(4915330,.8),s.fillRoundedRect(-7,-153,14,306,7),s.strokeRoundedRect(-7,-153,14,306,7),this.scrollIndicator.add(s);const i=this.add.graphics();i.fillStyle(16766720,.3),i.fillRoundedRect(-8,-25,16,50,8),this.scrollIndicator.add(i);const a=this.add.graphics();a.lineStyle(2,16777215,1),a.fillStyle(16766720,1),a.fillRoundedRect(-6,-22,12,44,6),a.strokeRoundedRect(-6,-22,12,44,6),this.scrollIndicator.add(a);const o=this.add.text(0,-165,"▲",{fontSize:"12px",color:"#FFD700"}).setOrigin(.5);this.scrollIndicator.add(o);const l=this.add.text(0,165,"▼",{fontSize:"12px",color:"#FFD700"}).setOrigin(.5);this.scrollIndicator.add(l),this.tweens.add({targets:[i,a],scaleX:1.2,scaleY:1.1,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.updateScrollIndicator()}setupScrolling(){this.input.on("wheel",(e,t,s,i)=>{this.scrollY+=i*.5,this.scrollY=Phaser.Math.Clamp(this.scrollY,0,this.maxScrollY),this.updateScrollPosition()}),this.input.on("pointerdown",e=>{this.isDragging=!0,this.dragStartY=e.y,this.scrollStartY=this.scrollY}),this.input.on("pointermove",e=>{if(this.isDragging){const t=this.dragStartY-e.y;this.scrollY=this.scrollStartY+t,this.scrollY=Phaser.Math.Clamp(this.scrollY,0,this.maxScrollY),this.updateScrollPosition()}}),this.input.on("pointerup",()=>{this.isDragging=!1})}updateScrollPosition(){this.scrollContainer.y=-this.scrollY,this.updateScrollIndicator()}updateScrollIndicator(){if(this.maxScrollY>0){const e=this.scrollY/this.maxScrollY,t=(e-.5)*260,s=this.scrollIndicator.list[2],i=this.scrollIndicator.list[3];s.y=t,i.y=t;const a=this.scrollIndicator.list[4],o=this.scrollIndicator.list[5];a.setAlpha(e>0?.5:1),o.setAlpha(e<1?1:.5),this.scrollIndicator.setVisible(!0)}else this.scrollIndicator.setVisible(!1)}transitionToGame(){const e=this.registry.get("currentLevel")||1;ae.showInstantLoadingScreen(this,e),this.cameras.main.fadeOut(100,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{if(this.fromMenu&&this.reopenMenu){this.scene.stop("InstructionsScene"),this.scene.wake("GameScene");const t=this.scene.get("GameScene");t&&t.menuOverlay&&t.menuOverlay.container.setVisible(!0)}else this.scene.start("GameScene")})}generateLoadingScreens(){console.log("🎨 Pre-generating loading screens for instant display");const e=this.registry.get("currentLevel")||1;ae.generateLoadingScreen(this,e),e%10>=8&&ae.generateLoadingScreen(this,e+10)}startBackgroundPreload(){console.log("🔄 Starting background preload of GameScene assets");const e=$.getCriticalAssets(),t=$.getSecondaryAssets(),s=[...e,...t];let i=0;if(s.forEach(a=>{a.type==="image"&&!this.textures.exists(a.key)?(this.load.image(a.key,a.url),$.markAsLoading(a.key),i++):a.type==="audio"&&!this.cache.audio.exists(a.key)&&(this.load.audio(a.key,a.url),$.markAsLoading(a.key),i++)}),i===0){console.log("✅ All assets already loaded");return}console.log(`📦 Queued ${i} assets for background loading`),this.load.on("progress",a=>{const o=Math.round(a*100);console.log(`⏳ Background preload progress: ${o}%`)}),this.load.on("filecomplete",a=>{$.markAsPreloaded(a)}),this.load.on("complete",()=>{const a=$.getPreloadedCount();console.log(`✅ Background preload complete! ${a} assets ready for GameScene`)}),this.load.on("loaderror",a=>{console.warn(`⚠️ Failed to preload: ${a.key} - will retry in GameScene`)}),this.load.start()}update(){}}class Ee extends Phaser.Physics.Arcade.Sprite{cursors;isClimbing=!1;currentLadder=null;nearbyLadder=null;currentJumpSound=1;touchControls=null;walkAnimationTimer=0;climbAnimationTimer=0;footstepTimer=0;FOOTSTEP_INTERVAL=300;idleAnimationTimer=0;currentFrame="idle";currentIdleState="eye1";currentClimbFoot="left";isMoving=!1;isJumping=!1;runningTiltTimer=0;lastFrameWasJump=!1;jumpButtonDown=!1;jumpHoldTime=0;isAirborne=!1;jumpReleased=!1;MIN_JUMP_VELOCITY=-120;MAX_JUMP_VELOCITY=R.game.jumpVelocity;MAX_JUMP_HOLD_TIME=300;speedMultiplier=1;crystalBallActive=!1;crystalBallTimer=0;CRYSTAL_BALL_DURATION=2e4;crystalBallParticles=[];crystalBallParticleTimer;crystalBallGlow;crystalBallWarningPlayed=!1;cursedOrbActive=!1;cursedOrbTimer=0;CURSED_ORB_DURATION=1e4;cursedOrbParticles=[];cursedOrbParticleTimer;cursedOrbGlow;cursedOrbWarningPlayed=!1;cursedTealOrbActive=!1;cursedTealOrbTimer=0;CURSED_TEAL_ORB_DURATION=1e4;cursedTealOrbParticles=[];cursedTealOrbParticleTimer;cursedTealOrbGlow;cursedTealOrbWarningPlayed=!1;idleTimer=0;IDLE_THRESHOLD=5e3;bubbleActive=!1;onBubbleTrigger=null;onMovementStart=null;longIdleTimer=0;LONG_IDLE_THRESHOLD=3e4;isPlayingLongIdle=!1;longIdleFrame="left";longIdleAnimationTimer=0;runBodySprite=null;runLegsSprite=null;useTwoLayerRunning=!0;currentLegFrame="bothDown";legAnimationStep=0;bodyAnimationTimer=0;legAnimationTimer=0;runningEyeTimer=0;currentRunningEye="playerRunBody";isFiringProjectile=!1;constructor(e,t,s){const i=e.textures.exists("playerIdleEye1")?"playerIdleEye1":"player";if(!e.textures.exists("playerIdleEye1")){const a=e.add.graphics();a.fillStyle(65280,1),a.fillRect(0,0,24,32),a.generateTexture("player",24,32),a.destroy()}super(e,t,s,i),e.add.existing(this),e.physics.add.existing(this),(i==="playerIdleEye1"||i.startsWith("player"))&&this.setDisplaySize(48,64),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(18,49),this.setOffset(15,12),this.setDepth(20),this.initializeTwoLayerRunning(e,t,s),this.cursors=e.input.keyboard.createCursorKeys(),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE)}setTouchControls(e){this.touchControls=e}setBubbleTriggerCallback(e){this.onBubbleTrigger=e}setMovementStartCallback(e){this.onMovementStart=e}initializeTwoLayerRunning(e,t,s){if(e.textures.exists("playerRunBody")&&e.textures.exists("playerRunLegsBothDown")&&this.useTwoLayerRunning){const a=t,o=s;this.runBodySprite=e.add.image(a,o,"playerRunBody"),this.runBodySprite.setDisplaySize(48,64),this.runBodySprite.setDepth(21),this.runBodySprite.setVisible(!1),this.runLegsSprite=e.add.image(a,o,"playerRunLegsBothDown"),this.runLegsSprite.setDisplaySize(48,64),this.runLegsSprite.setDepth(19),this.runLegsSprite.setVisible(!1),this.currentLegFrame="bothDown",this.legAnimationStep=0}else this.useTwoLayerRunning=!1}updateTwoLayerPosition(){this.runBodySprite&&this.runLegsSprite&&this.runBodySprite.visible&&((this.runBodySprite.x!==this.x||this.runBodySprite.y!==this.y)&&(this.runBodySprite.x=this.x,this.runBodySprite.y=this.y,this.runLegsSprite.x=this.x,this.runLegsSprite.y=this.y),this.runBodySprite.flipX!==this.flipX&&(this.runBodySprite.setFlipX(this.flipX),this.runLegsSprite.setFlipX(this.flipX)))}showTwoLayerRunning(e){this.useTwoLayerRunning&&this.runBodySprite&&this.runLegsSprite&&(this.runBodySprite.setVisible(e),this.runLegsSprite.setVisible(e),this.setVisible(!e))}updateLegAnimation(){if(!this.runLegsSprite||!this.useTwoLayerRunning)return;const t=["bothDown","leftMid","leftHigh","leftMid","bothDown","rightMid","rightHigh","rightMid"][this.legAnimationStep];this.currentLegFrame=t;const s={bothDown:"playerRunLegsBothDown",leftMid:"playerRunLegsLeftMid",leftHigh:"playerRunLegsLeftHigh",rightMid:"playerRunLegsRightMid",rightHigh:"playerRunLegsRightHigh"};this.runLegsSprite.setTexture(s[t]),this.legAnimationStep=(this.legAnimationStep+1)%8}updateBodyExpression(){if(!this.runBodySprite||!this.useTwoLayerRunning)return;if(this.isFiringProjectile){this.runBodySprite.setTexture("playerRunBodyEyes7");return}const e=Math.random();if(e<.05)this.runBodySprite.setTexture("playerRunBodyBlink"),this.scene.time.delayedCall(100,()=>{this.runBodySprite&&!this.isFiringProjectile&&this.runBodySprite.setTexture(this.currentRunningEye)});else if(e<.8){const t=["playerRunBody","playerRunBodyEyes2","playerRunBodyEyes3","playerRunBodyEyes4","playerRunBodyEyes5","playerRunBodyEyes6"],s=Phaser.Utils.Array.GetRandom(t);this.currentRunningEye=s,this.runBodySprite.setTexture(s)}}notifyBubbleActive(e){this.bubbleActive=e,e&&(this.idleTimer=0)}debugLogTimer=0;update(e,t){if(!this.body)return;const s=this.scene;if(s.isGameOver)return;this.debugLogTimer+=t,this.debugLogTimer>2e3&&(this.debugLogTimer=0);const i=600;this.body.velocity.y>i&&this.setVelocityY(i);const a=s.isLevelStarting||!1,o=R.canvas.height-R.game.tileSize-10;if(this.y>o&&!this.isClimbing&&!a&&(this.y=o,this.setVelocityY(0),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.blocked.down=!0)),this.body.velocity.y>0&&!this.isClimbing&&!a&&this.y+this.body.velocity.y*t/1e3>o){const I=(o-this.y)*1e3/t;this.setVelocityY(Math.max(0,I))}const l=this.body.blocked.down,r=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),n=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),c=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),h=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),d=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),u=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),g=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),b=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.V),y=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M),f=this.cursedTealOrbActive,m=this.cursors.left.isDown||c.isDown||this.touchControls?.leftPressed||!1,S=this.cursors.right.isDown||d.isDown||this.touchControls?.rightPressed||!1,v=this.cursors.up.isDown||n.isDown||this.touchControls?.upPressed||!1,k=this.cursors.down.isDown||h.isDown||this.touchControls?.downPressed||!1,x=f?S:m,T=f?m:S,M=f?k:v,w=f?v:k,P=Phaser.Input.Keyboard.JustDown(r)||Phaser.Input.Keyboard.JustDown(u)||this.touchControls?.isJumpJustPressed()||!1,E=r.isDown||u.isDown||this.touchControls?.jumpPressed||!1,B=Phaser.Input.Keyboard.JustDown(g)||Phaser.Input.Keyboard.JustDown(b)||Phaser.Input.Keyboard.JustDown(y)||this.touchControls?.isActionJustPressed()||!1;this.isMoving=(x||T)&&!this.isClimbing;const L=this.isJumping;if(this.isJumping=!l&&Math.abs(this.body.velocity.y)>10&&!this.isClimbing,L&&(l||this.isClimbing)&&(this.isJumping=!1),!this.isClimbing){const j=R.game.playerSpeed*this.speedMultiplier;x?(this.setVelocityX(-j),this.setFlipX(!0)):T?(this.setVelocityX(j),this.setFlipX(!1)):this.setVelocityX(0);let I=(this.nearbyLadder!==null||this.currentLadder!==null)&&M;this.isClimbing&&(I=!0);const A=!this.body.velocity.y||this.body.velocity.y>-100;if(P&&l&&!this.isAirborne&&!I&&!this.isClimbing&&A){this.jumpButtonDown=!0,this.jumpHoldTime=0,this.isAirborne=!0,this.jumpReleased=!1;const H=this.touchControls?.jumpPressed||!1,G=-150;this.setVelocityY(G),this.playJumpSound(),console.log(`[${H?"TOUCH":"KEYBOARD"}] Jump started - Initial velocity: ${G}, Target max: ${this.MAX_JUMP_VELOCITY}`),this.triggerHapticFeedback()}if(this.isAirborne&&this.jumpButtonDown&&!this.jumpReleased){if(E){if(this.jumpHoldTime+=t,this.jumpHoldTime<this.MAX_JUMP_HOLD_TIME&&this.body?.velocity.y<0){const G=1-Math.min(this.jumpHoldTime/this.MAX_JUMP_HOLD_TIME,1);this.touchControls?.jumpPressed;const V=t/1e3,se=-1600*G*V,N=this.body.velocity.y,Z=Math.max(N+se,this.MAX_JUMP_VELOCITY);this.setVelocityY(Z)}}else if(this.jumpButtonDown=!1,this.jumpReleased=!0,this.body.velocity.y<0){const H=this.body.velocity.y<-250?.85:.92;this.setVelocityY(this.body.velocity.y*H)}}if(l&&this.isAirborne&&this.body?.velocity.y>=0){const H=this.touchControls?.jumpPressed?"TOUCH":"KEYBOARD",G=this.jumpHoldTime;console.log(`[${H}] Jump completed - Total hold time: ${G.toFixed(0)}ms`),this.isAirborne=!1,this.jumpButtonDown=!1,this.jumpReleased=!1,this.jumpHoldTime=0,this.triggerHapticFeedback()}}if(this.isClimbing&&this.currentLadder){this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setAllowGravity(!1),this.setVelocityX(0);const j=this.currentLadder,X=j.y+j.height/2,I=this.y>=X-10;this.y>X-10&&(this.y=X-10,this.setVelocityY(0));let A=!1;if(M){const V=R.game.climbSpeed*this.speedMultiplier;this.setVelocityY(-V),A=!0}else if(w&&!I){const V=R.game.climbSpeed*this.speedMultiplier;this.setVelocityY(V),A=!0}else this.setVelocityY(0);this.isMoving=A;const H=I&&w;if((x||T)&&!M&&!w&&!I&&!H){this.exitClimbing();const V=R.game.playerSpeed*this.speedMultiplier;x?this.setVelocityX(-V):T&&this.setVelocityX(V)}const G=X>=R.canvas.height-R.game.tileSize*3;P&&!M&&(G||!I)&&!H&&(this.exitClimbing(),this.setVelocityY(this.MAX_JUMP_VELOCITY),this.playJumpSound())}B&&this.fireCrystalBall(),this.updateBubbleSystem(),this.updateCrystalBallTimer(t),this.updateCursedOrbTimer(t),this.updateCursedTealOrbTimer(t),this.updateSmartAnimations(),this.runBodySprite&&this.runBodySprite.visible&&(this.body.velocity.x!==0||this.body.velocity.y!==0)&&this.updateTwoLayerPosition()}startClimbing(e){this.isClimbing=!0,this.currentLadder=e,this.isAirborne=!1,this.isJumping=!1,this.jumpButtonDown=!1,this.jumpReleased=!1,this.jumpHoldTime=0,this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.setAllowGravity(!1),this.body.setVelocityY(0));const t=e;this.x=t.x,this.currentClimbFoot="left",this.changePlayerTexture("playerClimbLeftFoot"),this.climbAnimationTimer=0,this.resetAnimationTimers(),this.resetRunningTilt()}exitClimbing(){this.isClimbing=!1,this.currentLadder=null,this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setAllowGravity(!0),this.currentFrame="idle",this.changePlayerTexture("playerIdleEye1"),this.resetAnimationTimers()}checkLadderProximity(e){this.nearbyLadder=e;const t=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),s=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),i=this.cursors.up.isDown||t.isDown||this.touchControls?.upPressed||!1,a=this.cursors.down.isDown||s.isDown||this.touchControls?.downPressed||!1;if(i||a){const o=e;return Math.abs(this.x-o.x)<20}return!1}clearNearbyLadder(){this.isClimbing||(this.nearbyLadder=null)}getIsClimbing(){return this.isClimbing}setSpeedMultiplier(e){this.speedMultiplier=e}updateBubbleSystem(){if(!this.body)return;const e=this.scene.game.loop.delta,t=this.body.blocked.down,s=!this.isMoving&&!this.isClimbing&&!this.isJumping&&t;s&&!this.bubbleActive?(this.idleTimer+=e,this.idleTimer>=this.IDLE_THRESHOLD&&(this.onBubbleTrigger&&this.onBubbleTrigger(),this.idleTimer=0)):((this.isMoving||this.isClimbing||this.isJumping)&&this.bubbleActive&&this.onMovementStart&&this.onMovementStart(),this.idleTimer=0),s?(this.longIdleTimer+=e,this.longIdleTimer>=this.LONG_IDLE_THRESHOLD&&!this.isPlayingLongIdle&&(this.isPlayingLongIdle=!0,this.longIdleFrame="left",this.longIdleAnimationTimer=0)):(this.isPlayingLongIdle&&(this.isPlayingLongIdle=!1,this.currentFrame="idle",this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")),this.longIdleTimer=0,this.longIdleAnimationTimer=0)}updateSmartAnimations(){if(!this.body)return;const e=this.scene.game.loop.delta,t=this.body.blocked.down;if(this.isClimbing){this.isJumping=!1,this.isMoving?this.handleClimbingAnimation(e):(this.changePlayerTexture("playerClimbLeftFoot"),this.resetAnimationTimers()),this.showTwoLayerRunning(!1);return}else!t&&this.isJumping&&!this.isClimbing?this.handleJumpingAnimation():this.isMoving&&t?this.handleRunningAnimation(e):t&&this.handleIdleAnimation(e)}handleJumpingAnimation(){const e=this.flipX?"playerJumpLeftFoot":"playerJumpRightFoot";this.changePlayerTexture(e),this.currentFrame="idle",this.showTwoLayerRunning(!1),this.resetRunningTilt()}handleClimbingAnimation(e){this.showTwoLayerRunning(!1),this.climbAnimationTimer+=e,this.climbAnimationTimer>=120&&this.isMoving?(this.currentClimbFoot==="left"?(this.currentClimbFoot="right",this.changePlayerTexture("playerClimbRightFoot")):(this.currentClimbFoot="left",this.changePlayerTexture("playerClimbLeftFoot")),this.climbAnimationTimer=0):this.isMoving||(this.changePlayerTexture("playerClimbLeftFoot"),this.resetAnimationTimers())}handleRunningAnimation(e){if(this.footstepTimer+=e,this.footstepTimer>=this.FOOTSTEP_INTERVAL&&(this.footstepTimer=0),this.useTwoLayerRunning&&this.runBodySprite&&this.runLegsSprite){if(this.currentFrame==="idle"){this.currentFrame="leftStep",this.showTwoLayerRunning(!0),this.legAnimationTimer=0,this.bodyAnimationTimer=0,this.runningTiltTimer=0,this.lastFrameWasJump=!1,this.legAnimationStep=0,this.footstepTimer=0;return}this.legAnimationTimer+=e,this.bodyAnimationTimer+=e,this.showTwoLayerRunning(!0),this.legAnimationTimer>=28&&(this.updateLegAnimation(),this.legAnimationTimer=0),this.bodyAnimationTimer>=300&&(this.updateBodyExpression(),this.bodyAnimationTimer=0)}else{if(this.currentFrame==="idle"){this.currentFrame="leftStep",this.changePlayerTexture("playerRunLeftFoot"),this.walkAnimationTimer=0,this.runningTiltTimer=0,this.lastFrameWasJump=!1;return}this.walkAnimationTimer+=e,this.runningTiltTimer+=e,this.applyRunningTilt(),this.walkAnimationTimer>=120&&(this.currentFrame==="rightStep"?(this.currentFrame="leftStep",this.changePlayerTexture("playerRunLeftFoot")):(this.currentFrame="rightStep",this.changePlayerTexture("playerRunRightFoot")),this.walkAnimationTimer=0)}}handleIdleAnimation(e){if(this.footstepTimer=0,this.isPlayingLongIdle){this.handleLongIdleAnimation(e);return}if(this.idleAnimationTimer+=e,this.currentFrame!=="idle"){this.currentFrame="idle",this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1"),this.idleAnimationTimer=0,this.walkAnimationTimer=0,this.climbAnimationTimer=0,this.legAnimationTimer=0,this.bodyAnimationTimer=0,this.showTwoLayerRunning(!1),this.resetRunningTilt();return}let t;if(this.currentIdleState==="blink"?t=100+Math.random()*80:t=({eye1:1200,eye2:1100,eye3:1400,eye4:1600,eye5:1800}[this.currentIdleState]||1200)+(Math.random()-.5)*800,this.idleAnimationTimer>=t){const s=Math.random();switch(this.currentIdleState){case"eye1":s<.25?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):s<.55?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):s<.75?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):s<.9?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye2":s<.3?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):s<.6?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):s<.8?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):s<.95?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye3":s<.2?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):s<.45?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):s<.7?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):s<.9?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye4":s<.15?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):s<.4?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):s<.65?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):s<.85?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye5":s<.1?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):s<.45?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):s<.75?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):s<.9?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4"));break;case"blink":s<.35?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):s<.65?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):s<.8?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):s<.95?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break}this.idleAnimationTimer=0}}handleLongIdleAnimation(e){this.longIdleAnimationTimer+=e;const t=400;this.showTwoLayerRunning(!1),this.longIdleAnimationTimer>=t&&(this.longIdleFrame==="left"?(this.longIdleFrame="right",this.changePlayerTexture("playerIdleBootyRight")):(this.longIdleFrame="left",this.changePlayerTexture("playerIdleBootyLeft")),this.longIdleAnimationTimer=0)}resetAnimationTimers(){this.walkAnimationTimer=0,this.climbAnimationTimer=0,this.idleAnimationTimer=0}changePlayerTexture(e){this.scene.textures.exists(e)&&(this.setTexture(e),this.setDisplaySize(48,64))}applyRunningTilt(){const s=Math.sin(this.runningTiltTimer*.02)*.08;this.setRotation(s)}resetRunningTilt(){this.setRotation(0),this.runningTiltTimer=0}addRoundedHitboxVisualization(){}triggerHapticFeedback(){const e=this.scene;e&&e.triggerFarcadeHapticFeedback&&e.triggerFarcadeHapticFeedback()}activateCrystalBall(){console.log("🔮 ACTIVATING Crystal Ball power-up for 10 seconds!"),this.crystalBallActive=!0,this.crystalBallTimer=this.CRYSTAL_BALL_DURATION,this.crystalBallWarningPlayed=!1,this.startCrystalBallParticles();const e=this.scene;e&&e.updateCrystalBallTimer?(console.log("🔮 Updating HUD timer with",this.crystalBallTimer,"ms"),e.updateCrystalBallTimer(this.crystalBallTimer,this.CRYSTAL_BALL_DURATION)):console.log("❌ Could not update HUD timer - scene method not found")}updateCrystalBallTimer(e){if(this.crystalBallActive){this.crystalBallTimer-=e,!this.crystalBallWarningPlayed&&this.crystalBallTimer<=2e3&&this.crystalBallTimer>0&&(this.crystalBallWarningPlayed=!0,console.log("⏰ Timer warning for crystal ball")),this.crystalBallGlow&&(this.crystalBallGlow.x=this.x,this.crystalBallGlow.y=this.y),this.crystalBallTimer<=0&&(this.crystalBallActive=!1,this.crystalBallTimer=0,this.stopCrystalBallParticles());const t=this.scene;t&&t.updateCrystalBallTimer&&t.updateCrystalBallTimer(this.crystalBallTimer,this.CRYSTAL_BALL_DURATION)}}getCrystalBallActive(){return this.crystalBallActive}getCrystalBallTimeRemaining(){return this.crystalBallTimer}fireCrystalBall(){if(console.log("🔫 Fire button pressed! Active:",this.crystalBallActive,"Climbing:",this.isClimbing),!this.crystalBallActive){console.log("❌ Cannot fire - Crystal Ball power-up not active");return}if(this.isClimbing){console.log("❌ Cannot fire - Player is climbing");return}this.isFiringProjectile=!0,this.scene.time.delayedCall(400,()=>{this.isFiringProjectile=!1,this.runBodySprite&&this.useTwoLayerRunning&&this.isRunning&&this.runBodySprite.setTexture(this.currentRunningEye)});const e=this.scene;if(e&&e.createCrystalBallProjectile){const t=this.flipX?-1:1,s=this.body?this.body.velocity.x:0;console.log("🔫 FIRING Crystal Ball projectile! Direction:",t,"Player velocity:",s),e.createCrystalBallProjectile(this.x,this.y,t,s)}else console.log("❌ Could not fire - scene method not found")}startCrystalBallParticles(){this.stopCrystalBallParticles(),this.crystalBallParticleTimer=this.scene.time.addEvent({delay:150,callback:()=>this.createCrystalBallParticle(),loop:!0})}createCrystalBallParticle(){if(!this.crystalBallActive||!this.scene)return;const e=this.scene.add.graphics();e.fillStyle(4509863,.3),e.fillCircle(0,0,4),e.fillStyle(4509863,.6),e.fillCircle(0,0,2),e.fillStyle(4509863,1),e.fillRect(-1,-1,2,2);const t=Math.random()*Math.PI*2,s=25+Math.random()*15,i=this.x+Math.cos(t)*s,a=this.y+Math.sin(t)*s;e.x=i,e.y=a,e.setDepth(19),this.crystalBallParticles.push(e),this.scene.tweens.add({targets:e,x:this.x+Math.cos(t+1)*(s+10),y:a-20,alpha:0,duration:1200,ease:"Power2.easeOut",onComplete:()=>{const o=this.crystalBallParticles.indexOf(e);o>-1&&this.crystalBallParticles.splice(o,1),e.destroy()}})}stopCrystalBallParticles(){this.crystalBallParticleTimer&&(this.crystalBallParticleTimer.destroy(),this.crystalBallParticleTimer=void 0),this.crystalBallParticles.forEach(e=>e.destroy()),this.crystalBallParticles=[],this.crystalBallGlow&&(this.crystalBallGlow.destroy(),this.crystalBallGlow=void 0)}createPlayerGlow(){if(!this.crystalBallGlow||!this.crystalBallActive)return;this.crystalBallGlow.clear();const e=4509863;this.crystalBallGlow.x=this.x,this.crystalBallGlow.y=this.y,this.crystalBallGlow.fillStyle(e,.1),this.crystalBallGlow.fillCircle(0,0,35),this.crystalBallGlow.fillStyle(e,.2),this.crystalBallGlow.fillCircle(0,0,25),this.crystalBallGlow.fillStyle(e,.3),this.crystalBallGlow.fillCircle(0,0,15),this.scene.tweens.add({targets:this.crystalBallGlow,scaleX:1.2,scaleY:1.2,alpha:.7,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}activateCursedOrb(){this.cursedOrbActive=!0,this.cursedOrbTimer=this.CURSED_ORB_DURATION,this.cursedOrbWarningPlayed=!1,this.startCursedOrbParticles();const e=this.scene;e&&e.updateCursedOrbTimer&&e.updateCursedOrbTimer(this.cursedOrbTimer,this.CURSED_ORB_DURATION),e&&e.activateDarknessEffect&&e.activateDarknessEffect()}activateCursedTealOrb(){this.cursedTealOrbActive=!0,this.cursedTealOrbTimer=this.CURSED_TEAL_ORB_DURATION,this.cursedTealOrbWarningPlayed=!1,this.startCursedTealOrbParticles();const e=this.scene;e&&e.updateCursedTealOrbTimer&&e.updateCursedTealOrbTimer(this.cursedTealOrbTimer,this.CURSED_TEAL_ORB_DURATION)}getCursedOrbActive(){return this.cursedOrbActive}getCursedTealOrbActive(){return this.cursedTealOrbActive}updateCursedOrbTimer(e){if(this.cursedOrbActive){if(this.cursedOrbTimer-=e,!this.cursedOrbWarningPlayed&&this.cursedOrbTimer<=2e3&&this.cursedOrbTimer>0&&(this.cursedOrbWarningPlayed=!0,console.log("⏰ Timer warning for cursed orb")),this.cursedOrbGlow&&(this.cursedOrbGlow.x=this.x,this.cursedOrbGlow.y=this.y),this.cursedOrbTimer<=0){this.cursedOrbActive=!1,this.cursedOrbTimer=0,this.stopCursedOrbParticles();const s=this.scene;s&&s.deactivateDarknessEffect&&s.deactivateDarknessEffect()}const t=this.scene;t&&t.updateCursedOrbTimer&&t.updateCursedOrbTimer(this.cursedOrbTimer,this.CURSED_ORB_DURATION)}}updateCursedTealOrbTimer(e){if(this.cursedTealOrbActive){this.cursedTealOrbTimer-=e,!this.cursedTealOrbWarningPlayed&&this.cursedTealOrbTimer<=2e3&&this.cursedTealOrbTimer>0&&(this.cursedTealOrbWarningPlayed=!0,console.log("⏰ Timer warning for cursed teal orb")),this.cursedTealOrbGlow&&(this.cursedTealOrbGlow.x=this.x,this.cursedTealOrbGlow.y=this.y),this.cursedTealOrbTimer<=0&&(this.cursedTealOrbActive=!1,this.cursedTealOrbTimer=0,this.stopCursedTealOrbParticles());const t=this.scene;t&&t.updateCursedTealOrbTimer&&t.updateCursedTealOrbTimer(this.cursedTealOrbTimer,this.CURSED_TEAL_ORB_DURATION)}}startCursedOrbParticles(){this.stopCursedOrbParticles(),this.cursedOrbGlow=this.scene.add.graphics(),this.cursedOrbGlow.setDepth(18),this.createCursedOrbPlayerGlow(),this.cursedOrbParticleTimer=this.scene.time.addEvent({delay:200,callback:()=>this.createCursedOrbParticle(),loop:!0})}startCursedTealOrbParticles(){this.stopCursedTealOrbParticles(),this.cursedTealOrbGlow=this.scene.add.graphics(),this.cursedTealOrbGlow.setDepth(18),this.createCursedTealOrbPlayerGlow(),this.cursedTealOrbParticleTimer=this.scene.time.addEvent({delay:180,callback:()=>this.createCursedTealOrbParticle(),loop:!0})}createCursedOrbParticle(){if(!this.cursedOrbActive||!this.scene)return;const e=this.scene.add.graphics();e.fillStyle(5768769,.4),e.fillCircle(0,0,3),e.fillStyle(5768769,.8),e.fillCircle(0,0,1);const t=Math.random()*Math.PI*2,s=30+Math.random()*15,i=this.x+Math.cos(t)*s,a=this.y+Math.sin(t)*s;e.x=i,e.y=a,e.setDepth(19),this.cursedOrbParticles.push(e),this.scene.tweens.add({targets:e,y:a+25,alpha:0,duration:1500,ease:"Power2.easeOut",onComplete:()=>{const o=this.cursedOrbParticles.indexOf(e);o>-1&&this.cursedOrbParticles.splice(o,1),e.destroy()}})}createCursedTealOrbParticle(){if(!this.cursedTealOrbActive||!this.scene)return;const e=this.scene.add.graphics();e.fillStyle(4827036,.4),e.fillCircle(0,0,3),e.fillStyle(4827036,.8),e.fillCircle(0,0,1);const t=Math.random()*Math.PI*2,s=25+Math.random()*20,i=this.x+Math.cos(t)*s,a=this.y+Math.sin(t)*s;e.x=i,e.y=a,e.setDepth(19),this.cursedTealOrbParticles.push(e),this.scene.tweens.add({targets:e,x:i+Math.sin(t)*30,y:a-20,alpha:0,duration:1300,ease:"Power2.easeOut",onComplete:()=>{const o=this.cursedTealOrbParticles.indexOf(e);o>-1&&this.cursedTealOrbParticles.splice(o,1),e.destroy()}})}createCursedOrbPlayerGlow(){if(!this.cursedOrbGlow||!this.cursedOrbActive)return;this.cursedOrbGlow.clear();const e=5768769;this.cursedOrbGlow.x=this.x,this.cursedOrbGlow.y=this.y,this.cursedOrbGlow.fillStyle(e,.15),this.cursedOrbGlow.fillCircle(0,0,40),this.cursedOrbGlow.fillStyle(e,.25),this.cursedOrbGlow.fillCircle(0,0,25),this.scene.tweens.add({targets:this.cursedOrbGlow,scaleX:1.3,scaleY:1.3,alpha:.6,duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createCursedTealOrbPlayerGlow(){if(!this.cursedTealOrbGlow||!this.cursedTealOrbActive)return;this.cursedTealOrbGlow.clear();const e=4827036;this.cursedTealOrbGlow.x=this.x,this.cursedTealOrbGlow.y=this.y,this.cursedTealOrbGlow.fillStyle(e,.12),this.cursedTealOrbGlow.fillCircle(0,0,38),this.cursedTealOrbGlow.fillStyle(e,.22),this.cursedTealOrbGlow.fillCircle(0,0,22),this.scene.tweens.add({targets:this.cursedTealOrbGlow,rotation:Math.PI*2,scaleX:1.4,scaleY:1.4,alpha:.7,duration:900,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}stopCursedOrbParticles(){this.cursedOrbParticleTimer&&(this.cursedOrbParticleTimer.destroy(),this.cursedOrbParticleTimer=void 0),this.cursedOrbParticles.forEach(e=>e.destroy()),this.cursedOrbParticles=[],this.cursedOrbGlow&&(this.cursedOrbGlow.destroy(),this.cursedOrbGlow=void 0)}stopCursedTealOrbParticles(){this.cursedTealOrbParticleTimer&&(this.cursedTealOrbParticleTimer.destroy(),this.cursedTealOrbParticleTimer=void 0),this.cursedTealOrbParticles.forEach(e=>e.destroy()),this.cursedTealOrbParticles=[],this.cursedTealOrbGlow&&(this.cursedTealOrbGlow.destroy(),this.cursedTealOrbGlow=void 0)}stopAllCursedOrbParticles(){this.stopCursedOrbParticles()}stopAllCursedTealOrbParticles(){this.stopCursedTealOrbParticles()}playJumpSound(){if(this.scene.registry.get("sfxEnabled")!==!1){const t=`jump-${this.currentJumpSound}`;this.scene.sound.play(t,{volume:.4})}this.currentJumpSound=this.currentJumpSound>=3?1:this.currentJumpSound+1}}var ce=(C=>(C.BLUE="blue",C.PURPLE="purple",C.YELLOW="yellow",C.GREEN="green",C.RED="red",C.BLUE_CATERPILLAR="blue_caterpillar",C))(ce||{});class U extends Phaser.Physics.Arcade.Sprite{baseSpeed=80;moveSpeed;direction;platformBounds;catColor;bounceTimer=0;randomMoveTimer=0;isSquished=!1;gapDetectionCooldown=0;collisionCooldown=0;debugGraphics=null;debugUpdateHandler=null;yellowEnemyAnimationState="mouthClosed";blueEnemyAnimationState="idle";biteTimer=0;blinkTimer=0;biteAnimationTimer=0;blinkAnimationTimer=0;nextExpressionTime=0;nextBiteTime=0;nextBlinkTime=0;blueTextureFixed=!1;stuckTimer=0;lastPositionX=0;stuckThreshold=1500;positionCheckInterval=250;positionCheckTimer=0;positionHistory=[];velocityStuckTimer=0;individualSpeedMultiplier=1;turnDelayTimer=0;redEnemyAnimationState="patrol";redBiteTimer=0;redBlinkTimer=0;redBiteSequenceTimer=0;redEyeState=1;nextRedBiteTime=0;nextRedBlinkTime=0;redBiteFrameIndex=0;greenEnemyAnimationState="eyeRight";greenEyeTimer=0;greenBlinkTimer=0;nextGreenEyeTime=0;nextGreenBlinkTime=0;blueCaterpillarAnimationState="eyesDown";blueCaterpillarEyeTimer=0;blueCaterpillarBlinkTimer=0;nextBlueCaterpillarEyeTime=0;nextBlueCaterpillarBlinkTime=0;blueCaterpillarAnimationDelay=0;blueCaterpillarAnimationsEnabled=!0;blueCaterpillarVelocityLogTimer=0;blueCaterpillarVelocityCheckTimer=0;blueCaterpillarLastX=0;blueCaterpillarStuckFrames=0;isStalker=!1;stalkerState="hidden";stalkerTriggerDistance=64;stalkerPlayerRef=null;stalkerOriginalY=0;stalkerHasPlayerPassed=!1;stalkerMineTimer=0;stalkerMineDelayDuration=3e3;stalkerCurrentSpeed=80*1.5;stalkerSpeedIncrement=5;stalkerChasePersistenceTimer=0;stalkerChasePersistenceDuration=4e3;stalkerIsInPersistentChase=!1;stalkerEyeState="eye1";stalkerEyeAnimationTimer=0;getCatColor(){return this.catColor}getIsStalker(){return this.isStalker}constructor(e,t,s,i,a,o,l=!1){const r=["blue","yellow","green","red","blue_caterpillar"];let n;o?n=o:n=r[Math.floor(Math.random()*r.length)];let c;if(n==="blue"?c="blueEnemyMouthClosed":n==="purple"?c="purpleEnemyMouthClosed":n==="yellow"?c="yellowEnemyMouthClosedEyeOpen":n==="green"?c="greenEnemy":n==="red"?c="redEnemyMouthClosedEyes1":n==="blue_caterpillar"?c="blueCaterpillarEyesDown":c="blueEnemyMouthClosed",super(e,t,s,c),this.catColor=n,this.isStalker=l,n==="green"&&(this.setDisplaySize(36,36),console.log("🟢 GREEN INITIAL: Display size set to 36x36")),this.isStalker&&(this.stalkerOriginalY=s,e.textures.exists("stalkerEnemyEye1")&&this.setTexture("stalkerEnemyEye1"),this.stalkerEyeState="eye1"),e.add.existing(this),e.physics.add.existing(this),(n==="blue"||n==="purple")&&this.body instanceof Phaser.Physics.Arcade.Body){this.body.setSize(63.5,45);const d=(n==="blue"?this.isBlueEnemyAnimationSprite(c):this.isPurpleEnemyAnimationSprite(c))?32:19;this.body.setOffset(-15.75+2,d-4.5)}else if(n==="yellow"&&this.body instanceof Phaser.Physics.Arcade.Body){const h=this.body.width,d=this.body.height;this.body.setSize(h*.7,d*.7);const u=(h-this.body.width)/2,g=(d-this.body.height)/2;this.body.setOffset(u,g)}else if(n==="blue_caterpillar"&&this.body instanceof Phaser.Physics.Arcade.Body)this.body.width,this.body.height,this.body.setSize(54,20);else if(n==="red"&&this.body instanceof Phaser.Physics.Arcade.Body)if(this.isStalker){const d=this.texture.get().width,u=42,g=u/d,b=12/g;this.body.setCircle(b);const y=b*2,f=(d-y)/2,m=(d-y)/2+14/g;this.body.setOffset(f,m),console.log("👁️ STALKER CIRCULAR HITBOX:"),console.log("  Circle radius:",b,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",u,"x",u)}else{const d=this.texture.get().width,u=this.isStalker?42:52,g=u/d,b=15/g;this.body.setCircle(b);const y=b*2,f=(d-y)/2,m=(d-y)/2+14/g;this.body.setOffset(f,m),console.log("🔴 SNAIL CIRCULAR HITBOX:"),console.log("  Circle radius:",b,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",u,"x",u)}else if(n==="green"&&this.body instanceof Phaser.Physics.Arcade.Body){const h=this.texture.get().width,d=this.texture.get().height,u=this.displayWidth/h,g=this.displayHeight/d,b=12,y=(u+g)/2,f=b/y;this.body.setCircle(f),console.log("🟢 GREEN BOUNCER CIRCULAR HITBOX:"),console.log("  Circle radius requested:",b,"px (screen space)"),console.log("  Circle radius actual:",f,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Current sprite display size:",this.displayWidth,"x",this.displayHeight),console.log("  Texture frame size:",h,"x",d);const m=f*2,S=(h-m)/2,v=(d-m)/2,k=5/y;this.body.setOffset(S,v+k),console.log("  Circle offset applied:",this.body.offset.x,",",this.body.offset.y),console.log("  Average scale:",y),console.log("  Visual offset in texture space:",0,k)}if(this.setCollideWorldBounds(!0),this.setBounce(0),this.body instanceof Phaser.Physics.Arcade.Body&&n!=="green"&&this.body.setAllowGravity(!1),n==="yellow"&&this.isYellowEnemyAnimationSprite(c))this.setDisplaySize(54,21.6),this.setOffset(15,5),this.setFlipX(!1),this.initializeYellowEnemyAnimations();else if(n==="blue_caterpillar"&&this.isBlueCaterpillarAnimationSprite(c)){this.setDisplaySize(64,25.6);const h=this.texture.get().width,d=this.texture.get().height,u=(h-54)/2,g=(d-20)/2,b=23,y=15;this.setOffset(b,y),console.log("  Calculated center offset:",u,",",g),console.log("  Final offset applied:",b,",",y),console.log("  Sprite position:",this.x,",",this.y),this.setFlipX(!1),this.initializeBlueCaterpillarAnimations(),this.blueCaterpillarAnimationsEnabled=!1,this.blueCaterpillarAnimationDelay=1500,this.body instanceof Phaser.Physics.Arcade.Body&&(console.log("  Final physics body offset:",this.body.offset.x,",",this.body.offset.y),console.log("  Physics body position:",this.body.x,",",this.body.y))}else if(n==="blue"&&this.isBlueEnemyAnimationSprite(c))this.setDisplaySize(36,36),this.setOffset(5,32),this.setFlipX(!1),this.initializeBlueEnemyAnimations();else if(n==="purple"&&this.isPurpleEnemyAnimationSprite(c))this.setDisplaySize(36,36),this.setOffset(5,32),this.setFlipX(!1),this.initializeBlueEnemyAnimations();else if(n==="red"&&this.isRedEnemyAnimationSprite(c)){const h=this.isStalker?42:52;this.setDisplaySize(h,h);const d=this.isStalker?24:26;this.setOffset(18,d),this.setFlipX(!1),this.initializeRedEnemyAnimations(),this.isStalker}else n==="green"&&c==="greenEnemy"&&(this.setFlipX(!1),console.log("🟢 GREEN VISUAL FINAL:"),console.log("  Display size remains:",this.displayWidth,"x",this.displayHeight),console.log("  Physics body handles visual offset"));this.body instanceof Phaser.Physics.Arcade.Body,this.setDepth(15),this.platformBounds={left:i,right:a},this.setupBehavior(),n==="blue"&&e.textures.exists("blueEnemy")&&this.setFlipX(this.direction>0),this.isStalker?(this.setVisible(!1),this.setVelocity(0,0),this.body.setGravityY(0),this.body.setImmovable(!0)):(this.setVelocityX(this.moveSpeed*this.direction),this.catColor==="blue_caterpillar"&&this.body&&(this.body.setImmovable(!1),this.body.moves=!0))}setupBehavior(){this.individualSpeedMultiplier=.85+Math.random()*.3;const s=(this.scene.levelManager?.getCurrentLevel()||1)<=10;switch(this.catColor){case"blue":case"purple":this.moveSpeed=this.baseSpeed*this.individualSpeedMultiplier;break;case"yellow":const i=s?.4:.6;this.moveSpeed=this.baseSpeed*i*this.individualSpeedMultiplier;break;case"blue_caterpillar":const a=s?.65:.8;this.moveSpeed=this.baseSpeed*a*this.individualSpeedMultiplier;break;case"green":this.moveSpeed=this.baseSpeed*1*this.individualSpeedMultiplier;break;case"red":this.moveSpeed=this.baseSpeed*1.2*this.individualSpeedMultiplier;break}if(this.catColor==="yellow"&&s){const i=(this.platformBounds.left+this.platformBounds.right)/2;this.direction=this.x<i?-1:1}else this.catColor==="green"?(this.direction=Math.random()<.5?-1:1,this.bounceTimer=Math.random()*1500):this.direction=Math.random()<.5?-1:1}update(e,t){if(!this.isSquished){if(this.collisionCooldown-=t,this.isStalker){this.updateStalker(t);return}if(this.body)switch(this.catColor){case"blue":case"purple":this.updateBluePatrol(),this.updateBlueEnemyAnimations(t),this.checkIfChomperStuck(t);break;case"yellow":this.updateYellowPatrol(t),this.updateYellowEnemyAnimations(t),this.checkIfCaterpillarStuck(t);break;case"blue_caterpillar":this.updateBlueCaterpillarPatrol(t),this.updateBlueCaterpillarAnimations(t),this.checkIfCaterpillarStuck(t);break;case"green":this.updateGreenBounce(t),this.updateGreenEnemyAnimations(t);break;case"red":this.updateRedPatrol(),this.updateRedEnemyAnimations(t);break}}}updateBluePatrol(){(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&this.setVelocityX(0),this.turnDelayTimer>0&&(this.turnDelayTimer-=Phaser.Math.Clamp(16,0,100));const e=40;this.x<=this.platformBounds.left+e?this.turnDelayTimer<=0&&(this.direction=1,this.x<this.platformBounds.left+20&&(this.x=this.platformBounds.left+20),this.turnDelayTimer=50+Math.random()*150,(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+1e3,this.setVelocityX(this.moveSpeed*this.direction))):this.x>=this.platformBounds.right-e&&this.turnDelayTimer<=0&&(this.direction=-1,this.x>this.platformBounds.right-20&&(this.x=this.platformBounds.right-20),this.turnDelayTimer=50+Math.random()*150,(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+1e3,this.setVelocityX(this.moveSpeed*this.direction))),this.blueEnemyAnimationState==="idle"&&this.setVelocityX(this.moveSpeed*this.direction),(this.catColor==="blue"||this.catColor==="purple")&&this.setFlipX(this.direction>0)}updateYellowPatrol(e){const i=(this.scene.levelManager?.getCurrentLevel()||1)<=10;if(this.randomMoveTimer-=e,this.randomMoveTimer<=0){const l=i?.05:.3;Math.random()<l&&(this.direction=Math.random()<.5?-1:1),i?this.randomMoveTimer=2e3+Math.random()*1e3:this.randomMoveTimer=500+Math.random()*1e3}this.turnDelayTimer>0&&(this.turnDelayTimer-=e);const a=Math.abs(this.body.velocity.x)<5&&Math.abs(this.moveSpeed)>0,o=35;this.x<=this.platformBounds.left+o||a&&this.direction===-1?this.turnDelayTimer<=0&&(this.direction=1,this.turnDelayTimer=100+Math.random()*400):(this.x>=this.platformBounds.right-o||a&&this.direction===1)&&this.turnDelayTimer<=0&&(this.direction=-1,this.turnDelayTimer=100+Math.random()*400),this.setVelocityX(this.moveSpeed*this.direction),this.isYellowEnemyAnimationSprite(this.texture.key)&&this.setFlipX(this.direction===1)}updateGreenBounce(e){if(this.bounceTimer-=e,this.bounceTimer<=0&&this.body?.touching.down&&(this.setVelocityY(-200),this.bounceTimer=1e3+Math.random()*1e3),this.x<=this.platformBounds.left+20){this.direction=1;const t=.9+Math.random()*.2;this.setVelocityX(this.moveSpeed*this.direction*t)}else if(this.x>=this.platformBounds.right-20){this.direction=-1;const t=.9+Math.random()*.2;this.setVelocityX(this.moveSpeed*this.direction*t)}else this.setVelocityX(this.moveSpeed*this.direction)}updateRedPatrol(){if(this.x<=this.platformBounds.left+25?(this.direction=1,this.x<=this.platformBounds.left+5&&this.setX(this.platformBounds.left+5)):this.x>=this.platformBounds.right-25&&(this.direction=-1,this.x>=this.platformBounds.right-5&&this.setX(this.platformBounds.right-5)),Math.random()<5e-4&&this.x>this.platformBounds.left+25&&this.x<this.platformBounds.right-25&&(this.direction*=-1),this.x<this.platformBounds.left+5||this.x>this.platformBounds.right-5){const t=Math.max(this.platformBounds.left+5,Math.min(this.platformBounds.right-5,this.x));this.setX(t),this.direction*=-1}this.setVelocityX(this.moveSpeed*this.direction)}reverseDirection(){this.isSquished||this.collisionCooldown<=0&&(this.direction*=-1,this.setVelocityX(this.moveSpeed*this.direction),this.collisionCooldown=200,this.catColor==="blue"&&this.setFlipX(this.direction>0))}getDirection(){return this.direction}squish(){this.isSquished||(this.isSquished=!0,this.setVelocity(0,0),this.body&&(this.body.enable=!1),this.cleanupDebugVisualization(),this.scene.tweens.add({targets:this,scaleY:.2,scaleX:1.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.cats&&this.scene.cats.remove(this),this.destroy()}}))}addDebugVisualization(){}cleanupDebugVisualization(){this.debugUpdateHandler&&(this.scene.events.off("postupdate",this.debugUpdateHandler),this.debugUpdateHandler=null),this.debugGraphics&&(this.debugGraphics.destroy(),this.debugGraphics=null)}addRoundedHitboxVisualization(){}isYellowEnemyAnimationSprite(e){return["yellowEnemyMouthOpenEyeOpen","yellowEnemyMouthOpenBlinking","yellowEnemyMouthClosedEyeOpen","yellowEnemyMouthClosedBlinking"].includes(e)}isBlueEnemyAnimationSprite(e){return["blueEnemyMouthClosed","blueEnemyMouthClosedBlinking","blueEnemyMouthPartialOpen","blueEnemyMouthPartialOpenBlinking","blueEnemyMouthOpen","blueEnemyMouthOpenBlinking"].includes(e)}isPurpleEnemyAnimationSprite(e){return["purpleEnemyMouthClosed","purpleEnemyMouthPartialOpen","purpleEnemyMouthOpen"].includes(e)}initializeYellowEnemyAnimations(){this.nextBlinkTime=Math.random()*1e3+1e3,this.nextExpressionTime=Math.random()*3e3+3e3,this.yellowEnemyAnimationState="mouthClosed"}initializeBlueEnemyAnimations(){this.nextBiteTime=Math.random()*2e3+2e3,this.nextBlinkTime=Number.MAX_SAFE_INTEGER,this.blueEnemyAnimationState="idle"}updateBlueEnemyAnimations(e){if(!this.isBlueEnemyAnimationSprite(this.texture.key)&&!this.isPurpleEnemyAnimationSprite(this.texture.key)){this.catColor==="blue"&&!this.blueTextureFixed&&this.scene.textures.exists("blueEnemyMouthClosed")?(this.setTexture("blueEnemyMouthClosed"),this.setDisplaySize(36,36),this.blueTextureFixed=!0,this.initializeBlueEnemyAnimations()):this.catColor==="purple"&&!this.blueTextureFixed&&this.scene.textures.exists("purpleEnemyMouthClosed")&&(this.setTexture("purpleEnemyMouthClosed"),this.setDisplaySize(36,36),this.blueTextureFixed=!0,this.initializeBlueEnemyAnimations());return}switch(this.blueTextureFixed=!1,this.biteTimer+=e,this.biteAnimationTimer+=e,this.blueEnemyAnimationState){case"idle":this.handleIdleState();break;case"bite_partial":this.handleBitePartialState();break;case"bite_full":this.handleBiteFullState();break;case"blinking":this.blueEnemyAnimationState="idle";break}this.checkForNewAnimations()}handleIdleState(){this.changeBlueEnemyTexture("blueEnemyMouthClosed")}handleBitePartialState(){this.biteAnimationTimer<150?this.changeBlueEnemyTexture("blueEnemyMouthPartialOpen"):this.biteAnimationTimer>300?(console.warn("Bite partial state exceeded max duration - forcing transition"),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+3e3,this.setVelocityX(this.moveSpeed*this.direction)):(this.blueEnemyAnimationState="bite_full",this.biteAnimationTimer=0)}handleBiteFullState(){this.biteAnimationTimer<200?this.changeBlueEnemyTexture("blueEnemyMouthOpen"):this.biteAnimationTimer>350?(console.warn("Bite full state exceeded max duration - forcing idle"),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+3e3,this.setVelocityX(this.moveSpeed*this.direction)):(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+Math.random()*2e3+2e3,this.setVelocityX(this.moveSpeed*this.direction))}handleBlinkingState(){this.blueEnemyAnimationState="idle",this.blinkAnimationTimer=0,this.nextBlinkTime=Number.MAX_SAFE_INTEGER}checkForNewAnimations(){this.biteTimer>=this.nextBiteTime&&this.blueEnemyAnimationState==="idle"&&(this.blueEnemyAnimationState="bite_partial",this.biteAnimationTimer=0)}changeBlueEnemyTexture(e){if(!this.scene)return;let t=e;if(this.catColor==="purple"&&(e==="blueEnemyMouthClosed"?t="purpleEnemyMouthClosed":e==="blueEnemyMouthPartialOpen"?t="purpleEnemyMouthPartialOpen":e==="blueEnemyMouthOpen"&&(t="purpleEnemyMouthOpen")),this.scene.textures.exists(t))this.setTexture(t),this.setDisplaySize(36,36);else{const s=this.catColor==="purple"?"purpleEnemyMouthClosed":"blueEnemyMouthClosed";this.scene.textures.exists(s)&&(this.setTexture(s),this.setDisplaySize(36,36))}}checkIfChomperStuck(e){if(this.positionCheckTimer+=e,this.positionCheckTimer>=this.positionCheckInterval&&(this.positionHistory.push(this.x),this.positionHistory.length>8&&this.positionHistory.shift(),this.positionCheckTimer=0),Math.abs(this.body.velocity.x)<1){if(this.velocityStuckTimer+=e,this.velocityStuckTimer>1e3&&this.x>this.platformBounds.left+40&&this.x<this.platformBounds.right-40){console.warn("Chomper velocity stuck - forcing reset"),this.forceResetChomper();return}}else this.velocityStuckTimer=0;if(this.positionHistory.length>=4&&this.positionHistory.every(s=>Math.abs(s-this.positionHistory[0])<2)&&this.x>this.platformBounds.left+40&&this.x<this.platformBounds.right-40){console.warn("Chomper position stuck (not at edge) - forcing reset"),this.forceResetChomper();return}if(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full"){if(this.biteAnimationTimer>400){console.warn("Bite animation taking too long - forcing reset"),this.forceResetChomper();return}const t=this.x;if(Math.abs(t-this.lastPositionX)>1)this.stuckTimer=0;else if(this.stuckTimer+=e,this.stuckTimer>=this.stuckThreshold){console.error("Chomper stuck during bite - forcing recovery!"),this.forceResetChomper();return}this.lastPositionX=t}else this.stuckTimer=0,this.lastPositionX=this.x}forceResetChomper(){console.warn("=== FORCE RESETTING STUCK CHOMPER ==="),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.blinkAnimationTimer=0,this.biteTimer=0,this.blinkTimer=0,this.nextBiteTime=5e3,this.nextBlinkTime=Number.MAX_SAFE_INTEGER,this.stuckTimer=0,this.positionCheckTimer=0,this.velocityStuckTimer=0,this.positionHistory=[],this.changeBlueEnemyTexture("blueEnemyMouthClosed"),this.x<=this.platformBounds.left+50?(this.direction=1,this.x=this.platformBounds.left+51):this.x>=this.platformBounds.right-50?(this.direction=-1,this.x=this.platformBounds.right-51):this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction*1.2),this.scene.time.delayedCall(500,()=>{this.active&&this.setVelocityX(this.moveSpeed*this.direction)}),this.setData("recoveredFromStuck",!0),this.setData("stuckRecoveryCount",(this.getData("stuckRecoveryCount")||0)+1),this.getData("stuckRecoveryCount")>=2&&(console.error("Chomper stuck 2+ times - marking for replacement"),this.setData("needsReplacement",!0))}checkIfCaterpillarStuck(e){if(this.body&&(this.catColor,this.positionCheckTimer+=e,this.positionCheckTimer>=this.positionCheckInterval&&(this.positionHistory.push(this.x),this.positionHistory.length>6&&this.positionHistory.shift(),this.positionCheckTimer=0),!!this.body)){if(Math.abs(this.body.velocity.x)<1){if(this.velocityStuckTimer+=e,this.velocityStuckTimer>400&&this.x>this.platformBounds.left+30&&this.x<this.platformBounds.right-30){this.forceResetCaterpillar();return}}else this.velocityStuckTimer=0;if(this.positionHistory.length>=4&&this.positionHistory.every(s=>Math.abs(s-this.positionHistory[0])<3)&&this.x>this.platformBounds.left+30&&this.x<this.platformBounds.right-30){this.forceResetCaterpillar();return}(this.x<this.platformBounds.left-10||this.x>this.platformBounds.right+10)&&this.forceResetCaterpillar()}}replaceSelfWithYellowCaterpillar(){const e=new U(this.scene,this.x,this.y,this.platformBounds.left,this.platformBounds.right,"yellow",!1);this.speedMultiplier&&e.setSpeedMultiplier(this.speedMultiplier);const t=this.scene;t.yellowEnemies&&t.yellowEnemies.add(e),t.cats&&t.cats.add(e),t.blueCaterpillars&&t.blueCaterpillars.remove(this),t.cats&&t.cats.remove(this),this.destroy()}forceResetCaterpillar(){this.catColor,this.catColor==="blue_caterpillar"?(this.blueCaterpillarAnimationState="eyesDown",this.blueCaterpillarBlinkTimer=0,this.blueCaterpillarEyeTimer=0,this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500,this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.scene&&this.scene.textures.exists("blueCaterpillarEyesDown")&&this.setTexture("blueCaterpillarEyesDown")):(this.yellowAnimationState="mouth_closed",this.yellowBlinkTimer=0,this.yellowMouthTimer=0),this.stuckTimer=0,this.positionCheckTimer=0,this.velocityStuckTimer=0,this.positionHistory=[],this.randomMoveTimer=200,this.turnDelayTimer=0;const e=(this.platformBounds.left+this.platformBounds.right)/2;if(this.x<e?this.direction=1:this.direction=-1,this.x<=this.platformBounds.left+20||this.x>=this.platformBounds.right-20){const t=this.platformBounds.left+50+Math.random()*(this.platformBounds.right-this.platformBounds.left-100);this.setX(t)}this.setVelocityX(this.moveSpeed*this.direction*1.5),this.scene.time.delayedCall(500,()=>{this.active&&this.setVelocityX(this.moveSpeed*this.direction)}),this.setData("recoveredFromStuck",!0),this.setData("stuckRecoveryCount",(this.getData("stuckRecoveryCount")||0)+1),this.getData("stuckRecoveryCount")>=3&&this.setData("needsReplacement",!0)}isRedEnemyAnimationSprite(e){return["redEnemyMouthClosedEyes1","redEnemyMouthClosedEyes2","redEnemyMouthClosedBlinking","redEnemyMouthPartialOpenEyes1Wink","redEnemyMouthPartialOpenEyes2","redEnemyMouthWideOpenEyes1Wink","redEnemyMouthWideOpenEyes2","redEnemyMouthWideOpenEyes3"].includes(e)}initializeRedEnemyAnimations(){this.nextRedBiteTime=Math.random()*2e3+3e3,this.nextRedBlinkTime=Math.random()*500+1e3,this.redEnemyAnimationState="patrol",this.redEyeState=Math.random()<.5?1:2}updateYellowEnemyAnimations(e){if(!this.isYellowEnemyAnimationSprite(this.texture.key))return;this.biteTimer+=e,this.biteTimer>=this.nextExpressionTime&&(this.yellowEnemyAnimationState=this.yellowEnemyAnimationState==="mouthClosed"?"mouthOpen":"mouthClosed",this.nextExpressionTime=this.biteTimer+Math.random()*3e3+3e3);let t="yellowEnemyMouthClosedEyeOpen";this.yellowEnemyAnimationState==="mouthOpen"&&(t="yellowEnemyMouthOpenEyeOpen"),this.texture.key!==t&&this.setTexture(t)}updateRedEnemyAnimations(e){if(this.isRedEnemyAnimationSprite(this.texture.key)){switch(this.redBiteTimer+=e,this.redBlinkTimer+=e,this.redBiteSequenceTimer+=e,this.redEnemyAnimationState){case"patrol":this.handleRedPatrolState();break;case"bite_starting":this.handleRedBiteStartingState();break;case"bite_opening":this.handleRedBiteOpeningState();break;case"bite_wide":this.handleRedBiteWideState();break;case"bite_closing":this.handleRedBiteClosingState();break}this.checkForRedAnimationTriggers()}}handleRedPatrolState(){const e=800+Math.random()*400;this.redBiteSequenceTimer>=e&&(this.redEyeState=this.redEyeState===1?2:1,this.redBiteSequenceTimer=0),this.changeRedEnemyTexture(this.redEyeState===1?"redEnemyMouthClosedEyes1":"redEnemyMouthClosedEyes2")}handleRedBiteStartingState(){this.redBiteSequenceTimer<80?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes2"):(this.redEnemyAnimationState="bite_opening",this.redBiteSequenceTimer=0,this.redBiteFrameIndex=0)}handleRedBiteOpeningState(){this.redBiteSequenceTimer<100?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes1Wink"):(this.redEnemyAnimationState="bite_wide",this.redBiteSequenceTimer=0,this.redBiteFrameIndex=0)}handleRedBiteWideState(){const e=["redEnemyMouthWideOpenEyes1Wink","redEnemyMouthWideOpenEyes2","redEnemyMouthWideOpenEyes3"],s=Math.floor(this.redBiteSequenceTimer/120);s<e.length?this.changeRedEnemyTexture(e[s]):(this.redEnemyAnimationState="bite_closing",this.redBiteSequenceTimer=0)}handleRedBiteClosingState(){this.redBiteSequenceTimer<80?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes2"):(this.redEnemyAnimationState="patrol",this.redBiteSequenceTimer=0,this.nextRedBiteTime=this.redBiteTimer+Math.random()*2e3+3e3)}checkForRedAnimationTriggers(){this.redBiteTimer>=this.nextRedBiteTime&&this.redEnemyAnimationState==="patrol"&&(this.redEnemyAnimationState="bite_starting",this.redBiteSequenceTimer=0),this.redBlinkTimer>=this.nextRedBlinkTime&&(this.redEnemyAnimationState==="patrol"&&(this.changeRedEnemyTexture("redEnemyMouthClosedBlinking"),this.scene.time.delayedCall(150,()=>{this.redEnemyAnimationState==="patrol"&&this.changeRedEnemyTexture(this.redEyeState===1?"redEnemyMouthClosedEyes1":"redEnemyMouthClosedEyes2")})),this.nextRedBlinkTime=this.redBlinkTimer+Math.random()*1e3+1e3)}changeRedEnemyTexture(e){this.scene&&this.scene.textures.exists(e)&&(this.setTexture(e),this.setDisplaySize(52,52),this.catColor==="red"&&this.setFlipX(this.direction>0))}setPlayerReference(e){this.stalkerPlayerRef=e}canDamagePlayer(){return this.isStalker&&this.stalkerState==="chasing"}updateStalker(e){if(!this.stalkerPlayerRef)return;const t=this.y;switch(this.stalkerState){case"hidden":this.updateStalkerHidden();break;case"activated":this.updateStalkerActivated(e);break;case"chasing":this.updateStalkerChasing(e),this.updateStalkerEyeAnimations(e);break}Math.abs(this.y-t)>.1}updateStalkerHidden(){if(!this.stalkerPlayerRef)return;const e=this.stalkerPlayerRef.x,t=this.stalkerPlayerRef.y,s=Math.abs(e-this.x),i=t<=this.y+40,a=t>=this.y-40;i&&a&&s<=this.stalkerTriggerDistance&&!this.stalkerHasPlayerPassed&&(this.stalkerState="activated",this.stalkerMineTimer=this.stalkerMineDelayDuration,this.stalkerHasPlayerPassed=!0,this.scene.textures.exists("stalkerEnemyEyeOnly")&&this.setTexture("stalkerEnemyEyeOnly"),this.setVisible(!0))}updateStalkerActivated(e){this.stalkerMineTimer-=e,this.stalkerMineTimer<=0&&this.stalkerPopOut()}stalkerPopOut(){this.stalkerState="chasing",this.setVisible(!0),this.scene.textures.exists("stalkerEnemyEye1")&&this.setTexture("stalkerEnemyEye1"),this.stalkerEyeState="eye1",this.body.setGravityY(0),this.body.setImmovable(!1),this.stalkerOriginalY=this.y,this.stalkerCurrentSpeed=80*1.5,this.stalkerChasePersistenceTimer=this.stalkerChasePersistenceDuration,this.stalkerIsInPersistentChase=!0}updateStalkerChasing(e){const t=this.stalkerPlayerRef.x,s=this.stalkerPlayerRef.y,i=this.y;this.y=this.stalkerOriginalY,Math.abs(i-this.stalkerOriginalY)>.1;const a=s<=this.y+40,o=s>=this.y-120,l=a&&o;if(this.stalkerIsInPersistentChase&&(this.stalkerChasePersistenceTimer-=e,this.stalkerChasePersistenceTimer<=0&&(this.stalkerIsInPersistentChase=!1)),l){this.stalkerCurrentSpeed+=this.stalkerSpeedIncrement*.01;const r=80*2.25;this.stalkerCurrentSpeed>r&&(this.stalkerCurrentSpeed=r);const n=t>this.x?1:-1;this.direction=n,this.setVelocityX(this.stalkerCurrentSpeed*n)}else if(this.stalkerIsInPersistentChase){const r=t>this.x?1:-1;this.direction=r,this.setVelocityX(this.stalkerCurrentSpeed*r*.7)}else this.updateRedPatrol()}updateStalkerEyeAnimations(e){if(!this.scene||!this.scene.textures.exists("stalkerEnemyEye1"))return;this.stalkerEyeAnimationTimer+=e;let t;if(this.stalkerEyeState==="blink"?t=100+Math.random()*80:t=1200+(Math.random()-.5)*800,this.stalkerEyeAnimationTimer>=t){const s=Math.random();if(this.stalkerEyeState==="blink"){const o=["eye1","eye2","eye3","eye4"];this.stalkerEyeState=o[Math.floor(Math.random()*4)]}else if(s<.2)this.stalkerEyeState="blink";else{const o=["eye1","eye2","eye3","eye4"];this.stalkerEyeState=o[Math.floor(Math.random()*4)]}const a={eye1:"stalkerEnemyEye1",eye2:"stalkerEnemyEye2",eye3:"stalkerEnemyEye3",eye4:"stalkerEnemyEye4",blink:"stalkerEnemyBlinking"}[this.stalkerEyeState];this.scene.textures.exists(a)&&this.setTexture(a),this.stalkerEyeAnimationTimer=0}}updateGreenEnemyAnimations(e){if(this.greenEyeTimer+=e,this.greenBlinkTimer+=e,this.nextGreenEyeTime===0&&(this.nextGreenEyeTime=1e3+Math.random()*2e3),this.nextGreenBlinkTime===0&&(this.nextGreenBlinkTime=3e3+Math.random()*4e3),this.greenBlinkTimer>=this.nextGreenBlinkTime){this.greenEnemyAnimationState="blinking",this.setTexture("greenEnemyBlink"),setTimeout(()=>{if(this.greenEnemyAnimationState==="blinking"){const t=["eyeRight","eyeCenter","eyeLeft"];this.greenEnemyAnimationState=t[Math.floor(Math.random()*t.length)],this.updateGreenEnemyTexture()}},100+Math.random()*50),this.greenBlinkTimer=0,this.nextGreenBlinkTime=3e3+Math.random()*4e3;return}if(this.greenEnemyAnimationState!=="blinking"&&this.greenEyeTimer>=this.nextGreenEyeTime){const t=this.greenEnemyAnimationState,i=["eyeRight","eyeCenter","eyeLeft"].filter(a=>a!==t);this.greenEnemyAnimationState=i[Math.floor(Math.random()*i.length)],this.updateGreenEnemyTexture(),this.greenEyeTimer=0,this.nextGreenEyeTime=800+Math.random()*1500}}updateGreenEnemyTexture(){let e="greenEnemy";switch(this.greenEnemyAnimationState){case"eyeRight":e="greenEnemy";break;case"eyeCenter":e="greenEnemyEyeCenter";break;case"eyeLeft":e="greenEnemyEyeLeft";break;case"blinking":e="greenEnemyBlink";break}this.scene&&this.scene.textures.exists(e)&&this.setTexture(e)}isBlueCaterpillarAnimationSprite(e){return["blueCaterpillarEyesRight","blueCaterpillarEyesLeft","blueCaterpillarEyesDown","blueCaterpillarBlinking"].includes(e)}initializeBlueCaterpillarAnimations(){this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500,this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.blueCaterpillarAnimationState="eyesDown"}updateBlueCaterpillarPatrol(e){if(!this.body||!this.body.enable)return;if(this.blueCaterpillarLastX||(this.blueCaterpillarLastX=this.x,this.blueCaterpillarStuckFrames=0),Math.abs(this.x-this.blueCaterpillarLastX)<.01){if(this.blueCaterpillarStuckFrames++,this.blueCaterpillarStuckFrames===60){this.replaceSelfWithYellowCaterpillar();return}}else this.blueCaterpillarStuckFrames=0;this.blueCaterpillarLastX=this.x,this.setVelocityX(this.moveSpeed*this.direction),this.blueCaterpillarVelocityCheckTimer||(this.blueCaterpillarVelocityCheckTimer=0),this.blueCaterpillarVelocityCheckTimer+=e,this.blueCaterpillarVelocityCheckTimer>500&&Math.abs(this.body.velocity.x)<5&&(this.blueCaterpillarVelocityCheckTimer=0),this.turnDelayTimer>0&&(this.turnDelayTimer-=e);const s=35;if(this.x<=this.platformBounds.left+s){if(this.turnDelayTimer<=0){this.direction=1,this.turnDelayTimer=100+Math.random()*200;const i=Math.max(this.platformBounds.left+s+5,this.x);this.setX(i),this.setVelocityX(this.moveSpeed*this.direction)}}else if(this.x>=this.platformBounds.right-s&&this.turnDelayTimer<=0){this.direction=-1,this.turnDelayTimer=100+Math.random()*200;const i=Math.min(this.platformBounds.right-s-5,this.x);this.setX(i),this.setVelocityX(this.moveSpeed*this.direction)}if(this.setVelocityX(this.moveSpeed*this.direction),this.x<this.platformBounds.left+5||this.x>this.platformBounds.right-5){const i=Math.max(this.platformBounds.left+10,Math.min(this.platformBounds.right-10,this.x));this.setX(i),this.direction*=-1,this.setVelocityX(this.moveSpeed*this.direction)}this.isBlueCaterpillarAnimationSprite(this.texture.key)&&this.setFlipX(this.direction===1)}updateBlueCaterpillarAnimations(e){if(!this.blueCaterpillarAnimationsEnabled){this.blueCaterpillarAnimationDelay-=e,this.blueCaterpillarAnimationDelay<=0&&(this.blueCaterpillarAnimationsEnabled=!0);return}if(!this.isBlueCaterpillarAnimationSprite(this.texture.key))return;if(this.blueCaterpillarBlinkTimer+=e,this.blueCaterpillarEyeTimer+=e,this.blueCaterpillarAnimationState==="blinking"&&this.blueCaterpillarBlinkTimer>=200&&(this.blueCaterpillarAnimationState="eyesDown",this.blueCaterpillarBlinkTimer=0,this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500),this.blueCaterpillarEyeTimer>=this.nextBlueCaterpillarEyeTime&&this.blueCaterpillarAnimationState!=="blinking"){const s=["eyesRight","eyesLeft","eyesDown"],a=(s.indexOf(this.blueCaterpillarAnimationState)+1)%s.length;this.blueCaterpillarAnimationState=s[a],this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.blueCaterpillarEyeTimer=0}this.blueCaterpillarBlinkTimer>=this.nextBlueCaterpillarBlinkTime&&this.blueCaterpillarAnimationState!=="blinking"&&(this.blueCaterpillarAnimationState="blinking",this.blueCaterpillarBlinkTimer=0);let t="blueCaterpillarEyesDown";switch(this.blueCaterpillarAnimationState){case"eyesRight":t="blueCaterpillarEyesRight";break;case"eyesLeft":t="blueCaterpillarEyesLeft";break;case"eyesDown":t="blueCaterpillarEyesDown";break;case"blinking":t="blueCaterpillarBlinking";break}this.texture.key!==t&&this.scene&&this.scene.textures.exists(t)&&this.setTexture(t)}}class ue extends Phaser.Physics.Arcade.Sprite{movementSpeed;direction;isPushing=!1;platform=null;platformLeft=0;platformRight=0;isStunned=!1;stunEndTime=0;eyeSprites=["baseblue-eyes-center","baseblue-eyes-down","baseblue-eyes-down-right","baseblue-eyes-middle-right","baseblue-eyes-up","baseblue-eyes-up-left","baseblue-eyes-middle-left","baseblue-eyes-down-left","baseblue-eyes-blinking"];currentEyeIndex=0;blinkTimer=0;nextBlinkTime=0;eyeMovementTimer=0;nextEyeMovementTime=0;isBlinking=!1;isRollingEyes=!1;eyeRollSequence=[];eyeRollIndex=0;constructor(e,t,s){super(e,t-15,s-8,"baseblue-eyes-center"),e.add.existing(this),e.physics.add.existing(this),this.setDisplaySize(48,48),this.setCollideWorldBounds(!1),this.setBounce(0),this.setGravityY(R.game.gravity),this.setSize(42,46);const i=this.body;i.setImmovable(!0),i.setMass(1e4),i.moves=!1,this.setOffset(20,19);const a=.9+Math.random()*.2;this.movementSpeed=20*a,this.direction=Math.random()<.5?-1:1,this.nextBlinkTime=Phaser.Math.Between(2e3,5e3),this.nextEyeMovementTime=Phaser.Math.Between(1e3,3e3),this.setDepth(15)}setPlatformBounds(e,t){this.platformLeft=e,this.platformRight=t}setInitialDirection(e){this.direction=e}update(e,t){if(this.body,this.isStunned&&e>=this.stunEndTime&&this.endStun(),!this.isStunned){if(!this.isPushing){this.x,this.direction,this.x<=this.platformLeft+16?(this.direction=1,this.x=this.platformLeft+16):this.x>=this.platformRight-16&&(this.direction=-1,this.x=this.platformRight-16);const s=this.movementSpeed*this.direction*t/1e3;this.x+=s,this.setFlipX(this.direction>0)}this.updateEyeAnimations(e,t)}}updateEyeAnimations(e,t){if(this.isRollingEyes&&this.eyeRollSequence.length>0){if(this.eyeMovementTimer+=t,this.eyeMovementTimer>=150)if(this.eyeMovementTimer=0,this.eyeRollIndex++,this.eyeRollIndex>=this.eyeRollSequence.length)this.isRollingEyes=!1,this.eyeRollSequence=[],this.eyeRollIndex=0,this.setTexture("baseblue-eyes-center");else{const s=this.eyeRollSequence[this.eyeRollIndex];this.setTexture(this.eyeSprites[s])}return}if(this.blinkTimer+=t,this.isBlinking?this.blinkTimer>=150&&(this.isBlinking=!1,this.blinkTimer=0,this.nextBlinkTime=Phaser.Math.Between(2e3,5e3),this.setTexture("baseblue-eyes-center")):this.blinkTimer>=this.nextBlinkTime&&(this.isBlinking=!0,this.blinkTimer=0,this.setTexture("baseblue-eyes-blinking")),!this.isBlinking&&(this.eyeMovementTimer+=t,this.eyeMovementTimer>=this.nextEyeMovementTime))if(this.eyeMovementTimer=0,this.nextEyeMovementTime=Phaser.Math.Between(1e3,3e3),Math.random()<.15)this.startEyeRoll();else{const s=Phaser.Math.Between(0,7);this.setTexture(this.eyeSprites[s])}}startEyeRoll(){this.isRollingEyes=!0,this.eyeRollIndex=0,this.eyeMovementTimer=0,this.eyeRollSequence=[4,3,3,2,1,7,6,5,4]}startPushing(){this.isPushing=!0}stopPushing(){this.isPushing=!1}startStun(){this.isStunned||this.scene&&(this.isStunned=!0,this.stunEndTime=this.scene.time.now+2e3,this.setTexture("baseblue-eyes-blinking"))}endStun(){this.isStunned=!1,this.setTexture("baseblue-eyes-center")}handlePlayerBounce(){}canBeKilledByInvinciblePlayer(){return!0}handleInvinciblePlayerKill(){return this.squish(),1e3}squish(){this.scene&&this.scene.tweens.add({targets:this,scaleY:.3,scaleX:1.2,alpha:.8,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.baseBlus&&this.scene.baseBlus.remove(this),this.destroy()}})}isPlayerColliding(e){const t=e.getBounds(),s=this.getBounds(),i=Math.min(t.bottom,s.bottom)-Math.max(t.top,s.top),a=Math.min(t.right,s.right)-Math.max(t.left,s.left);return i>0&&a>0&&i<s.height*.5?!1:a>0&&i>0}destroy(){super.destroy()}}class pe extends Phaser.Physics.Arcade.Sprite{moveSpeed;direction;platformBounds;animationTimer=0;currentFrame=0;animationFrames=["beetle-mouth-closed","beetle-mouth-open-30","beetle-mouth-open-70","beetle-mouth-open-30"];totalRotation=0;rotationFactor=.004;isRolling=!0;isBiting=!1;nextActionDistance=0;distanceTraveled=0;biteAnimationTimer=0;biteDuration=1200;isSquished=!1;constructor(e,t,s,i,a){const o=e.textures.exists("beetle-mouth-closed")?"beetle-mouth-closed":"beetle";if(!e.textures.exists("beetle-mouth-closed")){const y=e.add.graphics();y.fillStyle(16711680,1),y.fillRect(0,0,20,16),y.generateTexture("beetle",20,16),y.destroy()}super(e,t,s,o),e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0),this.setBounce(0);const l=45;this.setDisplaySize(l,l);const r=19,n=this.texture.get().width,c=this.texture.get().height,h=l/n,d=l/c,u=(h+d)/2,g=r/u;if(this.body instanceof Phaser.Physics.Arcade.Body){this.body.setCircle(g);const y=(l-r*2)/2,f=y/u,m=y/u;this.body.setOffset(f,m),console.log("🪲 BEETLE CIRCULAR HITBOX:"),console.log("  Circle diameter:",r*2,"px (38px as requested)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",l,"x",l),console.log("  Centering offset:",f,",",m,"(texture space)"),console.log("  Visual sprite centered on hitbox: ✅")}this.setDepth(15),this.platformBounds={left:i,right:a};const b=.9+Math.random()*.2;this.moveSpeed=80*b,this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction),this.nextActionDistance=100+Math.random()*200}update(e,t){if(t)if(this.x<=this.platformBounds.left+10?this.direction=1:this.x>=this.platformBounds.right-10&&(this.direction=-1),this.isRolling){this.setVelocityX(this.moveSpeed*this.direction),this.distanceTraveled+=Math.abs(this.moveSpeed*this.direction*(t/1e3));const s=this.moveSpeed*this.rotationFactor;this.totalRotation+=s*this.direction,this.setRotation(this.totalRotation),this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed"),this.distanceTraveled>=this.nextActionDistance&&this.startBiting()}else this.isBiting&&(this.setVelocityX(0),this.biteAnimationTimer+=t,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.animateBiting(t),this.biteAnimationTimer>=this.biteDuration&&this.startRolling())}startBiting(){this.isRolling=!1,this.isBiting=!0,this.biteAnimationTimer=0,this.currentFrame=0,this.animationTimer=0,this.setRotation(0),this.totalRotation=0}startRolling(){this.isRolling=!0,this.isBiting=!1,this.distanceTraveled=0,this.nextActionDistance=50+Math.random()*200,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed")}animateBiting(e){if(this.animationTimer+=e,this.animationTimer>=300){this.animationTimer=0,this.currentFrame=(this.currentFrame+1)%this.animationFrames.length;const t=this.animationFrames[this.currentFrame];this.scene&&this.scene.textures.exists(t)&&this.setTexture(t)}}reverseDirection(){this.direction*=-1,this.isRolling&&this.setVelocityX(this.moveSpeed*this.direction)}getDirection(){return this.direction}squish(){this.isSquished||(this.isSquished=!0,this.setVelocity(0,0),this.isRolling=!1,this.isBiting=!1,this.body&&(this.body.enable=!1),this.setRotation(0),this.totalRotation=0,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed"),this.scene&&this.scene.tweens.add({targets:this,scaleY:.2,scaleX:1.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.beetles&&this.scene.beetles.remove(this),this.destroy()}}))}}class ge extends Phaser.Physics.Arcade.Sprite{baseMoveSpeed=60;moveSpeed=60;speedMultiplier=1;direction=1;bounceTimer=0;isSquishing=!1;isStretching=!1;isInAir=!1;isSquished=!1;blinkTimer=0;nextBlinkTime=2e3;isBlinking=!1;blinkDuration=150;platformBounds;constructor(e,t,s,i,a){super(e,t,s,"rexEyesOpen"),e.add.existing(this),e.physics.add.existing(this);const o=40;this.setDisplaySize(o,o),this.setOrigin(.5,.5);const l=18,r=this.texture.get().width,n=this.texture.get().height,c=o/r,h=o/n,d=(c+h)/2,u=l/d;if(this.body instanceof Phaser.Physics.Arcade.Body){this.body.setCircle(u);const g=u*2,b=(r-g)/2,y=(n-g)/2;this.body.setOffset(b,y),this.body.setCollideWorldBounds(!0),this.body.setBounce(0),this.body.setAllowGravity(!0),this.body.setGravityY(0),console.log("🦖 REX ENEMY CREATED:"),console.log("  Display size:",o,"x",o),console.log("  Circle diameter:",l*2,"px"),console.log("  Body is circular:",this.body.isCircle),console.log("  Move speed:",this.moveSpeed)}this.setDepth(15),this.platformBounds={left:i,right:a},this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction),this.nextBlinkTime=Math.random()*2e3+1e3,this.bounceTimer=1e3+Math.random()*1e3}update(e,t){if(this.bounceTimer-=t,this.blinkTimer+=t,this.body instanceof Phaser.Physics.Arcade.Body){const s=this.body.touching.down||this.body.blocked.down;if(s&&this.isInAir?(this.onLanding(),this.isInAir=!1):!s&&!this.isInAir&&(this.isInAir=!0),this.bounceTimer<=0&&s&&!this.isSquishing&&(this.startBounce(),this.bounceTimer=1500+Math.random()*1500),s&&!this.isInAir&&!this.isSquishing&&!this.isStretching&&this.updateBlinking(),this.isInAir&&!s)this.rotation+=.008*t*this.direction,this.texture.key!=="rexBlinking"&&this.setTexture("rexBlinking");else if(s){if(Math.abs(this.rotation)>.1){const i=Math.round(this.rotation/(Math.PI*2))*Math.PI*2;this.rotation=Phaser.Math.Linear(this.rotation,i,.3)}else this.rotation=0;this.texture.key==="rexBlinking"&&!this.isBlinking&&this.setTexture("rexEyesOpen")}this.x<=this.platformBounds.left+20?(this.direction=1,this.setVelocityX(this.moveSpeed*this.direction)):this.x>=this.platformBounds.right-20?(this.direction=-1,this.setVelocityX(this.moveSpeed*this.direction)):this.setVelocityX(this.moveSpeed*this.direction)}}startBounce(){this.setVelocityY(-175),this.isStretching=!1}onLanding(){this.isSquishing=!1}updateBlinking(){this.isBlinking?this.blinkTimer>=this.blinkDuration&&(this.isBlinking=!1,this.setTexture("rexEyesOpen"),this.blinkTimer=0,this.nextBlinkTime=1e3+Math.random()*3e3):this.blinkTimer>=this.nextBlinkTime&&(this.isBlinking=!0,this.setTexture("rexBlinking"),this.blinkTimer=0)}setSpeedMultiplier(e){this.speedMultiplier=e,this.moveSpeed=this.baseMoveSpeed*e}squish(){if(this.isSquished)return;this.isSquished=!0,this.setVelocity(0,0),this.body&&(this.body.enable=!1),this.scene.tweens.killTweensOf(this);const e=12;for(let t=0;t<e;t++){const s=this.scene.add.graphics();s.fillStyle(9498256,1),s.fillCircle(0,0,3),s.x=this.x,s.y=this.y;const i=Math.PI*2*t/e+(Math.random()-.5)*.5,a=100+Math.random()*100,o=Math.cos(i)*a,l=Math.sin(i)*a-50;this.scene.tweens.add({targets:s,x:s.x+o*.5,y:s.y+l*.5,alpha:0,scale:.5,duration:500,ease:"Power2",onComplete:()=>{s.destroy()}})}this.scene.tweens.add({targets:this,alpha:0,scale:.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.rexEnemies&&this.scene.rexEnemies.remove(this),this.destroy()}})}}class oe{sprite;scene;collected=!1;sparkleTimer;constructor(e,t,s){this.scene=e;const i=s-5;this.sprite=e.add.container(t,i);const a=["gem-pink-round","gem-yellow-emerald","gem-purple-opal","gem-teal-triangle"],o=a[Math.floor(Math.random()*a.length)],l=e.add.image(0,0,o);if(l.setDisplaySize(16,16),this.sprite.add(l),this.sprite.setDepth(12),this.sparkleTimer=e.time.addEvent({delay:800+Math.random()*400,callback:()=>this.createSparkle(),loop:!0}),e.physics.add.existing(this.sprite,!0),this.sprite.body){const r=this.sprite.body;r.setSize(16,16),r.setOffset(24,24)}e.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;const e=this.scene.add.graphics(),t=(Math.random()-.5)*16,s=(Math.random()-.5)*16;e.fillStyle(16777215,.9),e.beginPath();for(let a=0;a<8;a++){const o=a/8*Math.PI*2,l=a%2===0?2:1,r=Math.cos(o)*l,n=Math.sin(o)*l;a===0?e.moveTo(r,n):e.lineTo(r,n)}e.closePath(),e.fillPath();const i=this.scene.add.container(this.sprite.x+t,this.sprite.y+s);i.add(e),i.setDepth(13),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:1.5,scaleY:1.5,alpha:0,duration:200,onComplete:()=>{this.sprite.destroy()}}))}isCollected(){return this.collected}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}}class le{sprite;scene;collected=!1;sparkleTimer;constructor(e,t,s){this.scene=e;const i=s-5;this.sprite=e.add.container(t,i);const o=e.add.image(0,0,"gem-big-blue");if(o.setDisplaySize(22,22),this.sprite.add(o),this.sprite.setDepth(12),this.sparkleTimer=e.time.addEvent({delay:600+Math.random()*300,callback:()=>this.createSparkle(),loop:!0}),e.physics.add.existing(this.sprite,!0),this.sprite.body){const l=this.sprite.body;l.setSize(20,20),l.setOffset(22,22)}e.tweens.add({targets:this.sprite,scaleX:1.3,scaleY:1.3,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;const e=this.scene.add.graphics(),t=(Math.random()-.5)*20,s=(Math.random()-.5)*20;e.fillStyle(65535,.9),e.beginPath();for(let a=0;a<8;a++){const o=a/8*Math.PI*2,l=a%2===0?2:1,r=Math.cos(o)*l,n=Math.sin(o)*l;a===0?e.moveTo(r,n):e.lineTo(r,n)}e.closePath(),e.fillPath();const i=this.scene.add.container(this.sprite.x+t,this.sprite.y+s);i.add(e),i.setDepth(13),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2,scaleY:2,alpha:0,duration:300,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}}class re{sprite;diamondSprite;scene;collected=!1;sparkleTimer;constructor(e,t,s){this.scene=e;const i=s-5;if(this.sprite=e.add.container(t,i),this.diamondSprite=e.add.image(0,0,"gem-diamond"),this.diamondSprite.setDisplaySize(29,29),this.sprite.add(this.diamondSprite),this.sprite.setDepth(13),e.physics.add.existing(this.sprite,!0),this.sprite.body){const a=this.sprite.body;a.setSize(29,29),a.setOffset(10,10)}e.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.sparkleTimer=e.time.addEvent({delay:400+Math.random()*200,callback:()=>this.createSparkle(),loop:!0})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;const e=this.scene.add.graphics(),t=(Math.random()-.5)*30,s=(Math.random()-.5)*30;e.fillStyle(16777215,.9),e.beginPath();for(let a=0;a<8;a++){const o=a/8*Math.PI*2,l=a%2===0?2:1,r=Math.cos(o)*l,n=Math.sin(o)*l;a===0?e.moveTo(r,n):e.lineTo(r,n)}e.closePath(),e.fillPath();const i=this.scene.add.container(this.sprite.x+t,this.sprite.y+s);i.add(e),i.setDepth(14),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2.5,scaleY:2.5,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}}class ne{sprite;heartSprite;scene;collected=!1;sparkleTimer;constructor(e,t,s){this.scene=e;const i=s-5;if(this.sprite=e.add.container(t,i),this.heartSprite=e.add.image(0,0,"heart-crystal"),this.heartSprite.setDisplaySize(29,29),this.sprite.add(this.heartSprite),this.sprite.setDepth(13),e.physics.add.existing(this.sprite,!0),this.sprite.body){const a=this.sprite.body;a.setSize(29,29),a.setOffset(10,10)}e.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.sparkleTimer=e.time.addEvent({delay:400+Math.random()*200,callback:()=>this.createSparkle(),loop:!0})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;const e=this.scene.add.graphics(),t=(Math.random()-.5)*30,s=(Math.random()-.5)*30;e.fillStyle(16738740,.9),e.beginPath();for(let a=0;a<8;a++){const o=a/8*Math.PI*2,l=a%2===0?2:1,r=Math.cos(o)*l,n=Math.sin(o)*l;a===0?e.moveTo(r,n):e.lineTo(r,n)}e.closePath(),e.fillPath();const i=this.scene.add.container(this.sprite.x+t,this.sprite.y+s);i.add(e),i.setDepth(14),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2.5,scaleY:2.5,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}}class be{sprite;scene;collected=!1;sparkleTimer;aura=null;particles=[];debugHitbox=null;constructor(e,t,s){this.scene=e;const i=s-5;this.sprite=e.add.image(t,i,"invincibility-pendant"),this.sprite.setDisplaySize(29,29),this.sprite.setDepth(13),e.physics.add.existing(this.sprite,!0),e.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createGoldenAura(t,i),this.sparkleTimer=e.time.addEvent({delay:300+Math.random()*200,callback:()=>this.createSparkle(),loop:!0}),this.createFloatingParticles(t,i)}createGoldenAura(e,t){this.aura=this.scene.add.circle(e,t,25,16766720),this.aura.setAlpha(.2),this.aura.setDepth(12),this.scene.tweens.add({targets:this.aura,scaleX:1.3,scaleY:1.3,alpha:.4,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createFloatingParticles(e,t){for(let s=0;s<6;s++){const i=this.scene.add.graphics();i.setDepth(14),i.fillStyle(16766720,.8),i.fillCircle(0,0,2);const a=Math.PI*2/6*s,o=20;i.setPosition(e+Math.cos(a)*o,t+Math.sin(a)*o),this.particles.push(i),this.scene.tweens.add({targets:i,rotation:Math.PI*2,duration:3e3,repeat:-1,ease:"Linear"}),this.scene.tweens.add({targets:i,y:i.y-8,duration:1500+Math.random()*500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.scene.tweens.add({targets:i,alpha:.3,duration:800+Math.random()*400,yoyo:!0,repeat:-1,ease:"Power2.easeInOut"})}}createSparkle(){if(!this.sprite||!this.sprite.scene)return;const e=this.scene.add.graphics(),t=(Math.random()-.5)*35,s=(Math.random()-.5)*35;e.fillStyle(16766720,.9),e.beginPath();for(let a=0;a<8;a++){const o=a/8*Math.PI*2,l=a%2===0?3:1.5,r=Math.cos(o)*l,n=Math.sin(o)*l;a===0?e.moveTo(r,n):e.lineTo(r,n)}e.closePath(),e.fillPath();const i=this.scene.add.container(this.sprite.x+t,this.sprite.y+s);i.add(e),i.setDepth(15),this.scene.tweens.add({targets:i,scaleX:2,scaleY:2,alpha:0,rotation:Math.PI,duration:600,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.aura&&(this.aura.destroy(),this.aura=null),this.particles.forEach(e=>e.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:3,scaleY:3,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}),this.createCollectionBurst())}createCollectionBurst(){for(let t=0;t<20;t++){const s=this.scene.add.circle(this.sprite.x+(Math.random()-.5)*15,this.sprite.y-10,Math.random()*4+2,16766720);s.setDepth(50);const i=Math.PI*2/20*t+(Math.random()-.5)*.8,a=Math.random()*120+80;this.scene.tweens.add({targets:s,x:s.x+Math.cos(i)*a,y:s.y+Math.sin(i)*a-40,alpha:0,scaleX:.1,scaleY:.1,duration:1200,ease:"Power2.easeOut",onComplete:()=>s.destroy()})}const e=this.scene.add.circle(this.sprite.x,this.sprite.y,50,16766720);e.setDepth(49),e.setAlpha(.9),this.scene.tweens.add({targets:e,scaleX:2.5,scaleY:2.5,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>e.destroy()})}createDebugHitbox(e,t){this.debugHitbox=this.scene.add.graphics(),this.debugHitbox.setDepth(999),this.debugHitbox.lineStyle(2,65280,.8),this.debugHitbox.strokeRect(e-14.5,t-14.5,29,29),this.debugHitbox.fillStyle(16711680,1),this.debugHitbox.fillCircle(e,t,2);const s=this.scene.add.text(e,t-35,"PENDANT\\n29x29",{fontSize:"8px",color:"#00ff00",fontFamily:"monospace",align:"center",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:2,y:1}}).setOrigin(.5).setDepth(1e3);this.debugHitbox.setData("debugText",s)}destroy(){if(this.sparkleTimer&&this.sparkleTimer.destroy(),this.aura&&this.aura.destroy(),this.particles.forEach(e=>e.destroy()),this.debugHitbox){const e=this.debugHitbox.getData("debugText");e&&e.destroy(),this.debugHitbox.destroy()}this.sprite.destroy()}}class ye{sprite;scene;isOpened=!1;glowEffect=null;debugHitbox=null;chestTier;constructor(e,t,s){this.scene=e,this.chestTier=this.selectRandomChestTier();const i=this.getSpriteKeyForTier(this.chestTier);this.sprite=e.add.sprite(t,s-4,i),this.sprite.setDisplaySize(60,60),this.sprite.setDepth(13),e.physics.add.existing(this.sprite,!0);const a=this.sprite.body;a.setSize(40,30),a.setOffset(-20,-11),this.createGlowEffect(t,s-4,this.chestTier)}selectRandomChestTier(){const e=Math.random();return e<.6?"purple":e<.9?"teal":"yellow"}getSpriteKeyForTier(e){switch(e){case"purple":return"purple-chest";case"teal":return"teal-chest";case"yellow":return"yellow-chest"}}getGlowColorForTier(e){switch(e){case"purple":return 10040012;case"teal":return 35723;case"yellow":return 16766720}}createGlowEffect(e,t,s){const i=this.getGlowColorForTier(s);this.glowEffect=this.scene.add.circle(e,t,18,i),this.glowEffect.setAlpha(.15),this.glowEffect.setDepth(12),this.scene.tweens.add({targets:this.glowEffect,alpha:.05,scaleX:1.2,scaleY:1.2,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}canInteract(){return!this.isOpened}open(){if(this.isOpened)return{coins:0,blueCoins:0,diamonds:0,freeLifes:0,invincibilityPendants:0,totalPoints:0};this.isOpened=!0,this.sprite.setTint(8421504),this.glowEffect&&(this.glowEffect.destroy(),this.glowEffect=null),this.scene.tweens.add({targets:this.sprite,scaleX:1.2,scaleY:1.2,duration:200,ease:"Back.easeOut",yoyo:!0});const e=this.generateRewardsByTier(this.chestTier);let t=2500;return t+=e.coins*50,t+=e.blueCoins*500,t+=e.diamonds*1e3,t+=e.freeLifes*2e3,t+=e.invincibilityPendants*300,this.createTreasureBurstEffect(),{coins:e.coins,blueCoins:e.blueCoins,diamonds:e.diamonds,freeLifes:e.freeLifes,invincibilityPendants:e.invincibilityPendants,totalPoints:t}}generateRewardsByTier(e){const t={coins:0,blueCoins:0,diamonds:0,freeLifes:0};switch(e){case"purple":t.coins=Math.floor(Math.random()*3)+2,Math.random()<.1&&(t.freeLifes=1);break;case"teal":t.blueCoins=Math.floor(Math.random()*2)+1,t.coins=Math.floor(Math.random()*2)+1,Math.random()<.25&&(Math.random()<.7,t.freeLifes=1);break;case"yellow":t.coins=Math.floor(Math.random()*2)+2,Math.random()<.8,t.freeLifes=1;break}return t}createTreasureBurstEffect(){for(let t=0;t<15;t++){const s=this.scene.add.circle(this.sprite.x+(Math.random()-.5)*10,this.sprite.y-5,Math.random()*3+2,16766720);s.setDepth(50);const i=Math.PI*2/15*t+(Math.random()-.5)*.5,a=Math.random()*100+50;this.scene.tweens.add({targets:s,x:s.x+Math.cos(i)*a,y:s.y+Math.sin(i)*a-30,alpha:0,scaleX:.1,scaleY:.1,duration:1e3,ease:"Power2.easeOut",onComplete:()=>s.destroy()})}const e=this.scene.add.circle(this.sprite.x,this.sprite.y,40,16777215);e.setDepth(49),e.setAlpha(.8),this.scene.tweens.add({targets:e,scaleX:2,scaleY:2,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>e.destroy()})}createDebugHitbox(e,t){this.debugHitbox=this.scene.add.graphics(),this.debugHitbox.setDepth(999),this.debugHitbox.lineStyle(2,65280,.8),this.debugHitbox.strokeRect(e-20,t-15,40,30),this.debugHitbox.fillStyle(16711680,1),this.debugHitbox.fillCircle(e,t,2);const s=this.scene.add.text(e,t-35,`CHEST
40x30`,{fontSize:"8px",color:"#00ff00",fontFamily:"monospace",align:"center",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:2,y:1}}).setOrigin(.5).setDepth(1e3);this.debugHitbox.setData("debugText",s)}destroy(){if(this.sprite.destroy(),this.glowEffect&&this.glowEffect.destroy(),this.debugHitbox){const e=this.debugHitbox.getData("debugText");e&&e.destroy(),this.debugHitbox.destroy()}}}class Oe{sprite;scene;collected=!1;glowGraphics;particleTimer;particles=[];constructor(e,t,s){this.scene=e;const i=s-5;this.sprite=e.add.container(t,i),this.glowGraphics=e.add.graphics(),this.createGlowEffect(),this.sprite.add(this.glowGraphics);const a=e.add.image(0,0,"crystalBallCollectible");if(a.setDisplaySize(20,20),this.sprite.add(a),this.sprite.setDepth(12),this.particleTimer=e.time.addEvent({delay:200,callback:()=>this.createParticle(),loop:!0}),e.physics.add.existing(this.sprite,!0),this.sprite.body){const o=this.sprite.body;o.setSize(20,20),o.setOffset(22,22)}e.tweens.add({targets:this.glowGraphics,alpha:.3,scaleX:1.2,scaleY:1.2,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this.sprite,y:i-8,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:a,rotation:Math.PI*2,duration:8e3,repeat:-1,ease:"Linear"})}createGlowEffect(){for(let t=3;t>0;t--)this.glowGraphics.fillStyle(4509863,.1*t),this.glowGraphics.fillCircle(0,0,15+(3-t)*5)}createParticle(){if(!this.sprite||!this.sprite.scene||this.collected)return;const e=this.scene.add.graphics();e.fillStyle(4509863,1),e.fillRect(0,0,2,2);const t=Math.random()*Math.PI*2,s=15+Math.random()*10,i=this.sprite.x+Math.cos(t)*s,a=this.sprite.y+Math.sin(t)*s;e.x=i,e.y=a,e.setDepth(11),this.particles.push(e),this.scene.tweens.add({targets:e,y:a-30,alpha:0,duration:1500,ease:"Power2.easeOut",onComplete:()=>{const o=this.particles.indexOf(e);o>-1&&this.particles.splice(o,1),e.destroy()}})}collect(){if(!this.collected){this.collected=!0,this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(e=>e.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1);for(let e=0;e<8;e++){const t=this.scene.add.graphics();t.fillStyle(4509863,1),t.fillRect(0,0,3,3);const s=e/8*Math.PI*2;t.x=this.sprite.x,t.y=this.sprite.y,t.setDepth(13),this.scene.tweens.add({targets:t,x:this.sprite.x+Math.cos(s)*40,y:this.sprite.y+Math.sin(s)*40,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>{t.destroy()}})}this.scene.tweens.add({targets:this.sprite,scaleX:1.5,scaleY:1.5,alpha:0,duration:200,onComplete:()=>{this.sprite.destroy()}})}}isCollected(){return this.collected}destroy(){this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(e=>e.destroy()),this.sprite.destroy()}}class Le extends Phaser.Physics.Arcade.Sprite{bounceCount=0;MAX_BOUNCES=5;BASE_BOUNCE_HEIGHT=32;distanceTraveled=0;MAX_DISTANCE=5*R.game.tileSize;direction=1;glowGraphics;rotationTween;constructor(e,t,s,i,a=0){super(e,t,s,"crystalBallProjectile"),this.direction=i,e.add.existing(this),e.physics.add.existing(this),this.setDisplaySize(16,16),this.setSize(12,12),this.setDepth(15);const o=250,r=(o+Math.abs(a*.8))*i;this.setVelocity(r,-120),console.log("🔫 Projectile velocity compensation: base =",o,"player =",a,"final =",r),this.setGravityY(400),this.setCollideWorldBounds(!0),this.body.onWorldBounds=!0,this.glowGraphics=e.add.graphics(),this.glowGraphics.setDepth(14),this.glowGraphics.fillStyle(4509863,.3),this.glowGraphics.fillCircle(0,0,12),this.glowGraphics.fillStyle(4509863,.2),this.glowGraphics.fillCircle(0,0,18),this.glowGraphics.x=t,this.glowGraphics.y=s,this.scene.events.on("update",this.updateGlow,this),this.rotationTween=e.tweens.add({targets:this,rotation:Math.PI*2*i,duration:500,repeat:-1,ease:"Linear"})}updateGlow(){this.active&&this.glowGraphics&&(this.glowGraphics.x=this.x,this.glowGraphics.y=this.y)}update(e,t){if(super.update(e,t),!this.body){console.log("🔫 Crystal Ball projectile body missing - destroying"),this.burst();return}const s=this.body;if(this.distanceTraveled+=Math.abs(s.velocity.x)*t/1e3,this.distanceTraveled>=this.MAX_DISTANCE){console.log("🔫 Crystal Ball projectile hit max distance - bursting"),this.burst();return}s.blocked.down&&(console.log("🔫 Crystal Ball projectile hit floor - bouncing"),this.handleBounce()),(s.blocked.left||s.blocked.right)&&(console.log("🔫 Crystal Ball projectile hit wall - bursting"),this.burst())}handleBounce(){if(this.bounceCount++,this.scene.registry.get("sfxEnabled")!==!1&&this.scene.sound.play("crystal-ball-bounce",{volume:.4}),this.bounceCount>=this.MAX_BOUNCES){console.log("🔫 Crystal Ball projectile max bounces reached - bursting"),this.burst();return}if(!this.body){console.log("🔫 Crystal Ball projectile body missing during bounce - bursting"),this.burst();return}const t=this.body,s=Math.pow(.8,this.bounceCount-1),i=this.BASE_BOUNCE_HEIGHT*s,a=t.gravity.y||400,o=-Math.sqrt(2*a*i);console.log("🔫 Bounce",this.bounceCount,"height:",i.toFixed(1),"velocity:",o.toFixed(1)),this.setVelocityY(o),this.setVelocityX(250*this.direction),this.createBounceEffect(),console.log("🔫 Crystal Ball projectile bounced",this.bounceCount,"times")}createBounceEffect(){if(this.scene)for(let e=0;e<3;e++){const t=this.scene.add.graphics();t.fillStyle(4509863,1),t.fillCircle(0,0,1),t.x=this.x+(Math.random()-.5)*10,t.y=this.y+5,t.setDepth(14),this.scene.tweens.add({targets:t,y:t.y-10,alpha:0,duration:200,onComplete:()=>t.destroy()})}}hitEnemy(){this.burst()}burst(){if(this.scene){this.scene.events.off("update",this.updateGlow,this),this.rotationTween&&(this.rotationTween.stop(),this.rotationTween=void 0);for(let e=0;e<8;e++){const t=this.scene.add.graphics();t.fillStyle(4509863,1),t.fillCircle(0,0,2);const s=e/8*Math.PI*2;t.x=this.x,t.y=this.y,t.setDepth(15);const i=20+Math.random()*10;this.scene.tweens.add({targets:t,x:this.x+Math.cos(s)*i,y:this.y+Math.sin(s)*i,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>t.destroy()})}this.glowGraphics&&(this.glowGraphics.destroy(),this.glowGraphics=void 0),this.destroy()}}}class me{sprite;scene;collected=!1;glowGraphics;particleTimer;particles=[];orbType;glowColor;constructor(e,t,s,i){this.scene=e,this.orbType=i,this.glowColor=i==="cursed"?5768769:4827036;const a=s-5;this.sprite=e.add.container(t,a),this.glowGraphics=e.add.graphics(),this.createGlowEffect(),this.sprite.add(this.glowGraphics);const o=i==="cursed"?"cursedOrbCollectible":"cursedTealOrbCollectible",l=e.add.image(0,0,o);if(l.setDisplaySize(20,20),this.sprite.add(l),this.sprite.setDepth(12),this.particleTimer=e.time.addEvent({delay:250,callback:()=>this.createParticle(),loop:!0}),e.physics.add.existing(this.sprite,!0),this.sprite.body){const r=this.sprite.body;r.setSize(20,20),r.setOffset(22,22)}e.tweens.add({targets:this.glowGraphics,alpha:.2,scaleX:1.3,scaleY:1.3,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this.sprite,y:a-6,duration:2500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:l,rotation:-Math.PI*2,duration:1e4,repeat:-1,ease:"Linear"})}createGlowEffect(){const e=this.glowColor;for(let t=4;t>0;t--)this.glowGraphics.fillStyle(e,.08*t),this.glowGraphics.fillCircle(0,0,12+(4-t)*6)}createParticle(){if(!this.sprite||!this.sprite.scene||this.collected)return;const e=this.scene.add.graphics();e.fillStyle(this.glowColor,1),e.fillRect(0,0,2,2);const t=Math.random()*Math.PI*2,s=20+Math.random()*12,i=this.sprite.x+Math.cos(t)*s,a=this.sprite.y+Math.sin(t)*s;e.x=i,e.y=a,e.setDepth(11),this.particles.push(e),this.scene.tweens.add({targets:e,y:a+35,x:i+(Math.random()-.5)*20,alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{const o=this.particles.indexOf(e);o>-1&&this.particles.splice(o,1),e.destroy()}})}collect(){if(!this.collected){this.collected=!0,this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(e=>e.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1);for(let e=0;e<12;e++){const t=this.scene.add.graphics();t.fillStyle(this.glowColor,1),t.fillRect(0,0,3,3);const s=e/12*Math.PI*2;t.x=this.sprite.x,t.y=this.sprite.y,t.setDepth(13),this.scene.tweens.add({targets:t,x:this.sprite.x+Math.cos(s)*50,y:this.sprite.y+Math.sin(s)*50,alpha:0,duration:600,ease:"Power2.easeOut",onComplete:()=>{t.destroy()}})}this.scene.tweens.add({targets:this.sprite,scaleX:1.3,scaleY:1.3,alpha:0,duration:300,onComplete:()=>{this.sprite.destroy()}})}}isCollected(){return this.collected}getType(){return this.orbType}destroy(){this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(e=>e.destroy()),this.sprite.destroy()}}class Ie{scene;enabled=!0;isMobileDevice=!1;touchpadContainer;touchpadBackground;touchpadIndicator;touchPosition=null;jumpButton;jumpButtonImage;jumpButtonText;actionButton;actionButtonImage;actionButtonCircle;actionButtonText;horizontalInput=0;verticalInput=0;upPressed=!1;downPressed=!1;leftPressed=!1;rightPressed=!1;jumpPressed=!1;jumpJustPressed=!1;actionPressed=!1;actionJustPressed=!1;lastJumpState=!1;lastActionState=!1;touchpadPointerId=-1;jumpPointerId=-1;actionPointerId=-1;touchpadCenter;touchpadRadius=110;deadZone=5;constructor(e){this.scene=e;const t=this.scene.game.config.height;this.touchpadCenter={x:120,y:t-120},this.detectMobileDevice(),this.createTouchpad(),this.createJumpButton(),this.createActionButton(),this.setupInputHandlers()}detectMobileDevice(){const e="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),i=window.innerWidth<=768;this.isMobileDevice=e&&(s||i);const o=window.game?.registry?.get("isDgen1")||!1;console.log("🎮 Touch Controls Detection:",{isTouchDevice:e,isMobileUA:s,isSmallScreen:i,isMobileDevice:this.isMobileDevice,enableForTesting:o,finalEnabled:this.isMobileDevice||o}),o&&(this.isMobileDevice=!0,console.log("⚠️ Touch controls enabled for desktop testing"))}createTouchpad(){this.touchpadContainer=this.scene.add.container(this.touchpadCenter.x,this.touchpadCenter.y),this.touchpadContainer.setDepth(1e3),this.touchpadContainer.setScrollFactor(0),this.touchpadBackground=this.scene.add.image(0,0,"custom-dpad");const e=this.touchpadRadius-10;this.touchpadBackground.setDisplaySize(e*2,e*2),this.touchpadContainer.add(this.touchpadBackground),this.touchpadIndicator=this.scene.add.circle(0,0,8,16716947,.9),this.touchpadIndicator.setStrokeStyle(2,16777215,.9),this.touchpadIndicator.setVisible(!1),this.touchpadContainer.add(this.touchpadIndicator)}createJumpButton(){console.log("🎮 Jump Button Canvas Check:",{GameSettingsWidth:R.canvas.width,GameSettingsHeight:R.canvas.height,SceneWidth:this.scene.cameras.main.width,SceneHeight:this.scene.cameras.main.height,GameWidth:this.scene.game.config.width,GameHeight:this.scene.game.config.height});const e=this.scene.game.config.width,t=this.scene.game.config.height,s=620,i=t-120;console.log("🎯 Jump Button Position:",{buttonX:s,buttonY:i,actualCanvasWidth:e}),this.jumpButton=this.scene.add.container(s,i),this.jumpButton.setDepth(1e3),this.jumpButton.setScrollFactor(0),this.jumpButtonImage=this.scene.add.image(0,0,"custom-jump-button"),this.jumpButtonImage.setDisplaySize(80,80),this.jumpButton.add([this.jumpButtonImage])}createActionButton(){const e=this.scene.game.config.height,t=445,s=e-120;this.actionButton=this.scene.add.container(t,s),this.actionButton.setDepth(1e3),this.actionButton.setScrollFactor(0),this.actionButton.setVisible(!0),this.actionButtonImage=this.scene.add.image(0,0,"custom-action-button"),this.actionButtonImage.setDisplaySize(80,80),this.actionButton.add([this.actionButtonImage])}setupInputHandlers(){const e=new Set;this.scene.input.on("pointerdown",t=>{e.add(t.id),this.handlePointerDown(t)}),this.scene.input.on("pointermove",t=>{e.has(t.id)&&this.handlePointerMove(t)}),this.scene.input.on("pointerup",t=>{e.delete(t.id),this.handlePointerUp(t)})}handlePointerDown(e){if(!this.enabled)return;if(!this.isMobileDevice){console.log("❌ Touch controls disabled - not mobile device");return}console.log("👆 Pointer down:",{x:e.x,y:e.y,id:e.id,enabled:this.enabled,isMobile:this.isMobileDevice});const t=e.x,s=e.y,i=Math.sqrt(Math.pow(t-this.touchpadCenter.x,2)+Math.pow(s-this.touchpadCenter.y,2));if(console.log("🎯 Touchpad check:",{distance:i,threshold:110,center:this.touchpadCenter,touch:{x:t,y:s}}),i<=110&&this.touchpadPointerId===-1){console.log("✅ Touchpad activated"),this.touchpadPointerId=e.id,this.updateTouchpadFromPosition(t,s),this.touchpadIndicator.setVisible(!0),this.forceUpdate();return}const a=620,o=a-87.5,l=a+87.5,n=this.scene.game.config.height-120,c=n-100,h=n+100;if(console.log("🦘 Jump button check:",{touchX:t,touchY:s,bounds:{left:o,right:l,top:c,bottom:h},inBounds:t>=o&&t<=l&&s>=c&&s<=h}),t>=o&&t<=l&&s>=c&&s<=h){this.jumpPointerId===-1&&(console.log("✅ Jump button pressed!"),this.jumpPointerId=e.id,this.jumpPressed=!0);return}if(this.actionButton.visible){const y=this.scene.game.config.height-120,f=y-100,m=y+100;t>=357.5&&t<=532.5&&s>=f&&s<=m&&this.actionPointerId===-1&&(this.actionPointerId=e.id,this.actionPressed=!0)}}updateTouchpadFromPosition(e,t){const s=e-this.touchpadCenter.x,i=t-this.touchpadCenter.y,a=Math.sqrt(s*s+i*i);if(a<this.deadZone){this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.touchpadIndicator.setPosition(0,0);return}const o=Math.min(a,this.touchpadRadius),l=s/o*(o/this.touchpadRadius),r=i/o*(o/this.touchpadRadius);this.horizontalInput=l,this.verticalInput=r;const n=.3;this.leftPressed=l<-n,this.rightPressed=l>n,this.upPressed=r<-n,this.downPressed=r>n;const c=Math.min(a,this.touchpadRadius-8),h=s/a*c,d=i/a*c;this.touchpadIndicator.setPosition(h,d),this.touchPosition={x:s,y:i}}forceUpdate(){this.touchpadIndicator.visible}handlePointerMove(e){this.enabled&&this.isMobileDevice&&e.id===this.touchpadPointerId&&this.updateTouchpadFromPosition(e.x,e.y)}handlePointerUp(e){this.enabled&&this.isMobileDevice&&(e.id===this.touchpadPointerId&&(this.touchpadPointerId=-1,this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.touchpadIndicator.setVisible(!1),this.touchpadIndicator.setPosition(0,0),this.touchPosition=null),e.id===this.jumpPointerId&&(this.jumpPointerId=-1,this.jumpPressed=!1,console.log("🔄 Jump button released")),e.id===this.actionPointerId&&(this.actionPointerId=-1,this.actionPressed=!1))}update(){this.jumpJustPressed=this.jumpPressed&&!this.lastJumpState,this.lastJumpState=this.jumpPressed,this.actionJustPressed=this.actionPressed&&!this.lastActionState,this.lastActionState=this.actionPressed}getHorizontal(){return this.horizontalInput||(this.leftPressed?-1:this.rightPressed?1:0)}getVertical(){return this.verticalInput||(this.upPressed?-1:this.downPressed?1:0)}getHorizontalInput(){return this.horizontalInput}getVerticalInput(){return this.verticalInput}isJumpPressed(){return this.jumpPressed}isJumpJustPressed(){return this.jumpJustPressed}isActionPressed(){return this.actionPressed}isActionJustPressed(){return this.actionJustPressed}showActionButton(e){this.actionButton.setVisible(e)}disable(){this.enabled=!1,this.touchpadContainer.setVisible(!1),this.jumpButton.setVisible(!1),this.actionButton.setVisible(!1),this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.jumpPressed=!1,this.jumpJustPressed=!1,this.actionPressed=!1,this.actionJustPressed=!1,this.touchpadPointerId=-1,this.jumpPointerId=-1,this.actionPointerId=-1,this.touchpadIndicator.setVisible(!1)}enable(){this.enabled=!0,this.touchpadContainer.setVisible(!0),this.jumpButton.setVisible(!0),this.actionButton.setVisible(!0)}createDebugVisualization(){const e=this.scene.add.graphics();e.setDepth(1001),e.setScrollFactor(0),e.lineStyle(2,65280,.8),e.strokeCircle(this.touchpadCenter.x,this.touchpadCenter.y,110);const t=620,s=t-87.5,i=this.scene.game.config.height,o=i-120-100;e.lineStyle(2,16711680,.8),e.strokeRect(s,o,175,200);const l=445,r=l-87.5,c=i-120-100;e.lineStyle(2,255,.8),e.strokeRect(r,c,175,200);const h={fontSize:"12px",color:"#ffffff",fontFamily:"Arial"};this.scene.add.text(this.touchpadCenter.x,this.touchpadCenter.y-120,`TOUCHPAD
Hitbox: 110px
Visual: 100px`,{...h,color:"#00ff00",align:"center"}).setOrigin(.5).setDepth(1002).setScrollFactor(0),this.scene.add.text(t,o-10,`JUMP
175x200px`,{...h,color:"#ff0000",align:"center"}).setOrigin(.5).setDepth(1002).setScrollFactor(0),this.scene.add.text(l,c-10,`ACTION
175x200px`,{...h,color:"#0000ff",align:"center"}).setOrigin(.5).setDepth(1002).setScrollFactor(0)}createXAxisGrid(){const e=this.scene.add.graphics();e.setDepth(999),e.setScrollFactor(0);const t=R.canvas.width,s=R.canvas.height;console.log("📐 Creating X-axis grid:",{canvasWidth:t,canvasHeight:s});for(let o=0;o<=t;o+=20)o%100===0?(e.lineStyle(2,16776960,.5),this.scene.add.text(o,30,`X:${o}`,{fontSize:"14px",color:"#ffff00",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:2,y:2}}).setOrigin(.5).setDepth(1003).setScrollFactor(0)):o%50===0?e.lineStyle(1,16777215,.4):e.lineStyle(1,16777215,.2),e.moveTo(o,0),e.lineTo(o,s);e.lineStyle(3,65535,.8),e.moveTo(120,0),e.lineTo(120,s),this.scene.add.text(120,60,`TOUCHPAD
X:120`,{fontSize:"12px",color:"#00ffff",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:4,y:2},align:"center"}).setOrigin(.5).setDepth(1003).setScrollFactor(0);const i=620;e.moveTo(i,0),e.lineTo(i,s),this.scene.add.text(i,60,`JUMP
X:${i}`,{fontSize:"12px",color:"#00ffff",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:4,y:2},align:"center"}).setOrigin(.5).setDepth(1003).setScrollFactor(0);const a=445;e.moveTo(a,0),e.lineTo(a,s),this.scene.add.text(a,90,`ACTION
X:${a}`,{fontSize:"12px",color:"#00ffff",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:4,y:2},align:"center"}).setOrigin(.5).setDepth(1003).setScrollFactor(0),this.scene.add.text(t/2,10,`Canvas Width: ${t}px`,{fontSize:"16px",color:"#ff00ff",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:4,y:2}}).setOrigin(.5).setDepth(1003).setScrollFactor(0)}destroy(){this.touchpadContainer.destroy(),this.jumpButton.destroy(),this.actionButton.destroy()}}var O=(C=>(C.BASEBLU="baseblu",C.BEETLE="beetle",C.CATERPILLAR="caterpillar",C.BLUE_CATERPILLAR="blue_caterpillar",C.CHOMPER="chomper",C.SNAIL="snail",C.JUMPER="jumper",C.STALKER="stalker",C.REX="rex",C))(O||{});class D{static ENEMY_DEFINITIONS={baseblu:{type:"baseblu",color:"blue",difficultyScore:2,speed:.25,pointValue:1e3,description:"Immovable blocker, can only be killed when invincible"},beetle:{type:"beetle",color:"red",difficultyScore:.8,speed:1,pointValue:75,description:"Simple patrol beetle"},caterpillar:{type:"caterpillar",color:"yellow",difficultyScore:.5,speed:.6,pointValue:50,description:"Slow random movement"},blue_caterpillar:{type:"blue_caterpillar",color:"blue_caterpillar",difficultyScore:.7,speed:.7,pointValue:50,description:"Slightly faster caterpillar variant"},chomper:{type:"chomper",color:"blue",difficultyScore:1,speed:1,pointValue:100,description:"Standard patrol with bite animations"},snail:{type:"snail",color:"red",difficultyScore:1.5,speed:1.2,pointValue:150,description:"Faster patrol enemy"},jumper:{type:"jumper",color:"green",difficultyScore:2.5,speed:1.5,pointValue:200,description:"Fast bouncing movement"},stalker:{type:"stalker",color:"red",difficultyScore:4,speed:1.5,pointValue:300,description:"Hidden activation + chase AI"},rex:{type:"rex",color:"rex",difficultyScore:1.2,speed:.75,pointValue:500,description:"Flipping enemy with periodic jumps"}};static LEVEL_SPAWN_WEIGHTS={tutorial_early:{caterpillar:.4,beetle:.4,blue_caterpillar:.2,baseblu:0,chomper:0,snail:0,jumper:0,stalker:0,rex:0},patrol:{caterpillar:.3,beetle:.25,blue_caterpillar:.2,chomper:.25,baseblu:0,snail:0,jumper:0,stalker:0,rex:0},speed_intro:{caterpillar:.2,beetle:.2,blue_caterpillar:.15,chomper:.3,snail:.15,baseblu:0,jumper:0,stalker:0,rex:0},rex_intro:{caterpillar:.15,beetle:.15,blue_caterpillar:.1,chomper:.25,snail:.2,rex:.15,baseblu:0,jumper:0,stalker:0},obstacles:{caterpillar:.1,beetle:.1,blue_caterpillar:.1,rex:.15,chomper:.2,snail:.2,baseblu:.15,jumper:0,stalker:0},hunter:{caterpillar:.1,beetle:.1,blue_caterpillar:.05,rex:.15,chomper:.2,snail:.2,baseblu:.1,stalker:.1,jumper:0},bouncing:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.1,jumper:.15,chomper:.15,snail:.2,baseblu:.1,stalker:.15},advanced:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.15,jumper:.15,chomper:.15,snail:.15,baseblu:.1,stalker:.15},advanced_2:{caterpillar:.05,beetle:.05,blue_caterpillar:0,rex:.1,jumper:.2,chomper:.15,snail:.2,baseblu:.1,stalker:.15},expert:{caterpillar:.05,beetle:.05,blue_caterpillar:0,rex:.15,jumper:.15,chomper:.1,snail:.15,baseblu:.15,stalker:.2},beast:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.1,jumper:.1,chomper:.15,snail:.15,baseblu:.15,stalker:.2}};static getMaxEnemiesPerFloor(e){return e<=10?2:e<=20||e<=30?3:e<=40||e<=50?4:5}static getSpeedMultiplier(e){return e<=10?1+(e-1)/9*.05:e<=20?1.05+(e-10)/10*.05:e<=30?1.1+(e-20)/10*.05:e<=40?1.15+(e-30)/10*.05:e<=50?1.2+(e-40)/10*.05:1.25}static getBaseBluMaxPerFloor(e){return e<=14?0:1}static getSpawnWeights(e){return e<=4?this.LEVEL_SPAWN_WEIGHTS.tutorial_early:e<=7?this.LEVEL_SPAWN_WEIGHTS.patrol:e<=11?this.LEVEL_SPAWN_WEIGHTS.speed_intro:e<=14?this.LEVEL_SPAWN_WEIGHTS.rex_intro:e<=19?this.LEVEL_SPAWN_WEIGHTS.obstacles:e<=24?this.LEVEL_SPAWN_WEIGHTS.hunter:e<=29?this.LEVEL_SPAWN_WEIGHTS.bouncing:e<=34?this.LEVEL_SPAWN_WEIGHTS.advanced:e<=39?this.LEVEL_SPAWN_WEIGHTS.advanced_2:e<=49?this.LEVEL_SPAWN_WEIGHTS.expert:this.LEVEL_SPAWN_WEIGHTS.beast}static selectEnemiesForFloor(e,t){const s={...this.getSpawnWeights(e)},i=this.getMaxEnemiesPerFloor(e),a=this.getBaseBluMaxPerFloor(e);s.rex>0&&s.jumper>0&&(Math.random()<.5?s.jumper=0:s.rex=0);const o=[];let l=0,r;if(e===1)r=1;else{const n=Math.max(1,i-1);r=Math.floor(Math.random()*2)+n}for(let n=0;n<r;n++){const c=[];let h=0;for(const[b,y]of Object.entries(s))if(y>0){const f=b;if(f==="baseblu"&&l>=a||f==="chomper"&&t===9)continue;c.push({type:f,weight:y}),h+=y}if(c.length===0)break;const d=Math.random()*h;let u=0,g=null;for(const b of c)if(u+=b.weight,d<=u){g=b.type;break}g&&(o.push(g),g==="baseblu"&&l++)}return o}static selectEnemies(e,t){return this.selectEnemiesForFloor(t,0)}static getEnemyDefinition(e){return this.ENEMY_DEFINITIONS[e]}static getColorForEnemyType(e){return this.ENEMY_DEFINITIONS[e].color}static isStalkerType(e){return e==="stalker"}static isBaseBluType(e){return e==="baseblu"}static isBeetleType(e){return e==="beetle"}static isRexType(e){return e==="rex"}static getPointValue(e){return this.ENEMY_DEFINITIONS[e].pointValue}static getAllEnemyTypes(){return Object.values(O)}static logSpawnInfo(e,t,s){this.getDifficultyBudget(e,t),s.reduce((i,a)=>i+this.ENEMY_DEFINITIONS[a].difficultyScore,0)}}class fe{currentLevel=1;isInBonusLevel=!1;BEAST_MODE_LEVEL=51;MAX_PROGRESSION_LEVEL=50;constructor(){this.currentLevel=1,this.isInBonusLevel=!1}shouldHaveBonusAfter(e){return e>0&&e%10===0&&e<this.BEAST_MODE_LEVEL}isBonusLevel(){return this.isInBonusLevel}getLevelConfig(e){if(this.isInBonusLevel)return{levelNumber:e,floorCount:5,enemyTypes:[],collectibleTypes:["treasureChest"],worldWidth:24,isEndless:!1,difficultyBudgetPerFloor:0,enemySpawnWeights:{}};const t=e>=this.BEAST_MODE_LEVEL,s=Math.min(e,this.MAX_PROGRESSION_LEVEL),i=D.getSpawnWeights(s);return{levelNumber:e,floorCount:this.calculateFloorCount(e),enemyTypes:this.getEnemyTypes(s),collectibleTypes:this.getCollectibleTypes(s),worldWidth:this.getWorldWidth(s),isEndless:t,difficultyBudgetPerFloor:0,enemySpawnWeights:i}}calculateFloorCount(e){if(e>=this.BEAST_MODE_LEVEL)return-1;if(e<=10)return 10+Math.floor(e/5);if(e<=25){const t=(e-10)/15;return 13+Math.floor(t*5)}else if(e<=40){const t=(e-25)/15;return 19+Math.floor(t*6)}else{const t=(e-40)/10;return 25+Math.floor(t*5)}}getEnemyTypes(e){return["blue","yellow","green","red"]}getEnemyTypesForFloor(e,t){return D.selectEnemiesForFloor(e,t)}getCollectibleTypes(e){return e<=2?["coin","treasureChest"]:e<=3?["coin","blueCoin","treasureChest"]:e<=6?["coin","blueCoin","diamond","freeLife","invincibilityPendant","treasureChest"]:["coin","blueCoin","diamond","freeLife","invincibilityPendant","treasureChest"]}getWorldWidth(e){return e<25?24:e<50?32:40}isLevelComplete(e){const t=this.getLevelConfig(this.currentLevel);return t.isEndless?!1:e>=t.floorCount}nextLevel(){return this.isInBonusLevel?(this.isInBonusLevel=!1,this.currentLevel++):this.shouldHaveBonusAfter(this.currentLevel)?this.isInBonusLevel=!0:this.currentLevel++,this.saveProgress(),this.currentLevel}resetToStart(){this.currentLevel=1,this.isInBonusLevel=!1}getCurrentLevel(){return this.currentLevel}setCurrentLevel(e){this.currentLevel=e,this.saveProgress()}saveProgress(){try{const e=parseInt(localStorage.getItem("treasureQuest_furthestLevel")||"1");this.currentLevel>e&&localStorage.setItem("treasureQuest_furthestLevel",this.currentLevel.toString())}catch(e){console.warn("Could not save progress to localStorage:",e)}}loadProgress(){}getFurthestLevel(){try{return parseInt(localStorage.getItem("treasureQuest_furthestLevel")||"1")}catch{return 1}}getEnemySpawnRates(e){const t={blue:1.2,yellow:.8,green:.5,red:.3},s=Math.min(e,this.MAX_PROGRESSION_LEVEL),i=1+s*.015,a={};return this.getEnemyTypes(s).forEach(l=>{a[l]=t[l]*i}),a}isBeastMode(){return this.currentLevel>=this.BEAST_MODE_LEVEL}getMaxProgressionLevel(){return this.MAX_PROGRESSION_LEVEL}}class De extends Phaser.Physics.Arcade.Sprite{promptText=null;playerNearby=!1;isFirstLevel;constructor(e,t,s,i=!1){super(e,t,s-9,"door-sprite"),this.isFirstLevel=i,e.add.existing(this),e.physics.add.existing(this,!0),this.setDisplaySize(100,120);const a=this.body;a.setSize(80,100),a.setOffset(-40,-50),this.setDepth(10)}showPrompt(e){this.playerNearby=!0,this.promptText||(this.promptText=this.scene.add.text(this.x,this.y-70,"Press UP to enter",{fontSize:"16px",color:"#ffff00",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(100))}createInstructionPopup(){const e=this.scene.cameras.main.width/2,t=this.scene.cameras.main.height/2,s=this.scene.add.rectangle(e,t,300,150,2894892,.95).setDepth(200),i=this.scene.add.rectangle(e,t,304,154,16777215).setDepth(199);i.setStrokeStyle(2,16777215),i.setFillStyle(),this.promptText=this.scene.add.text(e,t-20,"Level Complete!",{fontSize:"18px",color:"#44ff44",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201);const a=this.scene.add.text(e,t+15,`Press UP to enter the door
and advance to the next level`,{fontSize:"12px",color:"#ffffff",fontFamily:'"Press Start 2P", system-ui',align:"center"}).setOrigin(.5).setDepth(201);this.promptText.setData("popup",s),this.promptText.setData("border",i),this.promptText.setData("instruction",a)}hidePrompt(){if(this.playerNearby=!1,this.promptText){const e=this.promptText.getData("popup"),t=this.promptText.getData("border"),s=this.promptText.getData("instruction");e&&e.destroy(),t&&t.destroy(),s&&s.destroy(),this.promptText.destroy(),this.promptText=null}}createDebugVisualization(){const e=this.scene.add.graphics();e.fillStyle(16711680,1),e.fillCircle(this.x,this.y,5),e.lineStyle(3,65280,1),e.strokeRect(this.x-40,this.y-50,80,100),e.lineStyle(3,255,1);const t=this.body;e.strokeRect(t.x,t.y,t.width,t.height),e.lineStyle(2,16776960,1);const s=this.y+50;e.lineBetween(this.x-60,s,this.x+60,s),e.lineStyle(2,16746496,1);const i=s;e.lineBetween(this.x-80,i,this.x+80,i);const a={fontSize:"12px",color:"#ffffff",backgroundColor:"#000000"};this.scene.add.text(this.x+50,this.y-30,"DOOR CENTER",a).setDepth(100),this.scene.add.text(this.x+50,this.y-10,`X: ${this.x}, Y: ${this.y}`,a).setDepth(100),this.scene.add.text(this.x+50,this.y+10,`Physics: ${t.x}, ${t.y}`,a).setDepth(100),this.scene.add.text(this.x+50,this.y+30,`Size: ${t.width}x${t.height}`,a).setDepth(100),this.scene.add.text(this.x+50,s,"DOOR BOTTOM",a).setDepth(100),this.scene.add.text(this.x+50,i+15,"PLATFORM SURFACE",a).setDepth(100),e.setDepth(50)}isPlayerNearby(){return this.playerNearby}destroy(){this.hidePrompt(),super.destroy()}}class Ae{scene;loadQueue=[];loadedAssets=new Set;failedAssets=new Set;retryCount=new Map;loadingPromises=new Map;constructor(e){this.scene=e}registerAssets(e){this.loadQueue.push(...e)}async loadAllAssets(){const e=this.loadQueue.map(t=>this.loadAsset(t));await Promise.allSettled(e)}async loadAsset(e){if(this.loadingPromises.has(e.key))return this.loadingPromises.get(e.key);if(this.loadedAssets.has(e.key))return!0;if(this.failedAssets.has(e.key))return!1;const t=this.attemptLoad(e);return this.loadingPromises.set(e.key,t),t}async attemptLoad(e){const t=e.retries||3;let s=this.retryCount.get(e.key)||0;for(;s<t;)try{return await this.loadSingleAsset(e),this.loadedAssets.add(e.key),this.loadingPromises.delete(e.key),!0}catch{s++,this.retryCount.set(e.key,s),s<t&&await new Promise(a=>setTimeout(a,Math.pow(2,s)*1e3))}return e.fallback&&this.scene.textures.exists(e.fallback)?(this.loadedAssets.add(e.key),this.loadingPromises.delete(e.key),!0):(this.failedAssets.add(e.key),this.loadingPromises.delete(e.key),!1)}loadSingleAsset(e){return new Promise((t,s)=>{if(e.type==="image"&&this.scene.textures.exists(e.key)){console.log(`⚡ Asset already loaded: ${e.key}`),t();return}if(e.type==="audio"&&this.scene.cache.audio.exists(e.key)){console.log(`⚡ Audio already loaded: ${e.key}`),t();return}const i=()=>{this.scene.load.off("filecomplete",a),this.scene.load.off("loaderror",o),t()},a=l=>{l===e.key&&i()},o=l=>{l.key===e.key&&(this.scene.load.off("filecomplete",a),this.scene.load.off("loaderror",o),s(new Error(`Failed to load ${e.key}: ${l.src}`)))};switch(this.scene.load.on("filecomplete",a),this.scene.load.on("loaderror",o),e.type){case"image":this.scene.load.image(e.key,e.url);break;case"audio":this.scene.load.audio(e.key,e.url);break;case"json":this.scene.load.json(e.key,e.url);break;default:s(new Error(`Unsupported asset type: ${e.type}`));return}this.scene.load.isLoading()||this.scene.load.start()})}isAssetLoaded(e){return this.loadedAssets.has(e)&&this.scene.textures.exists(e)}isAssetFailed(e){return this.failedAssets.has(e)}getSafeTexture(e,t="defaultTexture"){return this.isAssetLoaded(e)?e:(this.scene.textures.exists(t)||this.createEmergencyFallback(t),t)}createEmergencyFallback(e){if(this.scene.textures.exists(e))return;const t=this.scene.add.graphics();t.fillStyle(16711680,1),t.fillRect(0,0,32,32),t.generateTexture(e,32,32),t.destroy()}createCommonFallbacks(){[{key:"defaultEnemy",color:4286945,size:{w:36,h:36}},{key:"defaultPlayer",color:65280,size:{w:48,h:64}},{key:"defaultCoin",color:16766720,size:{w:24,h:24}}].forEach(t=>{if(!this.scene.textures.exists(t.key)){const s=this.scene.add.graphics();s.fillStyle(t.color,1),s.fillRect(0,0,t.size.w,t.size.h),s.generateTexture(t.key,t.size.w,t.size.h),s.destroy()}})}}const Fe="modulepreload",Re=function(C){return"/"+C},Se={},xe=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){let o=function(n){return Promise.all(n.map(c=>Promise.resolve(c).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),r=l?.nonce||l?.getAttribute("nonce");i=o(t.map(n=>{if(n=Re(n),n in Se)return;Se[n]=!0;const c=n.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${h}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":Fe,c||(d.as="script"),d.crossOrigin="",d.href=n,r&&d.setAttribute("nonce",r),document.head.appendChild(d),c)return new Promise((u,g)=>{d.addEventListener("load",u),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${n}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};class je{scene;container;isOpen=!1;soundEffectsEnabled=!0;musicEnabled=!0;backgroundOverlay;menuPanel;soundToggle=null;musicToggle=null;instructionsOverlay=null;walletUI=null;constructor(e){this.scene=e,this.loadSettings(),this.create()}create(){const e=this.scene.cameras.main,t=e.width/2,s=e.height/2;this.container=this.scene.add.container(t,s),this.container.setDepth(5e3),this.container.setScrollFactor(0,0),this.backgroundOverlay=this.scene.add.rectangle(0,0,e.width*2,e.height*2,0,.7),this.menuPanel=this.createMenuPanel();const i=this.scene.add.text(0,-250,"GAME MENU",{fontSize:"18px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",align:"center"});i.setOrigin(.5);const a=this.createButton(0,-180,"VIEW INSTRUCTIONS",()=>this.openInstructionsScene(),4854924);a.setName("instructionsButton");const o=this.createDivider(-130);this.soundToggle=this.createToggleSwitch(`Sound
Effects`,-80,this.soundEffectsEnabled,g=>this.setSoundEffects(g)),this.soundToggle.setName("soundToggle"),this.musicToggle=this.createToggleSwitch("Music",-30,this.musicEnabled,g=>this.setMusic(g)),this.musicToggle.setName("musicToggle");const l=this.createDivider(20);let r=null;const n=this.scene.registry.get("isDgen1")||window.location.port==="3001";n&&(console.log("💰 Creating wallet button for dgen1"),r=this.createButton(0,70,"💰 CONNECT WALLET",()=>this.handleWalletConnect(),6514417),r.setName("walletButton"));const c=this.createBizarreInfo(n?145:80),h=this.createDivider(n?200:140);this.container.getByName("resumeButton")&&console.error("⚠️ RESUME BUTTON ALREADY EXISTS!");const d=this.createButton(0,n?240:180,"RESUME GAME",()=>this.close(),3329330);d.setName("resumeButton"),console.log("📌 Created Resume button at Y="+(n?240:180)),console.log("📍 FINAL Button Positions:",{instructions:-180,soundToggle:-80,musicToggle:-30,wallet:n?70:"N/A",bizarreInfo:n?120:60,resumeButton:n?240:180});const u=[this.backgroundOverlay,this.menuPanel,i,a,o,this.soundToggle,this.musicToggle,l];console.log("🎯 PRE-ADD POSITIONS:",{soundToggle:this.soundToggle?this.soundToggle.y:"null",musicToggle:this.musicToggle?this.musicToggle.y:"null",instructionsBtn:a?a.y:"null",resumeBtn:d?d.y:"null"}),r&&u.push(r),u.push(c,h,d),this.container.add(u),console.log("🎯 POST-ADD POSITIONS:"),this.container.list.forEach(g=>{g instanceof Phaser.GameObjects.Container&&g.name&&console.log(`  ${g.name}: Y=${g.y}`)}),this.container.sendToBack(this.backgroundOverlay),this.container.setVisible(!1)}createMenuPanel(){const e=this.scene.add.graphics(),t=this.scene.cameras.main.width,s=Math.min(t<=500?380:400,t-40),i=Math.min(600,this.scene.cameras.main.height-40),a=-s/2,o=-i/2;return console.log("🖼️ Panel dimensions:",{width:s,height:i,position:`(${a}, ${o})`}),e.fillStyle(4854924,.95),e.fillRoundedRect(a,o,s,i,15),e.lineStyle(3,16766720),e.strokeRoundedRect(a,o,s,i,15),e}createButton(e,t,s,i,a=4854924){const o=this.scene.add.container(e,t),r=this.scene.cameras.main.width<=500?320:340,c=this.scene.add.rectangle(0,0,r,50,a,.8);c.setStrokeStyle(2,16766720);const h=this.scene.add.text(0,0,s,{fontSize:"14px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});return h.setOrigin(.5),c.setDepth(10),h.setDepth(11),o.add([c,h]),c.setInteractive({useHandCursor:!0}),c.input&&this.scene.input.setTopOnly(!1),c.on("pointerdown",d=>{if(s==="RESUME GAME"){c.getBounds();const u=this.container,g=d.x-u.x,b=d.y-u.y,y=t-25,f=t+25;if(!(b>=y&&b<=f&&g>=-160&&g<=160))return}i()}),o}createToggleSwitch(e,t,s,i){const a=this.scene.add.container(0,t),o=this.scene.add.text(-90,0,e,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",align:"left",lineSpacing:5});o.setOrigin(0,.5);const l=80,r=60,n=30,c=this.scene.add.rectangle(l,0,r,n,0,0);c.setInteractive({useHandCursor:!0});const h=this.scene.add.graphics(),d=y=>{h.clear(),h.fillStyle(y?3329330:16739179,1),h.fillRoundedRect(l-r/2,-n/2,r,n,15),h.lineStyle(2,16766720),h.strokeRoundedRect(l-r/2,-n/2,r,n,15)};d(s);const u=s?l+15:l-15,g=this.scene.add.circle(u,0,13,16777215);g.setStrokeStyle(2,16766720),a.add([o,h,g,c]);let b=s;return c.on("pointerdown",y=>{y&&y.event&&y.event.stopPropagation(),b=!b,this.scene.tweens.add({targets:g,x:b?l+15:l-15,duration:200,ease:"Power2"}),d(b),i(b)}),c.on("pointerover",()=>{h.clear(),h.fillStyle(b?3329330:16739179,.8),h.fillRoundedRect(l-r/2,-n/2,r,n,15),h.lineStyle(3,16766720),h.strokeRoundedRect(l-r/2,-n/2,r,n,15)}),c.on("pointerout",()=>{d(b)}),a.setData("enabled",b),a.setData("updateState",y=>{b=y,g.x=y?l+15:l-15,d(y)}),a}createDivider(e){const t=this.scene.add.graphics();return t.lineStyle(1,16766720,.3),t.moveTo(-150,e),t.lineTo(150,e),t.strokePath(),t}createBizarreInfo(e){const t=this.scene.add.container(0,e),s=this.scene.add.container(0,0),i=340,o=this.scene.add.rectangle(0,0,i,70,16738740,.9);o.setStrokeStyle(2,16716947),o.setInteractive({useHandCursor:!0}),o.setData("expectedY",e),o.setData("buttonType","bizarreSwap");const l=this.scene.add.text(0,-20,"BizarreBeasts ($BB)",{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});l.setOrigin(.5);const r=this.scene.add.text(0,0,"0x0520bf1d3cEE163407aDA79109333aB1599b4004",{fontSize:"7px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",wordWrap:{width:i-20}});r.setOrigin(.5);const n=this.scene.add.text(0,18,"Click to swap on Uniswap",{fontSize:"8px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFF00"});n.setOrigin(.5),o.on("pointerover",()=>{o.setFillStyle(16716947,.95),o.setScale(1.02)}),o.on("pointerout",()=>{o.setFillStyle(16738740,.9),o.setScale(1)}),s.add([o,l,r,n]);const c=this.scene.add.text(0,50,"Created by @bizarrebeast",{fontSize:"9px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});return c.setOrigin(.5),t.add([s,c]),t}createSDKIndicator(e){const t=this.scene.add.container(0,e),s=this.scene.game.sound.mute,i=this.scene.add.text(0,0,`SDK Global: ${s?"MUTED":"ACTIVE"}`,{fontSize:"11px",fontFamily:'"Press Start 2P", system-ui',color:s?"#FF6B6B":"#AAAAAA"});i.setOrigin(.5);const a=this.scene.add.text(0,20,"(Controlled by platform)",{fontSize:"8px",fontFamily:'"Press Start 2P", system-ui',color:"#777777"});return a.setOrigin(.5),t.add([i,a]),t.setData("updateStatus",()=>{const o=this.scene.game.sound.mute;i.setText(`SDK Global: ${o?"MUTED":"ACTIVE"}`),i.setColor(o?"#FF6B6B":"#AAAAAA")}),t}setSoundEffects(e){if(console.log(`🔊 Sound effects ${e?"enabled":"disabled"}`),this.soundEffectsEnabled=e,this.scene.registry.set("sfxEnabled",e),this.saveSettings(),this.soundToggle){const t=this.soundToggle.getData("updateState");t&&t(e)}}setMusic(e){if(console.log(`🎵 Music ${e?"enabled":"disabled"}`),this.musicEnabled=e,this.scene.registry.set("musicEnabled",e),this.saveSettings(),this.scene.backgroundMusic&&this.scene.backgroundMusic.setVolume(e?.3:0),this.musicToggle){const t=this.musicToggle.getData("updateState");t&&t(e)}}loadSettings(){const e=localStorage.getItem("audioSettings");if(e){const t=JSON.parse(e);this.soundEffectsEnabled=t.soundEffectsEnabled!==!1,this.musicEnabled=t.musicEnabled!==!1}this.scene.registry.set("sfxEnabled",this.soundEffectsEnabled),this.scene.registry.set("musicEnabled",this.musicEnabled)}saveSettings(){const e={soundEffectsEnabled:this.soundEffectsEnabled,musicEnabled:this.musicEnabled};localStorage.setItem("audioSettings",JSON.stringify(e))}open(){if(this.isOpen){console.log("⚠️ Menu already open, ignoring open() call");return}this.isOpen=!0,this.container.setVisible(!0),this.soundEffectsEnabled&&this.scene.sound.play("menu-toggle",{volume:.5}),this.container.list.filter(s=>s instanceof Phaser.GameObjects.Container&&s.getData("updateStatus")).forEach(s=>{const i=s.getData("updateStatus");i&&i()}),this.pauseGame(),this.scene.input.enabled=!0,this.enableNestedInteractivity(this.container);const t=s=>{this.manualHitTest(s)};this.scene.input.off("pointerdown",t),this.scene.input.on("pointerdown",t),this.container.setData("pointerListener",t),this.scene.children.bringToTop(this.container),this.scene.input.setTopOnly(!1),this.container.setAlpha(1)}enableNestedInteractivity(e){e.list.forEach(t=>{t instanceof Phaser.GameObjects.Rectangle?(t.input||t.setInteractive({useHandCursor:!0}),this.scene.input.enable(t)):t instanceof Phaser.GameObjects.Container&&this.enableNestedInteractivity(t)})}addDebugVisualization(){const e=this.container.getByName("debugGraphics");e&&e.destroy();const t=this.scene.add.graphics();t.setName("debugGraphics"),console.log("📦 MENU CONTAINER ELEMENTS:",{containerPos:`(${this.container.x}, ${this.container.y})`,childCount:this.container.list.length});let s=null,i=null;this.container.list.forEach((u,g)=>{if(u instanceof Phaser.GameObjects.Container){const b=u.name||"unnamed",y=u.input?"INTERACTIVE":"not-interactive";console.log(`  [${g}] Container '${b}': Y=${u.y}, X=${u.x} [${y}]`),b==="musicToggle"&&(s=u.y),b==="soundToggle"&&(i=u.y),u.list&&u.list.length>0&&u.list.forEach((f,m)=>{const S=f.input?"INTERACTIVE":"";f instanceof Phaser.GameObjects.Text&&f.text?console.log(`    └─ Text: "${f.text.substring(0,20)}..." at (${f.x}, ${f.y}) ${S}`):f instanceof Phaser.GameObjects.Rectangle&&console.log(`    └─ Rectangle at (${f.x}, ${f.y}) size: ${f.width}x${f.height} ${S}`)})}else if(u instanceof Phaser.GameObjects.Text){const b=u.input?"INTERACTIVE":"";console.log(`  [${g}] Text: "${u.text.substring(0,30)}..." at Y=${u.y} ${b}`)}else if(u instanceof Phaser.GameObjects.Graphics){const b=u.input?"INTERACTIVE":"";console.log(`  [${g}] Graphics/Divider at Y=${u.y} ${b}`)}else if(u instanceof Phaser.GameObjects.Rectangle){const b=u.input?"INTERACTIVE!":"";console.log(`  [${g}] Rectangle at Y=${u.y} size: ${u.width}x${u.height} ${b}`)}}),console.log("⚠️ VISUAL POSITIONS VS HIT ZONES:",{musicToggle:{visual:s,hitZone:"-45 to -15",mismatch:s!==-30},soundToggle:{visual:i,hitZone:"-95 to -65",mismatch:i!==-80}});const a=this.container.getByName("instructionsButton"),o=this.container.getByName("soundToggle"),l=this.container.getByName("musicToggle"),r=this.container.getByName("resumeButton");console.log("🎯 FOUND ELEMENTS:",{instructionsBtn:a?`Y=${a.y}`:"NOT FOUND",soundToggle:o?`Y=${o.y}`:"NOT FOUND",musicToggle:l?`Y=${l.y}`:"NOT FOUND",resumeBtn:r?`Y=${r.y}`:"NOT FOUND"}),this.scene.registry.get("isDgen1")||window.location.port;const n=this.scene.cameras.main.width<=500?160:170;a&&(t.lineStyle(2,16776960,.8),t.strokeRect(-n,a.y-25,n*2,50)),o&&(t.lineStyle(2,65535,.8),t.strokeRect(50,o.y-15,60,30)),l&&(t.lineStyle(2,16711935,.8),t.strokeRect(50,l.y-15,60,30)),r&&(t.lineStyle(2,65280,.8),t.strokeRect(-n,r.y-25,n*2,50));const c={fontSize:"10px",fontFamily:"monospace",color:"#FFFFFF",backgroundColor:"#000000",padding:{x:2,y:1}};if(a){const u=this.scene.add.text(0,a.y-40,"INSTR HIT",c);u.setOrigin(.5),t.add(u)}if(o){const u=this.scene.add.text(80,o.y-25,"SOUND HIT",c);u.setOrigin(.5),t.add(u)}if(l){const u=this.scene.add.text(80,l.y-25,"MUSIC HIT",c);u.setOrigin(.5),t.add(u)}if(r){const u=this.scene.add.text(0,r.y-40,"RESUME HIT",c);u.setOrigin(.5),t.add(u)}t.lineStyle(2,16711680,1),t.moveTo(-10,0),t.lineTo(10,0),t.moveTo(0,-10),t.lineTo(0,10);const h=this.scene.add.text(15,15,"Container (0,0)",c);h.setOrigin(0),this.container.add([t,h]);const d=this.scene.add.text(10,10,"",{fontSize:"12px",fontFamily:"monospace",color:"#00FF00",backgroundColor:"#000000",padding:{x:5,y:5}});d.setScrollFactor(0),d.setDepth(1e4),d.setName("pointerTracker"),this.scene.input.on("pointermove",u=>{const g=this.scene.cameras.main,b=g.width/2,y=g.height/2,f=Math.round(u.x-b),m=Math.round(u.y-y);d.setText(`Screen: (${Math.round(u.x)}, ${Math.round(u.y)})
Relative: (${f}, ${m})
Container: (${b}, ${y})`)})}manualHitTest(e){const t=this.scene.cameras.main,s=this.scene.registry.get("isDgen1")||window.location.port==="3001",i=t.width,a=i<=500,o=i/2,l=t.height/2,r=e.x,n=e.y,c=r-o,h=n-l;a?console.log("🎯 Regular Menu Hit Test:",{pointerScreen:`(${Math.round(r)}, ${Math.round(n)})`,containerCenter:`(${o}, ${l})`,relativePos:`(${Math.round(c)}, ${Math.round(h)})`,cameraSize:`${i}x${t.height}`,cameraScroll:`(${Math.round(t.scrollX)}, ${Math.round(t.scrollY)})`,version:"REGULAR (450x800)"}):console.log("🎯 Manual hit test at:",{pointerX:Math.round(r),pointerY:Math.round(n),containerPos:`(${o}, ${l})`});const d=i<=500?160:170;a&&console.log("🎮 HIT TEST ZONES:",{instructionsZone:"Y: -205 to -155",soundToggleZone:"Y: -95 to -65, X: 50 to 110",musicToggleZone:"Y: -45 to -15, X: 50 to 110",resumeZone:"Y: 155 to 205",clickedAt:`(${Math.round(c)}, ${Math.round(h)})`});const u=80,g=-80,b=Math.abs(c-u)<30&&Math.abs(h-g)<15;if(a&&b&&console.log("🔊 Sound Toggle HIT at:",{toggleCenter:`(${u}, ${g})`,relativeClick:`(${Math.round(c)}, ${Math.round(h)})`}),b){console.log("✅ Sound toggle hit!"),this.setSoundEffects(!this.soundEffectsEnabled);return}const y=80,f=-30,m=Math.abs(c-y)<30&&Math.abs(h-f)<15;if(a){const w={xDist:Math.abs(c-y),yDist:Math.abs(h-f),wouldHit:m};Math.abs(h-f)<50&&console.log("🎵 Music Toggle Check:",{toggleCenter:`(${y}, ${f})`,relativeClick:`(${Math.round(c)}, ${Math.round(h)})`,distance:w,hit:m})}if(m){console.log("✅ Music toggle hit!"),this.setMusic(!this.musicEnabled);return}const S=0,v=s?240:180,k=Math.abs(c-S)<d&&Math.abs(h-v)<25;if(a&&k&&console.log("📍 Resume Button HIT at:",{btnCenter:`(${S}, ${v})`,relativeClick:`(${Math.round(c)}, ${Math.round(h)})`}),k){console.log("✅ Resume button hit!"),this.close();return}const x=0,T=-180,M=Math.abs(c-x)<d&&Math.abs(h-T)<25;if(a&&M&&console.log("📍 Instructions Button HIT at:",{btnCenter:`(${x}, ${T})`,relativeClick:`(${Math.round(c)}, ${Math.round(h)})`}),M){console.log("✅ Instructions button hit!"),this.openInstructionsScene();return}if(s){if(Math.abs(c-0)<d&&Math.abs(h-70)<25){console.log("✅ Wallet button hit!"),this.handleWalletConnect();return}if(Math.abs(c-0)<170&&Math.abs(h-145)<35){console.log("✅ BizarreBeasts button hit!"),window.open("https://app.uniswap.org/swap?outputCurrency=0x0520bf1d3cEE163407aDA79109333aB1599b4004&chain=base","_blank");return}}}addDebugVisualization(){const e=this.container.getByName("debugContainer");e&&e.destroy();const t=this.scene.add.container(0,0);t.setName("debugContainer");const s=this.scene.add.graphics(),i=this.container.getByName("resumeButton");if(i){s.lineStyle(4,16711935,1),s.strokeRect(i.x-170,i.y-25,340,50);const d=this.scene.add.text(i.x,i.y-40,`ACTUAL Button Pos: (${i.x}, ${i.y})`,{fontSize:"12px",fontFamily:"Arial",color:"#ff00ff",backgroundColor:"#000000",padding:{x:2,y:2}});d.setOrigin(.5),t.add(d)}s.lineStyle(2,65280,.5),s.strokeRect(-170,125,340,50),s.lineStyle(2,255,.5),s.strokeRect(-170,-165,340,50);const a=this.scene.add.text(0,110,"Created at Y=150",{fontSize:"10px",fontFamily:"Arial",color:"#00ff00"});a.setOrigin(.5);const o=this.scene.add.text(0,-180,"Instructions Zone",{fontSize:"10px",fontFamily:"Arial",color:"#0000ff"});o.setOrigin(.5);const l=this.scene.add.text(-210,-380,"",{fontSize:"10px",fontFamily:"monospace",color:"#ffff00",backgroundColor:"#000000",padding:{x:5,y:5}});l.setName("cursorText");const r=this.scene.add.graphics();r.lineStyle(2,16711680,.8),this.container.x,this.container.y,r.strokeRect(0-170,150-25,340,50);const h=this.scene.add.text(0,190,"Manual Hit Test Y=150 (Fixed)",{fontSize:"10px",fontFamily:"Arial",color:"#ff0000"});h.setOrigin(.5),t.add([s,r,a,o,h,l]),this.container.add(t)}updateCursorTracking(e){const t=this.container.getByName("debugContainer");if(!t)return;const s=t.getByName("cursorText");if(!s)return;const i=this.scene.cameras.main,a=this.container.x,o=this.container.y;e.x-a,e.y-o;const l=a+0,r=o+150,n=Math.abs(e.x-l)<170&&Math.abs(e.y-r)<25,c=this.container.getByName("resumeButton");let h="Button not found",d="Rect not found";if(c){const b=c.x,y=c.y;h=`Button container: (${b}, ${y})`;const f=c.list[0];if(f){const m=a+b+f.x,S=o+y+f.y;d=`Rect world: (${Math.round(m)}, ${Math.round(S)})`;const v=e.x>=m-170&&e.x<=m+170&&e.y>=S-25&&e.y<=S+25;d+=v?" HOVERING!":""}}const u=i.scrollY,g=o+150-u;s.setText([`Cursor: (${Math.round(e.x)}, ${Math.round(e.y)})`,`Container: (${Math.round(a)}, ${Math.round(o)})`,`Camera ScrollY: ${Math.round(u)}`,`Button Logic Y: ${o+150} (= 550)`,`Button Visual Y: ${Math.round(g)}`,`Manual Hit: ${n?"YES":"NO"}`,`${h}`,`${d}`])}close(){if(!this.isOpen){console.log("⚠️ Menu already closed, ignoring close() call");return}console.log("🍔 Closing menu overlay"),this.soundEffectsEnabled&&this.scene.sound.play("menu-toggle",{volume:.5}),this.isOpen=!1;const e=this.container.getData("pointerListener");e&&(this.scene.input.off("pointerdown",e),this.container.setData("pointerListener",null)),this.container.setVisible(!1),this.container.setAlpha(1),this.resumeGame()}pauseGame(){this.scene.touchControls&&this.scene.touchControls.disable(),this.scene.physics.pause(),this.scene.anims.pauseAll(),this.scene.registry.set("isPaused",!0),this.scene.input.enabled=!0}resumeGame(){this.scene.physics.resume(),this.scene.anims.resumeAll(),this.scene.time.paused=!1,this.scene.tweens.resumeAll(),this.scene.registry.set("isPaused",!1),this.scene.touchControls&&this.scene.touchControls.enable()}showInstructions(){this.instructionsOverlay||this.createInstructionsOverlay(),this.instructionsOverlay?.setVisible(!0),this.instructionsOverlay?.setAlpha(0),this.scene.tweens.add({targets:this.instructionsOverlay,alpha:1,duration:200})}createInstructionsOverlay(){this.instructionsOverlay=this.scene.add.container(p.canvas.width/2,p.canvas.height/2),this.instructionsOverlay.setDepth(2e3);const e=this.scene.add.rectangle(0,0,p.canvas.width,p.canvas.height,0,.9);e.setInteractive();const t=this.scene.add.graphics();t.fillStyle(32896,.95),t.fillRoundedRect(-300,-250,600,500,15),t.lineStyle(3,2142890),t.strokeRoundedRect(-300,-250,600,500,15);const s=this.scene.add.text(0,-210,"INSTRUCTIONS",{fontSize:"18px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});s.setOrigin(.5);const i=["CONTROLS:","","Move: WASD or Arrow Keys","Jump: Space or E","Climb: Up/Down on ladders","Throw: Q, V, or M","","OBJECTIVE:","","Collect coins and gems","Avoid or defeat enemies","Reach the door to advance","","Press ESC to open this menu"],a=this.scene.add.text(0,-100,i.join(`
`),{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFFFF",align:"center",lineSpacing:8});a.setOrigin(.5);const o=this.createButton(0,210,"CLOSE",()=>this.hideInstructions(),16739179);this.instructionsOverlay.add([e,t,s,a,o]),this.instructionsOverlay.setVisible(!1)}hideInstructions(){this.scene.tweens.add({targets:this.instructionsOverlay,alpha:0,duration:200,onComplete:()=>{this.instructionsOverlay?.setVisible(!1)}})}openInstructionsScene(){console.log("📖 Opening instructions scene"),this.container.setVisible(!1),this.scene.scene.sleep("GameScene"),this.scene.scene.launch("InstructionsScene",{returnScene:"GameScene",fromMenu:!0,reopenMenu:!0})}async handleWalletConnect(){console.log("💰 handleWalletConnect called");let e=this.scene.registry.get("platform");if(!e&&this.scene.game&&(e=this.scene.game.registry.get("platform"),console.log("📱 Platform found in game registry:",!!e)),!e&&window.platform&&(e=window.platform,console.log("📱 Platform found in window.platform:",!!e)),!e&&window.gamePlatform&&(e=window.gamePlatform,console.log("📱 Platform found in window.gamePlatform:",!!e)),!e){console.error("❌ Platform not found in any registry"),console.log("🔍 Scene Registry keys:",Object.keys(this.scene.registry.list)),console.log("🔍 Game Registry keys:",Object.keys(this.scene.game?.registry.list||{})),console.log("🔍 Window.platform exists?",!!window.platform),console.log("🔍 Full registry contents:",{sceneRegistry:this.scene.registry.list,gameRegistry:this.scene.game?.registry.list,window:{platform:window.platform,game:window.game}}),console.log("🔧 Attempting to create platform directly..."),xe(()=>Promise.resolve().then(()=>qe),void 0).then(s=>{const i=s.detectPlatform();console.log("✅ Created fallback platform:",i),this.scene.game.registry.set("platform",i),window.platform=i,this.handleWalletConnect()}).catch(s=>{console.error("❌ Failed to create fallback platform:",s)});return}console.log("📱 Platform object:",e),console.log("🔍 Platform constructor name:",e?.constructor?.name),console.log("🔍 Platform methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(e||{}))),console.log("🔌 Platform.connectWallet exists?",typeof e.connectWallet=="function"),console.log("🔌 Platform.connectWallet value:",e.connectWallet);const t=this.container.getByName("walletButton");if(t){const s=t.list[1],i=s.text;s.setText("CONNECTING...");try{const a=await e.connectWallet();a?(s.setText("💰 CONNECTED"),console.log(`✅ Wallet connected: ${a}`)):s.setText(i)}catch(a){console.error("Wallet connection failed:",a),s.setText(i)}}}getIsOpen(){return this.isOpen}toggle(){this.isOpen?this.close():this.open()}}class ve{scene;chapters;loadedTextures;textureCache;MAX_CACHED_BACKGROUNDS=10;PRELOAD_COUNT=2;currentChapter="";currentLevel=1;beastModePool=[];lastBeastModeRotation=0;backgroundUrls;beastModeLoadingProgress=0;beastModeFullyLoaded=!1;loadingBatches=[];progressiveLoadTimer;constructor(e){this.scene=e,this.loadedTextures=new Set,this.textureCache=new Map,this.chapters=new Map,this.backgroundUrls=new Map,this.initializeChapters(),this.initializeBackgroundUrls()}initializeChapters(){this.chapters.set("crystal_cavern",{name:"Crystal Cavern",levelRange:[1,10],backgrounds:["crystal-cavern-1","crystal-cavern-2","crystal-cavern-3","crystal-cavern-4","crystal-cavern-5","crystal-cavern-6","crystal-cavern-7","crystal-cavern-8","crystal-cavern-9","crystal-cavern-10"],theme:"underground crystal caves with glowing gems"}),this.chapters.set("volcanic_crystal",{name:"Volcanic Crystal Cavern",levelRange:[11,20],backgrounds:["volcanic-crystal-1","volcanic-crystal-2","volcanic-crystal-3","volcanic-crystal-4","volcanic-crystal-5","volcanic-crystal-6","volcanic-crystal-7","volcanic-crystal-8","volcanic-crystal-9","volcanic-crystal-10"],theme:"lava-infused crystal formations, heat effects"}),this.chapters.set("steampunk",{name:"Steampunk Crystal Cavern",levelRange:[21,30],backgrounds:["steampunk-1","steampunk-2","steampunk-3","steampunk-4","steampunk-5","steampunk-6","steampunk-7","steampunk-8","steampunk-9","steampunk-10"],theme:"industrial machinery, gears, steam pipes"}),this.chapters.set("storm",{name:"Electrified Crystal Cavern",levelRange:[31,40],backgrounds:["electrified-1","electrified-2","electrified-3","electrified-4","electrified-5","electrified-6","electrified-7","electrified-8","electrified-9","electrified-10"],theme:"lightning, clouds, turbulent weather"}),this.chapters.set("galactic",{name:"Galactic Crystal Cavern",levelRange:[41,50],backgrounds:["galactic-1","galactic-2","galactic-3","galactic-4","galactic-5","galactic-6","galactic-7","galactic-8","galactic-9","galactic-10"],theme:"space, stars, nebulae, cosmic themes"}),this.chapters.set("beast_mode",{name:"Beast Mode",levelRange:[51,1/0],backgrounds:["beast-mode-1","beast-mode-2","beast-mode-3","beast-mode-4","beast-mode-5","beast-mode-6","beast-mode-7","beast-mode-8","beast-mode-9","beast-mode-10","beast-mode-11","beast-mode-12","beast-mode-13"],theme:"random pool from all chapters plus exclusive beast backgrounds"}),this.chapters.set("bonus",{name:"Special Bonus",levelRange:[-1,-1],backgrounds:["bonus-1","bonus-2","bonus-3","bonus-4","bonus-5","bonus-6","bonus-7"],theme:"unique backgrounds for bonus levels"})}initializeBackgroundUrls(){this.backgroundUrls.set("volcanic-crystal-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2011-GZe4EOiyQqMVmrL1suPvCfj2H7XRyU.png?h8lo"),this.backgroundUrls.set("volcanic-crystal-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2012-Xpfr4nKJX0JcfLlrjZxaw0UVKr3xRJ.png?VTjY"),this.backgroundUrls.set("volcanic-crystal-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2013-5VWrULlkLRSqGhIPYBKAGOlY7cvDJs.png?spcG"),this.backgroundUrls.set("volcanic-crystal-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2014-1gw8iVsW1NFUtTX9qkrCaOkzceXgZa.png?uJJ4"),this.backgroundUrls.set("volcanic-crystal-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2015-My6wxLCAKkrjp7DnRUhTTNzy4pGzNz.png?wogd"),this.backgroundUrls.set("volcanic-crystal-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2016-HvPApBdJnsvIKOHL12BVv7OOCRvtXl.png?JpAr"),this.backgroundUrls.set("volcanic-crystal-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2017-M4H2arE4cKPFCFnWvPKeO75XQhGeTr.png?aP8G"),this.backgroundUrls.set("volcanic-crystal-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2018-EaBUdUtkhdA9O7UPGhUzbCSufw5Id3.png?7XYw"),this.backgroundUrls.set("volcanic-crystal-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2019-ypt8lxgxyGduFRNsmei09BL2mKGIYH.png?ojyx"),this.backgroundUrls.set("volcanic-crystal-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2020-VoCdHbTIAHWaULUuJAu1kL8TiARBUM.png?CK3z"),this.backgroundUrls.set("steampunk-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2021-DPL9BM5HXEAbpVzWP2BTZAfO33f54v.png?1fKU"),this.backgroundUrls.set("steampunk-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2022-qDjjzq1C2FmwcHMYRZTzpaGej0yGwb.png?5CrH"),this.backgroundUrls.set("steampunk-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2023-lLNjfzk4mhhPURUbkfRTMNdLplNM22.png?uDB5"),this.backgroundUrls.set("steampunk-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2024-Krew0eCXapHP78qdwQrgTp7Pvy9IMQ.png?tp0E"),this.backgroundUrls.set("steampunk-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2025-bROe8HWWQGVwbIcF2TrA4E3jOprfVJ.png?Z70l"),this.backgroundUrls.set("steampunk-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2026-UTEcGMcuwl5X6QRJj3TEmJxuQMtAVB.png?YEJ9"),this.backgroundUrls.set("steampunk-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2027-QsWK3rAAwdnMlTzY0zQlIQlqYIeZoe.png?v371"),this.backgroundUrls.set("steampunk-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2028-qunz3jvjcvUy0scMr4b18HIWuEABkb.png?DG4r"),this.backgroundUrls.set("steampunk-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2029-metaGhO5uoqBktHCQnoqNmrXrancE4.png?XeH2"),this.backgroundUrls.set("steampunk-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2030-qYeBT9cn6x3uAG4WvPeSa3clML1HpD.png?As4y"),this.backgroundUrls.set("electrified-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2031-O06tOHxb8b80yfdepBVLj3wJjNDMju.png?ILXr"),this.backgroundUrls.set("electrified-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2032-1YFN1MhcMfKXh149SshcFyW07KBHCG.png?PXOw"),this.backgroundUrls.set("electrified-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2033-ve4BB0Wu6RoMblkZbGmx2ST3IyfWHn.png?6pEl"),this.backgroundUrls.set("electrified-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2034-9DMyTcBY2QhKKTskDe6bzWXRZsgLlT.png?Hr6t"),this.backgroundUrls.set("electrified-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2035-qNc9FoZH60Awf13ISIvHpDNSNJifFq.png?Dagv"),this.backgroundUrls.set("electrified-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2036-365hGJnOHpzVyTOpa1618kVJMi6UlX.png?DkAI"),this.backgroundUrls.set("electrified-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2037-KOs54KffvnmZRGfkzDmk3GRvpjQ7mg.png?Edo8"),this.backgroundUrls.set("electrified-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2038-oU56rbW3kuE6MYNXgMgvasvWprLYu4.png?f0hH"),this.backgroundUrls.set("electrified-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2039-4xcZEcBBGlY6iMfY9CO5qh6CtjIbDe.png?otb6"),this.backgroundUrls.set("electrified-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2040-Dr5Q2cJ64opY0LX1D8wIyzMhKfcaEY.png?CbYG"),this.backgroundUrls.set("galactic-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2041-ojno2HZouD4Dt2V1Z8lPT8g9TkR4ie.png?zuLt"),this.backgroundUrls.set("galactic-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2042-zErQ0r8sKPMfgFQwVz0s3ZiGFbdWHA.png?Dppy"),this.backgroundUrls.set("galactic-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2043-RNzRiZW56aIS7iwgav4eUdiwLVjXeD.png?twVY"),this.backgroundUrls.set("galactic-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2044-gn593N3qTHsJT0UPP8gegOuTUMo1y5.png?oLhA"),this.backgroundUrls.set("galactic-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2045-eZS62LEmA5ziCPOdP2Q4F03IIqppAj.png?GGbK"),this.backgroundUrls.set("galactic-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2046-FblgXgSZg6UsQw0SjYc2kIiHh0KH2P.png?CjZV"),this.backgroundUrls.set("galactic-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2047-MZmOHh8GVZiGayV8U0klva12TlXzFq.png?0Irb"),this.backgroundUrls.set("galactic-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2048-4AZugPAFLnrLSulJNqKCiApLZwTYu6.png?3oKl"),this.backgroundUrls.set("galactic-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2049-MqGMDTShcuUgAj5bNZJITaKkhOjNhR.png?iYFP"),this.backgroundUrls.set("galactic-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2050-ff9za6km5crBBMDI3SCAAMmFudZq8E.png?s174"),this.backgroundUrls.set("bonus-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%201-sSavRhv3PSULBYqZTyGpCnPdMjhAq2.png?5PEU"),this.backgroundUrls.set("bonus-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%202-w0skJJAvJH9cYfQluphIJQwMFJpgK3.png?q77P"),this.backgroundUrls.set("bonus-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%203-kn73QdXKclD3LrMf3BXOH4B3ujbuxN.png?t9Nv"),this.backgroundUrls.set("bonus-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%204-opRR6rXctR8XkRkQIo5LfITdiyHhzq.png?Yubo"),this.backgroundUrls.set("bonus-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%205-FOtt55z5rVDYStfszLrUJRnnpovVMb.png?RCnr"),this.backgroundUrls.set("bonus-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%206-mAMzjvs6bdoK8SLuFaztJphnDOLA9U.png?j0bG"),this.backgroundUrls.set("bonus-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%207-9aPLVTEEDFoFgelvBQTC9ISErnYBCj.png?Ongz"),this.backgroundUrls.set("beast-mode-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%201-sRb0H9ErQnF9lBm5DuUzqtpwbZkRVS.png?3q8c"),this.backgroundUrls.set("beast-mode-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%202-LUcNgytry1u8MpUxWVGimvuMvTIVAT.png?vxmF"),this.backgroundUrls.set("beast-mode-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%203-goZNWmCpFDdm6dGhQdNO7CkgPLwqME.png?ExJw"),this.backgroundUrls.set("beast-mode-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%204-d2C0xeqQEzBvpaqO7diW0kqqPLOsk6.png?xmRP"),this.backgroundUrls.set("beast-mode-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%205-dCQCUxMIvQGPsWXKVh8hzq3dX8M7TA.png?M3Hi"),this.backgroundUrls.set("beast-mode-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%206-eOFodTEiDxDZUN3E4wIMGwzxUJ8QIK.png?1gGD"),this.backgroundUrls.set("beast-mode-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%207-TmIgs4UZyBWqt2718z94QbOAdLdlcS.png?iWFS"),this.backgroundUrls.set("beast-mode-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%208-vkOQZUrtkY7OX8U7lF5G9QCnRGKYq0.png?26ru"),this.backgroundUrls.set("beast-mode-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%209-3U9nvV48tv4NvvdFgqprbv3HcVgGg1.png?tx2Q"),this.backgroundUrls.set("beast-mode-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2010-9N8a5M5G9wI0OVoSMXBhlHPqaLg2d2.png?mPP6"),this.backgroundUrls.set("beast-mode-11","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2011-ujFZSIcr0VPwhT4smr13EPziNY4kEa.png?Rnqv"),this.backgroundUrls.set("beast-mode-12","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2012-hjyMpMwqW5hKpVPAsFGPaxuD5RaC7B.png?A52X"),this.backgroundUrls.set("beast-mode-13","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2013-iekgQPJN2LYhyLP6LETjP8hkD2IlnD.png?3eMk")}getChapterForLevel(e,t=!1){return t?"bonus":e>=51?"beast_mode":e>=41?"galactic":e>=31?"storm":e>=21?"steampunk":e>=11?"volcanic_crystal":"crystal_cavern"}getBackgroundForLevel(e,t=!1){const s=this.getChapterForLevel(e,t);if(this.currentLevel=e,s!==this.currentChapter&&(this.currentChapter=s,s==="beast_mode"))return this.getBeastModeBackground(e);const i=this.chapters.get(s);if(!i||i.backgrounds.length===0)return this.getFallbackBackground(e);if(s==="bonus"){const l=(Math.floor(e/10)-1)%i.backgrounds.length;return i.backgrounds[l]}const a=(e-i.levelRange[0])%i.backgrounds.length;return i.backgrounds[a]}getBeastModeBackground(e){e%5===0&&e!==this.lastBeastModeRotation&&(this.lastBeastModeRotation=e,this.rotateBeastModePool()),this.beastModePool.length===0&&this.loadBeastModePool();const t=(e-51)%this.beastModePool.length;return this.beastModePool[t]}loadBeastModePool(){if(this.beastModeFullyLoaded){const e=[];this.chapters.forEach((s,i)=>{i!=="beast_mode"&&e.push(...s.backgrounds)}),this.beastModePool=[...e];const t=this.chapters.get("beast_mode");t&&t.backgrounds.length>0&&this.beastModePool.push(...t.backgrounds)}}prepareBeastModeBatches(){this.loadingBatches=[];const e=["crystal_cavern","volcanic_crystal","steampunk","storm","galactic","bonus"];for(const t of e){const s=this.chapters.get(t);if(s)for(let i=0;i<s.backgrounds.length;i+=10){const a=s.backgrounds.slice(i,Math.min(i+10,s.backgrounds.length));this.loadingBatches.push(a)}}console.log(`📦 Prepared ${this.loadingBatches.length} batches for progressive loading`)}startProgressiveBeastModeLoading(){if(this.loadingBatches.length===0){this.beastModeFullyLoaded=!0,console.log("✅ Beast Mode fully loaded!"),this.loadBeastModePool();return}this.progressiveLoadTimer&&this.progressiveLoadTimer.destroy();let e=0;this.progressiveLoadTimer=this.scene.time.addEvent({delay:2e3,repeat:this.loadingBatches.length-1,callback:async()=>{if(e<this.loadingBatches.length){const t=this.loadingBatches[e];console.log(`📥 Loading batch ${e+1}/${this.loadingBatches.length}`),await this.loadBackgroundBatch(t),this.beastModePool.push(...t),this.beastModeLoadingProgress+=t.length,e++,e>=this.loadingBatches.length&&(this.beastModeFullyLoaded=!0,console.log(`✅ Beast Mode fully loaded! Total backgrounds: ${this.beastModeLoadingProgress}`),this.loadBeastModePool())}}})}async loadBackgroundBatch(e){const t=[];for(const s of e)if(!this.loadedTextures.has(s)&&!this.scene.textures.exists(s)){const i=this.backgroundUrls.get(s);if(i){const a=new Promise(o=>{this.scene.load.image(s,i),this.scene.load.once("complete",()=>{this.loadedTextures.add(s),o()})});t.push(a)}}t.length>0&&(this.scene.load.start(),await Promise.all(t))}rotateBeastModePool(){for(let e=this.beastModePool.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this.beastModePool[e],this.beastModePool[t]]=[this.beastModePool[t],this.beastModePool[e]]}}selectRandomSubset(e,t){return[...e].sort(()=>.5-Math.random()).slice(0,t)}async loadChapterBackgrounds(e){if(e==="beast_mode"){console.log("🦾 Starting progressive loading for BEAST MODE"),this.beastModeLoadingProgress=0,this.beastModeFullyLoaded=!1;const i=this.chapters.get("beast_mode");i&&(await this.loadBackgroundBatch(i.backgrounds),console.log(`✅ Loaded initial ${i.backgrounds.length} Beast Mode exclusives`),this.beastModePool=[...i.backgrounds],this.beastModeLoadingProgress=i.backgrounds.length),this.prepareBeastModeBatches(),this.startProgressiveBeastModeLoading();return}const t=this.chapters.get(e);if(!t)return;console.log(`📥 Loading backgrounds for chapter: ${e}`);const s=[];for(const i of t.backgrounds)if(!this.loadedTextures.has(i))if(this.scene.textures.exists(i))this.loadedTextures.add(i);else{const a=this.backgroundUrls.get(i);if(a){const o=new Promise(l=>{this.scene.load.image(i,a),this.scene.load.once("complete",()=>{this.loadedTextures.add(i),console.log(`✅ Loaded background: ${i}`),l()})});s.push(o)}}s.length>0&&(this.scene.load.start(),await Promise.all(s))}unloadChapterBackgrounds(e){const t=this.chapters.get(e);t&&(this.loadedTextures.size<=this.MAX_CACHED_BACKGROUNDS||t.backgrounds.forEach(s=>{this.scene.textures.exists(s)&&s!==this.getBackgroundForLevel(this.currentLevel)&&(this.scene.textures.remove(s),this.loadedTextures.delete(s),this.textureCache.delete(s))}))}preloadNextLevels(e){for(let t=1;t<=this.PRELOAD_COUNT;t++){const s=e+t,i=this.getChapterForLevel(s);if(i!==this.currentChapter){this.loadChapterBackgrounds(i);break}}}disposeUnusedTextures(){this.getBackgroundForLevel(this.currentLevel);const e=new Set;for(let t=-1;t<=this.PRELOAD_COUNT;t++){const s=this.currentLevel+t;s>0&&e.add(this.getBackgroundForLevel(s))}this.loadedTextures.forEach(t=>{!e.has(t)&&this.loadedTextures.size>this.MAX_CACHED_BACKGROUNDS&&this.scene.textures.exists(t)&&(this.scene.textures.remove(t),this.loadedTextures.delete(t))})}isChapterTransition(e,t=!1){return t?!1:this.currentChapter==="bonus"?!0:this.getChapterForLevel(e)!==this.currentChapter}getChapterName(e,t=!1){const s=this.getChapterForLevel(e,t);return this.chapters.get(s)?.name||"Unknown"}getBeastModeLoadingProgress(){return{loaded:this.beastModeLoadingProgress,total:70,percentage:Math.round(this.beastModeLoadingProgress/70*100)}}isBeastModeFullyLoaded(){return this.beastModeFullyLoaded}getFallbackBackground(e){return"crystal-cavern-bg"}generateProceduralBackground(e){return this.getFallbackBackground(this.currentLevel)}addBackgroundUrls(e,t){const s=this.chapters.get(e);s&&(s.backgrounds=t)}getCurrentChapterInfo(){const e=this.chapters.get(this.currentChapter);if(!e)return{name:"Unknown",theme:"",progress:0};let t=0;if(this.currentChapter!=="beast_mode"){const[s,i]=e.levelRange;t=(this.currentLevel-s)/(i-s+1)*100}return{name:e.name,theme:e.theme,progress:Math.min(100,Math.max(0,t))}}}class Ge extends Phaser.Scene{platforms;ladders;spikes;player;cats;stalkerCats;baseBlus;beetles;rexEnemies;coins=[];blueCoins=[];diamonds=[];freeLifes=[];invincibilityPendants=[];treasureChests=[];crystalBalls=[];crystalBallProjectiles=[];levelHasCrystalBall=!1;cursedOrbs=[];cursedTealOrbs=[];levelHasCursedOrb=!1;levelHasCursedTealOrb=!1;isGameOver=!1;floorLayouts=[];ladderPositions=new Map;doorPositions=new Map;score=0;accumulatedScore=0;scoreText;currentFloor=0;lives=3;totalCoinsCollected=0;totalGemsCollected=0;totalBlueGemsCollected=0;totalDiamondsCollected=0;livesEarned=0;livesText;livesIcon;coinCounterText;COINS_PER_EXTRA_LIFE=150;MAX_LIVES=99;hamburgerMenuButton;highestFloorGenerated=5;touchControls;justKilledCat=!1;comboCount=0;comboTimer=null;comboText;visibilityMask;visibilityRadius=160;invincibilityActive=!1;invincibilityTimer=null;invincibilityTimerImage;invincibilityTimerMask;invincibilityTimeRemaining=0;invincibilityTimerSparkleTimer=null;invincibilityWarningPlayed=!1;crystalBallTimerImage;crystalBallTimerMask;cursedOrbTimerImage;cursedOrbTimerMask;cursedTealOrbTimerImage;cursedTealOrbTimerMask;darknessOverlay;playerGoldenAura=null;playerParticleTrail=[];playerSpikeOverlap=null;playerSpikeCollider=null;levelManager;levelText;menuOverlay;backgroundMusic;backgroundManager;beastModeLoadingText;beastModeLoadingTimer;gameStats={treasureChestsOpened:0,enemyKills:{caterpillar:0,rollz:0,chomper:0,snail:0,bouncer:0,stalker:0,rex:0,blu:0},totalEnemiesDefeated:0,highestFloor:0,livesLost:0};currentBackground="background-treasure-quest-5";backgroundLibrary=["background-treasure-quest-5","background-treasure-quest-6","background-treasure-quest-7"];backgroundSprite=null;backgroundInitialY=0;backgroundHeight=0;recentTiles=[];tileGrid=new Map;tileUsageCount=new Array(12).fill(0);door=null;isLevelStarting=!1;isLevelComplete=!1;assetPool;speechBubble=null;thoughtBubble=null;bubbleTimer=null;BUBBLE_DISPLAY_TIME=3e3;constructor(){super({key:"GameScene"})}loadingOverlay=null;showLoadingScreen=!1;preloadChapterText;preloadLoadingText;instantLoadingScreen;init(e){this.reopenMenuAfterInit=e?.reopenMenu||!1;const t=this.game.registry.get("isDeathRetry")||!1,s=this.game.registry.get("playerLives")||0,i=this.game.registry.get("isReplay")||!1,a=i||t&&s>0;this.showLoadingScreen=!a,console.log(`🎬 Loading screen decision: isReplay=${i}, isDeathRetry=${t}, skip=${a}, SHOW=${this.showLoadingScreen}`),this.levelManager=new fe,this.backgroundManager=new ve(this),this.cameras.main.setBackgroundColor(3023688);const o=this.registry.get("currentLevel")||1,l=`loading-screen-${o>=51?51:o>=41?41:o>=31?31:o>=21?21:o>=11?11:1}`;if(this.textures.exists(l))console.log(`⚡ Using pre-generated loading screen: ${l}`),this.instantLoadingScreen=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,l),this.instantLoadingScreen.setOrigin(.5),this.instantLoadingScreen.setDepth(1e5);else{console.log("⚠️ No pre-generated loading screen, creating text");const r=p.canvas.width/2,n=p.canvas.height/2,c=this.add.text(r,n,"LOADING...",{fontSize:"24px",fontFamily:"Arial, sans-serif",color:"#FFFFFF",fontStyle:"bold"});c.setOrigin(.5),c.setDepth(1e4),this.preloadLoadingText=c}console.log("🎮 GameScene.init() - Loading screen displayed")}preload(){console.log("🔄 GameScene.preload() started at",performance.now());const e=$.getPreloadedCount();e>0&&console.log(`✨ Found ${e} preloaded assets from InstructionsScene`),this.assetPool=new Ae(this);const t=[{key:"visibilityOverlay",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO",type:"image",retries:3},{key:"background-treasure-quest-5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1",type:"image",retries:3},{key:"background-treasure-quest-6",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%206-gX1QoTf3UJnMPvbDKVt9hYGDD1AltE.png?LWtY",type:"image",retries:3},{key:"background-treasure-quest-7",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%207-YeACeKZk8lSEU1IDy5zOU6G79VqYKx.png?TWtQ",type:"image",retries:3},{key:"playerIdleEye1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%201-p01pa3z9fL9AyLQolMuYyBO3DIqgvB.png?FaaG",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%202-ngx0e1EF33iY14vRpcSvy8QOUjMKnl.png?lsFE",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBlink",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%20blinking-fDIX0Bin2Vh42SGyH0DT70fwWARivM.png?QXG7",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye3",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%203-TLisG1UJypI7PhiKszpBcC8Nx8ZyrS.png?6Tg9",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye4",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%204-kvrv3THif8vcKjFB0NPzOeclqapVi6.png?PuWO",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%205-1P13Nmi3xqoC5kWevrWUxutqyXfr99.png?F4D2",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBootyLeft",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/booty%20shaking%20left%20cheek-c4bJ5CnHbeRJc6LN3OSetpPvTNby88.png?zEph",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBootyRight",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/booty%20shaking%20right%20cheek-7eORz1b8ditvsXDolmHCEUlk7Wmvvd.png?UT5w",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerClimbLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/climbing%20ladder%20left%20foot%20up-Oipv0p2kIPLZcoV2XBC7FMjkKAzxOk.png?6y8P",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerClimbRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/climbing%20ladder%20right%20foot%20up-A7A5enZp5Z0EeXRZE8MVGvLZ9Jx5Ll.png?Hwlb",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerJumpLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/jumping%20left%20foot%20forward-mXUWm73dYQqZMOkl9Wn4MjBnzEdZjX.png?49nU",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerJumpRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/jumping%20right%20foot%20forward-qLrBUCfcOJhpnlFrfX8taL39RPnq4P.png?1QLd",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerRunLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20left%20foot%20forward%20new-aH3WiqHkbYLeW14yketC7EdmowlQ02.png?jLLJ",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerRunRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Running%20right%20foot%20forward-FGGa0yxLpub6kRyvYj29zhOqx4sVj3.png?VhAX",type:"image",retries:3,fallback:"defaultPlayer"},{key:"blueEnemy",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/enemy%20test%201-DFzrumkmpUN5HOwL25dNAVJzRcVxhv.png?rxbT",type:"image",retries:3,fallback:"defaultEnemy"},{key:"tealLadder",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/new%20ladder-ULDbdT9I4h8apxhpJI6WT1PzmaMzLo.png?okOd",type:"image",retries:3}];this.assetPool.registerAssets(t),this.assetPool.createCommonFallbacks(),this.load.image("blueEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/enemy%20test%201-DFzrumkmpUN5HOwL25dNAVJzRcVxhv.png?rxbT"),this.load.image("visibilityOverlay","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO"),this.load.image("custom-dpad","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/dpad-HlSoc5tt8vs8cjbkEROL1GjaGzx8Ko.png?ecZG"),this.load.image("custom-jump-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20button-yS4IpgcdvQerPZjpif3tOLmqIfO7yE.png?pRZm"),this.load.image("custom-action-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/action%20button-0ijEeXV3alwc5ZbDzkD4HaP7PXzsAN.png?1zZP"),this.load.image("test-hud-bg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/test%20gem%20for%20hud-7RamXtpyUYcrX6K6DLnuWOD7ZNssLi.png?1boq"),this.load.image("hud-bg-200","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/gem%20for%20hud-pTsDx0VNBRQzAIh45KCFTFoU0pM1om.png?4RuD"),this.load.image("blueEnemyMouthClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed-HUXqx9HBdotEhJE2LBgzK8Z4kA7e2H.png?AVKZ"),this.load.image("blueEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed%20blinking-bJ1xwYkoCZvjd4T9MdXzR45PfaZIcF.png?6LRV"),this.load.image("blueEnemyMouthPartialOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20partially%20open-PrzEwLEPYIPE6pJTgHBWV7SVvKYcSX.png?0RG2"),this.load.image("blueEnemyMouthPartialOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20partially%20open%20blinking-GfMaaIsvJGkTrtx4vIFnh11fvyTc5N.png?d3qY"),this.load.image("blueEnemyMouthOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20open-4hO9JLZDfnWgcQWlvfqiU7SCOXaA0g.png?sh1i"),this.load.image("blueEnemyMouthOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20open%20blinking-Nl5UA9KyScZCBwu9BrKXR0IdNk3aen.png?B9Tr"),this.load.image("purpleEnemyMouthClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20closed%20mouth-l01A99F3sINIeGx2hkb33YVS16xa3k.png?DjP8"),this.load.image("purpleEnemyMouthPartialOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20mid%20mouth-OvzgXzA7k4tlCopnJB6tiD0RqjATsS.png?wV23"),this.load.image("purpleEnemyMouthOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20full%20open%20mouth-H4bWdRYA3801jLzUyCiuevtXxj8Hmu.png?MkMw"),this.load.image("redEnemyMouthClosedEyes1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%201-RKF3p3F7fxdBSfen8UD9UGqIzf8zlv.png?xRpM"),this.load.image("redEnemyMouthClosedEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%202-vLWsEKkj7nPhdADyj947N0FQDi3QUf.png?Z82J"),this.load.image("redEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%20blinking-PiVnlocHV8Fra4PC2jrZGZISgIPvsv.png?aQjM"),this.load.image("redEnemyMouthPartialOpenEyes1Wink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20partially%20open%20eyes%201%20with%20one%20blinking-CuKxjBkQYU77bxH1e6KMS5tIdsz17T.png?G49S"),this.load.image("redEnemyMouthPartialOpenEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20partially%20open%20eyes%202-A43kcb28mR0IQbtfIU0KJJqBswRrlD.png?QDz4"),this.load.image("redEnemyMouthWideOpenEyes1Wink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%201%20with%20one%20blinking-bYhh1tBYiobaJsDTFoTkLpbeTJY8vs.png?7MZ2"),this.load.image("redEnemyMouthWideOpenEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%202-eeVDATMEgV6VQ9mPDfyEX1CFJPPr4W.png?RQBw"),this.load.image("redEnemyMouthWideOpenEyes3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%203-BYXzuHGU9Dd18kQEB6bztT5k8jFhJt.png?IzuG"),this.load.image("greenEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20right-Lv7YvIjvADM6LmR0OfFEXE674NoQag.png"),this.load.image("greenEnemyEyeCenter","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20center-vxgpMOLHN5TR5FtXa3BLrddj1H4lzA.png"),this.load.image("greenEnemyEyeLeft","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20middle-JpsQ7yYaUP00AU4NCh54ULeIW6lLTK.png"),this.load.image("greenEnemyBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20blinking-Syo5f9Tq7RWub8unCEcZbS7iuykZNI.png"),this.load.image("stalkerEnemyEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%201-Xt3Vtu2FiWWLT9l2wfeakBAqVSZet8.png?gS6O"),this.load.image("stalkerEnemyEye2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%202-n2c58R6bdpzzPAVlVRgMZoKmngtTUo.png?nTFi"),this.load.image("stalkerEnemyEye3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%203-K1hEnZ0oXDlCbLGCuJz1GD1YbYATZ6.png?safa"),this.load.image("stalkerEnemyEye4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%204-Y0pnlUUMFdmHY7HxQk2gGe9Nr41glQ.png?cgFm"),this.load.image("stalkerEnemyBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%205%20blinking-CPlBOBjLFGic1DKAwXNjnMpyRwBVgr.png?vYe6"),this.load.image("stalkerEnemyEyeOnly","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%20only-3BuhEI2UePG6So3jAYE5NPnoQTsnc0.png?6wB1"),this.load.image("playerIdleEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%201-aD6V48lNdWK5R1x5CPNs4XLX869cmI.png?0XJy"),this.load.image("playerIdleEye2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%202-oQdxdPT1VWpTLUelgIRXIHXFw5jEuu.png?nGbT"),this.load.image("playerIdleBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%20blinking-qmZlXgNwk3w2B610GpK1dkndEDFmEg.png?q97J"),this.load.image("playerIdleEye3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%203-TLisG1UJypI7PhiKszpBcC8Nx8ZyrS.png?6Tg9"),this.load.image("playerIdleEye4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%204-kvrv3THif8vcKjFB0NPzOeclqapVi6.png?PuWO"),this.load.image("playerIdleEye5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%205-1P13Nmi3xqoC5kWevrWUxutqyXfr99.png?F4D2"),this.load.image("playerClimbLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20ladder%20left%20foot%20up-HkXPep0kpt9he1WtndEXsXRVHQBdlq.png?ncVM"),this.load.image("playerClimbRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20ladder%20right%20foot%20up-hkc4X4pm3mSs1J3UpRQwRw8GhealC6.png?t8RZ"),this.load.image("playerJumpLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20left%20foot%20forward-DVmoTTdCOBfI9FRTg9vs949sTzKoOB.png?9FM5"),this.load.image("playerJumpRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20right%20foot%20forward-3clf2KnwfbN3O6BsrtaeHSTAviNbnF.png?xx8e"),this.load.image("playerRunLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20left%20foot%20forward%20new-aH3WiqHkbYLeW14yketC7EdmowlQ02.png?jLLJ"),this.load.image("playerRunRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Running%20right%20foot%20forward%202-aGnWjaFUNnYXwTfNKfSCfCLppOHzDU.png?mXmE"),this.load.image("playerRunBody","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body-bM1vl3T1vsaGXNpy1aSdQTw7y8yJWK.png?laFZ"),this.load.image("playerRunBodyEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%202-RdbQz9dbHYM8AMsZxEE7BLRbMD4rUT.png?AhxN"),this.load.image("playerRunBodyEyes3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%203-L2mDyCxbHwvlp6DEq6gxihPbgctDYV.png?tasV"),this.load.image("playerRunBodyEyes4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%204-ZfdYFT0Njqb5scTp0hVEzTo9Z9b2Cp.png?QE3U"),this.load.image("playerRunBodyEyes5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%205-ukOG4fy50XhZTYC6nSIg466Fi8rS1I.png?Oeos"),this.load.image("playerRunBodyEyes6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%206-Ce3qtFJFdtq95juwg15T9jLnK7kkWb.png?Gg1B"),this.load.image("playerRunBodyEyes7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%207-QPAzARJE1Zzu1uOpV808LTO0Kaeoqo.png?7N69"),this.load.image("playerRunBodyBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%20blinking-tpJuDG5352O6gg9GHvj0owyZ7Vo4sy.png?eKh3"),this.load.image("playerRunLegsBothDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/both%20feet%20down-Df4cKPxtG04wJmnzY3QzaUeW22F1BN.png?Iekl"),this.load.image("playerRunLegsLeftMid","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/left%20foot%20up%20mid-DpJL6NyL9T7l7vzP8e2jfvpTJwvofR.png?rZfI"),this.load.image("playerRunLegsLeftHigh","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/left%20foot%20up%20high-jcTqik4ucIuoIwjkuG5a8cmOe9vrDu.png?wU6d"),this.load.image("playerRunLegsRightMid","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/right%20foot%20up%20mid-Qr5UwoShdZYlJJsGojNP8offBrp0yV.png?nrOQ"),this.load.image("playerRunLegsRightHigh","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/right%20foot%20up%20high-e5syDsyAyHiLXqTbbeBGoyUIwV8ZTB.png?c7fW"),this.load.image("purple-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/purple%20chest-4wMMVDFuAO3FpYyH7edWzeA3xVENZw.png?IkvS"),this.load.image("teal-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20chest-FpKKXWv5XWlb5H19IHW0G49DAm7Adb.png?Odul"),this.load.image("yellow-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20chest-QMRMmVk9i7S0qkLteaXfhjqQBI351B.png?sE5u"),this.load.image("crystalBallCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("crystalBallProjectile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("crystalBallTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20timer-DXFxS1g5ICpECl1vorurI4vQgShlfI.png?VWVq"),this.load.image("cursedOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb-rHogWhnYUk2xThrTWajfHqMSfxeyfd.png?0wr6"),this.load.image("cursedTealOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb-wupZvLrfiaRIZZyP4TbIOq5HLiVsXz.png?i2qV"),this.load.image("cursedOrbTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb%20timer-5VBMFlHiVp24NkCpIhkDD4dc6fKiHK.png?hHIh"),this.load.image("cursedTealOrbTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb%20timer-FAoT2eYLkUGfQRCCfS5qwZOkMvFBTg.png?FMZ7"),this.load.image("door-sprite","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U"),this.load.image("door-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/door%20for%20hud-veW9YPgRL7GNNZWIF1VkHhGzn4MgcH.png?x2hT"),this.load.image("crystal-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20hud%20icon-6cCEP7jp90eqI7W9LeBp7v4s3OgCPX.png?nMJm"),this.load.image("talking-bubble","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/go%20bizarre%20talking%20bubble-QlBbag1lDPx9SbnKTlgwwCZ12Fowh2.png?h0Cw"),this.load.image("crystal-cavern-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%201-o5M2rYkM5ffKmdp8pMw6QzmR87KA0k.png?4qbf"),this.load.image("crystal-cavern-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%202-Sdyqtq58gC1XVkllts47M2AzYOTgpX.png?0mX8"),this.load.image("crystal-cavern-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%203-iE9A520YoUrX7GIVwgKojzeC0JuMlg.png?R6UH"),this.load.image("crystal-cavern-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%204-oMun45XW8jHJAX8lWQ3HbOad2TL5gt.png?3ulH"),this.load.image("crystal-cavern-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%205-AQS3zCiGE8QOqamLmdoOJ7SjecHlW8.png?d4aM"),this.load.image("crystal-cavern-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%206-dqO5JRSPRzu4pkpC66pBTL416gw0iV.png?wGuc"),this.load.image("crystal-cavern-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%207-rPVZWuJSGouJJHwzx0PYjHIJ9AWeOG.png?3QAw"),this.load.image("crystal-cavern-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%208-AKdyp1OQa5qT20Wab5aCgnMKwpPEY9.png?ejNY"),this.load.image("crystal-cavern-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%209-s5weyP0mb0UngvFh3FP3FS4s4OuVCo.png?QS83"),this.load.image("crystal-cavern-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2010-HpLzzcMARGk4bAxftjkS7AcaLC3ljt.png?AETo"),this.load.image("crystal-cavern-bg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20background%20compressed-UKsRHy0KcxBQz6FuHbeLvlwcbd3LdS.png?ATB5"),this.load.image("yellowEnemyMouthOpenEyeOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20open%20mouth%20open-lQoAdkobZ4H1EzQlITXFW8pLyuzlpU.png?vG8O"),this.load.image("yellowEnemyMouthOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20closed%20mouth%20open-jvUJJbRjevmC71Cgw86fpsQGJQkwGK.png?yXzx"),this.load.image("yellowEnemyMouthClosedEyeOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20open%20mouth%20closed-6A2FG9PKDMrBHdE76pV9iALE66ogtp.png?L3eK"),this.load.image("yellowEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20closed%20mouth%20closed-Fv7QiPIbIYgPuqmUeGF8Gu234h9Xie.png?nEys"),this.load.image("blueCaterpillarEyesRight","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20right-rgnZpnvBWDB5xqNXCcFANHRKrytkRu.png?wuBQ"),this.load.image("blueCaterpillarEyesLeft","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20left-HsnjWSiRWtlaEQbj1rkVr1tbwQc9ky.png?gCNM"),this.load.image("blueCaterpillarEyesDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20down-WvFuBIqZBj1tTCA5FZUSNSRakKAXY3.png?EWfJ"),this.load.image("blueCaterpillarBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20blinking-JvNYqKH2z9dUyLPOko1QE2GJXwuL36.png?vqim"),this.load.image("gem-big-blue","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem-GzKKZKUsDMh3CXMEIV4OmMl4ksrqqm.png?sill"),this.load.image("gem-pink-round","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20round-E2EKGSTZHnnCdW0QkFmTDRKY7ERfw7.png?izQh"),this.load.image("gem-yellow-emerald","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20emerald-Z65ogfvE2NUX0AtxfwqgUKTooKPL1M.png?NJLZ"),this.load.image("gem-purple-opal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/purple%20opal-vq4CL7MxiGQDenIU0ZvqVQJJbWAvt5.png?GjQL"),this.load.image("gem-teal-triangle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20triangle-HVpi82a0c01MbkO92zYvH4tIN3CdMw.png?N700"),this.load.image("gem-diamond","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond-LB22Ijoji8erIrMFMvtSwd5Y9rDDwS.png?LlEv"),this.load.image("heart-crystal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/free%20life%20heart%20crystal-2EJMsIvSQKzdgrqytakBZcDbGf7Jpf.png?E1JG"),this.load.image("invincibility-pendant","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pendant-cJISby3d7EEREasbi0gRZkn2u3rNrG.png?xf9m"),this.load.image("invincibility-timer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/timer2-X3PMyQUgCU3fz146QaD9mBBy38e8Vw.png?Yy9W"),this.load.image("yellow-ceiling-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20spikes%20ceiling%20tile-8vq9W1Y2e1RSpgUfMl9sTp0ZILFHL3.png?mUEb"),this.load.image("pink-floor-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20spikes%20floor%20tile-ncAVgIHazwYlznCBP4H6LWLiIhN7OF.png?n27v"),this.load.image("baseblue-eyes-center","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20center-BWjYc09iCwYsTuEB3TEsa7GdmDc4Nj.png?NZtQ"),this.load.image("baseblue-eyes-down","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down-Vtp9tuVzlbp29Cn3GqoEVHzSGyZLYX.png?u15t"),this.load.image("baseblue-eyes-down-right","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down%20right-eJGRVL9E1aqNPUimWVa0aoEEHbmMca.png?ObTg"),this.load.image("baseblue-eyes-middle-right","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20middle%20right-ShBskufoh2zXFcfI5AHUCpx6ecnIWi.png?TizP"),this.load.image("baseblue-eyes-up","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20up-lot6W1Y3ns3uhL8Xd59yoSCusiT48e.png?fMIa"),this.load.image("baseblue-eyes-up-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20up%20left-biYISTHmHXS9VFQa63REv8KCGeHMC2.png?Fp2W"),this.load.image("baseblue-eyes-middle-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20middle%20left-o5tw4V3qJ9gmASZ2TjaeUcJpD220CM.png?bL2r"),this.load.image("baseblue-eyes-down-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down%20left-8txJQ9OPVkMTkW0eaWprmvS5igTbqZ.png?hOzV"),this.load.image("baseblue-eyes-blinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20blinking-nZFjSjOXa1RAYpXPefApbKEET49sRr.png?96YM"),this.load.image("beetle-mouth-closed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20closed-6ScuNGGsBgifOGHCCMext3ghafhXlB.png?XErn"),this.load.image("beetle-mouth-open-30","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2030-HXSFqNWDpvxFnv2l35lrddto2TAyCk.png?sdgg"),this.load.image("beetle-mouth-open-70","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2070-gToASj29g9XTDxUDHBKXDOfpYOKudu.png?uZh3"),this.load.image("rexEyesOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20eyes%20open-xKvtdvPdMIy13IjDLdWArsLxH3bi3m.png"),this.load.image("rexBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20eyes%20blinking-ix1xWvDmRTfWQT1HB22Z4z0lYCST06.png"),this.load.audio("background-music","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/CRYSTAL%20CAVERN%20-%20Treasure%20Quest%20-%20BizarreBeasts%20-%20MASTER%201-GnktEmoyUQQEEoFTBVrVAhEFyGRwL9.mp3?acKK"),this.load.on("loaderror",s=>{console.error("❌ Failed to load audio file:",s.key,s.url)}),this.load.on("filecomplete-audio-background-music",()=>{console.log("✅ Background music file loaded successfully")}),this.load.on("filecomplete-audio-splash-sound",()=>{console.log("✅ Splash sound file loaded successfully")}),this.load.audio("gem-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/regular%20gem%20collect%20sfx-OXLLrrAXWUz21oDTEuQPFb2fxRWxXh.wav?pH1V"),this.load.audio("diamond-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond%20collect%20sfx-V3aWJINX1e3OF5XZJFntg7WjpCup3Y.wav?A9QM"),this.load.audio("big-blue-gem-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem%20collect%20sfx-nYAUNJtHLMfNwACb6CM42eSQVAW6XG.wav?f8N2"),this.load.audio("heart-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20collect%20heart%20sfx-7SPaWI2NI7kkVlgjjKbYXCDQuXI4sG.wav?N1rD"),this.load.audio("cursed-orb-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/collect%20cursed%20orb%20or%20teal%20cursed%20orb-2KpSJv5Zd8lQ4OdgPtmn9YLlS0UqId.wav?ryTu"),this.load.audio("powerup-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/collect%20pendant%20or%20crystal%20ball-rEQiBqrl32yuqNts0U4A3Muol63Fxr.wav?eDiE"),this.load.audio("treasure-chest-open","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20chest%20opening%20sfx-qA8VU8UtwVC4fnaW67wfvM2IzTJRep.wav?WLuy"),this.load.audio("jump-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%201%20sfx-Cfx219m2NwhVClkP67iebiwcV0HiF5.wav?GDjY"),this.load.audio("jump-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%202%20sfx-UU3Gj2quONoFPk7SO3OI3koGgiSRGY.wav?4Zrt"),this.load.audio("jump-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%203%20sfx-8h2X8f0XZJYeVB65fDYk4hth9h1G0O.wav?Wpvy"),this.load.audio("player-land","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20lands%20after%20jump%20sfx-OoLEu6v6m6Oy51qVDCknLhjlMC3Awy.wav?xPtL"),this.load.audio("footstep","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/foot%20step-XZmhUkf7XprYQzm2GbUVYaPZKeW6it.wav?3Vyp"),this.load.audio("crystal-ball-throw","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/throw%20crystal%20ball%20sfx-oZfZHRmRnqebRdw2YrcMLR7LlLCMRp.wav?aKDe"),this.load.audio("crystal-ball-bounce","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20bounce%20sfx-bOZrWB6YiMh6bedqvdLw3YaW63MZxO.wav?ORcs"),this.load.audio("crystal-ball-hit-enemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20hits%20enemy-Rxq3kA6Q8rLBBb5PhGNdBhTI9AMo8W.wav?8sSG"),this.load.audio("continue-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%20complete%20continue%20button%20sfx-tKmarJUBWs3rQJhPDsv2IYj5oc8p5j.wav?V3lH"),this.load.audio("door-open","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/door%20open%20sfx-LqGIt2ZSLGjCz0lSbuC6F6yusdC97e.wav?hCxN"),this.load.audio("menu-toggle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/menu%20sound-uBdZpD8zUrdGkuqw7jw0j9339NP2wC.wav?rHPB"),this.load.audio("spike-hit","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20hits%20spikes%20sfx-Pt2SxNCgCXtyIz2jiBS3AYiCvYrp8X.wav?IM9a"),this.load.audio("player-dies-enemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20dies%20from%20enemy%20sfx-61hLKPCRlGrkam7zYIUuuWTwHFZXun.wav?d7C2"),this.load.audio("game-over","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/game%20over%20sfx-CcqXjJvB1fNTt9i31KIzjv0KLNN6CF.wav?OQAX"),this.load.audio("squish-caterpillar","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%201%20sfx-Q07M71fpvcarGwZ67kaOsiFBD8hQw9.wav?eCQ1"),this.load.audio("squish-beetle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Rollz%20squish%20sfx-ENEJDyuGH2imVNsLezuv5w3TzofWsG.wav?caYG"),this.load.audio("squish-chomper","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%202-euwtmXFPsH1NH9XQzixjo6lgeA7Nxd.wav?6rLZ"),this.load.audio("squish-snail","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%203-22EnbLa2GEVZPJCf7zWpqhYHS6V4K2.wav?h9e6"),this.load.audio("squish-jumper","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%201%20sfx-MBkO4SrZ1IVUJ6jqjHWa5L0NURtkJH.wav?qytP"),this.load.audio("squish-stalker","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%203-22EnbLa2GEVZPJCf7zWpqhYHS6V4K2.wav?h9e6"),this.load.audio("squish-baseblu","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blu%20squish%20sound-E5dxYXO43VnhG528IWOuy39JyeqnOf.wav?2NUq"),this.load.audio("squish-rex","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20squish%20sound-ZUynOxrurJ001uUoNvxJPYAg8dlChO.wav?FwYW"),this.load.image("floor-tile-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt"),this.load.image("floor-tile-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%202-EuITFMsdSDebMUmfcikeKCDLqDupml.png?C2mi"),this.load.image("floor-tile-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%203-EBjnmTXXufdUFEuzmfnGnaZX4zdI2C.png?69bT"),this.load.image("floor-tile-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%204-ecTwalLp4rzl9hegwIwVMuDBeN1YVJ.png?nxJJ"),this.load.image("floor-tile-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%205-mkUa3smxguUC6BG0k4RBp1L7YemLPJ.png?8kU2"),this.load.image("floor-tile-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%206-P5Eo0dOoipZmfiQ31gzPPNV178XDQz.png?K1oC"),this.load.image("floor-tile-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%207-nTcRVMkcmKM9dgxMMr6Fzs7Enekla1.png?cfe2"),this.load.image("floor-tile-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%208-ImcB9SO68kMOGAn6qXP0aioPKPbNxx.png?znlI"),this.load.image("floor-tile-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%209-VmOFC6UshXy3GJTAyKE5zi7p1oIyAJ.png?oTOf"),this.load.image("floor-tile-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2010-SX5i2rG63ddgysEAxLTRNQvfngiFaS.png?2Bsf"),this.load.image("floor-tile-11","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2011-JwdJf9Mmt0lEbFBGGwurBaYJL3uykp.png?w4JY"),this.load.image("floor-tile-12","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2012-yBmCpaIQiiV7MeRoxI54ACeE3W2f27.png?9jIm"),this.assetPool.loadAllAssets().then(()=>{this.registry.set("assetsReady",!0)}).catch(s=>{console.error("Asset loading failed:",s),this.registry.set("assetsReady",!0)})}init(e){this.reopenMenuAfterInit=e?.reopenMenu||!1;const t=this.game.registry.get("isDeathRetry")||!1,s=this.game.registry.get("playerLives")||0,i=this.game.registry.get("isReplay")||!1,a=i||t&&s>0;this.showLoadingScreen=!a,console.log(`🎬 Loading screen decision (2nd init): isReplay=${i}, isDeathRetry=${t}, skip=${a}, SHOW=${this.showLoadingScreen}`),this.cameras.main.setBackgroundColor("#1a0033")}reopenMenuAfterInit=!1;create(){console.log("🎮 GameScene.create() started at",performance.now()),console.log("📊 showLoadingScreen flag:",this.showLoadingScreen);const e=this.game.registry.get("platform")||window.platform||window.gamePlatform;if(e&&e.showWalletButton&&e.showWalletButton(),console.log("🎯 Scene Dimensions:",{game:{width:this.game.config.width,height:this.game.config.height,resolution:this.game.config.resolution},camera:{width:this.cameras.main.width,height:this.cameras.main.height,x:this.cameras.main.x,y:this.cameras.main.y,scrollX:this.cameras.main.scrollX,scrollY:this.cameras.main.scrollY},physics:{worldBounds:this.physics.world.bounds,gravity:this.physics.world.gravity},scale:{gameSize:this.scale.gameSize,parentSize:this.scale.parentSize,displaySize:this.scale.displaySize,mode:this.scale.scaleMode}}),this.showLoadingScreen){console.log("🎨 Creating loading screen elements...");const t=this.cameras.main.width,s=this.cameras.main.height;if(console.log(`📐 Screen dimensions: ${t}x${s}`),this.loadingOverlay=this.add.container(0,0),this.loadingOverlay.setDepth(1e4),console.log("📦 Loading container created"),this.textures.exists("instructionsBg")){console.log("🎨 Using instructions background image");const u=this.add.image(t/2,s/2,"instructionsBg"),g=t/u.width,b=s/u.height,y=Math.max(g,b);u.setScale(y),this.loadingOverlay.add(u);const f=this.add.rectangle(t/2,s/2,t,s,0,.5);this.loadingOverlay.add(f),console.log("🖼️ Instructions background added with overlay")}else{console.log("⚠️ Instructions background not found, using solid color");const u=this.add.rectangle(t/2,s/2,t,s,5046398,1);this.loadingOverlay.add(u),console.log("🟪 Purple background added")}const i=this.add.text(t/2,s/2-60,"GOING BIZARRE",{fontFamily:'"Press Start 2P", system-ui',fontSize:"28px",color:"#FF69B4",align:"center"});i.setOrigin(.5),i.setShadow(2,2,"#8B008B",4,!1,!0),this.loadingOverlay.add(i),console.log("💗 GOING BIZARRE text added");const a=t*.6,o=24,l=t/2,r=s/2+10;console.log(`📊 Progress bar dimensions: ${a}x${o} at (${l}, ${r})`);const n=this.add.rectangle(l,r,a,o,4915330);n.setStrokeStyle(3,16738740),this.loadingOverlay.add(n),console.log("📊 Progress bar background added");const c=this.add.rectangle(l-a/2+2,r,0,o-6,16738740);c.setOrigin(0,.5),this.loadingOverlay.add(c),console.log("📊 Progress bar fill added (starting at 0 width)");const h=this.add.text(t/2,s/2+50,"0%",{fontFamily:'"Press Start 2P", system-ui',fontSize:"16px",color:"#FF69B4",align:"center"});h.setOrigin(.5),this.loadingOverlay.add(h),console.log("💯 Percentage text added");let d=0;console.log("⏱️ Starting progress animation"),this.time.addEvent({delay:30,callback:()=>{if(d<100){d=Math.min(d+2,100);const u=Math.floor(d);c.width=(a-6)*(d/100),h.setText(`${u}%`),u%20===0&&u>0&&console.log(`📈 Progress: ${u}%`),d>=100&&(console.log("✅ Progress complete, removing overlay in 200ms"),this.time.delayedCall(200,()=>{this.loadingOverlay&&(console.log("🗑️ Destroying loading overlay"),this.loadingOverlay.destroy(),this.loadingOverlay=null),console.log("⬛ Setting black background for game"),this.cameras.main.setBackgroundColor("#000000"),this.checkForChapterSplash()}))}},repeat:-1}),console.log("📊 Progress timer started")}else this.cameras.main.setBackgroundColor("#000000"),this.checkForChapterSplash();console.log("🎨 Scene initialized")}checkForChapterSplash(){this.game.registry.get("isReplay")&&this.game.registry.set("isReplay",!1);const e=[1,11,21,31,41,51],t=this.game.registry.get("currentLevel")||1;console.log(`📊 Current level: ${t}`);const s=this.game.registry.get("showChapterSplash")===!0,i=this.game.registry.get("chapterSplashLevel")||t;if(s){console.log(`🎯 Showing chapter splash after bonus for level ${i}`),this.game.registry.set("showChapterSplash",!1),this.game.registry.remove("chapterSplashLevel");const r=`chapterSplashShown_${i}`;this.game.registry.set(r,!0),this.showChapterSplashScreen(i,()=>{console.log("✅ Splash complete after bonus, initializing game"),this.initializeGameState(),this.game.registry.set("levelProgression",!0),this.initializeGameAfterSplash()});return}const a=`chapterSplashShown_${t}`,o=this.game.registry.get(a)===!0,l=this.game.registry.has("playerLives")&&this.game.registry.get("playerLives")>0;if(e.includes(t)&&!o&&!l){console.log(`🎬 Chapter splash needed for level ${t} (first time)`),this.game.registry.set(a,!0),this.showChapterSplashScreen(t,()=>{console.log("✅ Splash complete, initializing game"),this.initializeGameState(),this.game.registry.set("levelProgression",!0),this.initializeGameAfterSplash()});return}console.log("⏩ No splash needed, initializing game immediately"),this.initializeGameState(),this.initializeGameAfterSplash()}getChapterSplashUrl(e){return this.registry.get("isDgen1")||window.location.port==="3001"?{1:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20caverns%20splash%20page%20dgen1-fOxjnn8s5iQTzCwVP6HTwo2oZnoWlN.png?V8Du",11:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/volcano%20crystal%20caverns%20splash%20page%20dgen1-MoVRItepiBcZZdhmpb1d5ullyQ725t.png?8mEz",21:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/steampunk%20crystal%20caverns%20splash%20page%20dgen1-B4jgMlUeWbOa7kvIZfra56G4UiUFoY.png?lJqO",31:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/electrified%20crystal%20caverns%20splash%20page%20dgen1-RJXfreqjj1XpJaMYUsYJBansc4BTAJ.png?B3oR",41:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/galactic%20crystal%20caverns%20splash%20page%20dgen1-zSJaaqpe1StXM8hf8IoYDYjx4vIsAz.png?Az4J",51:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%20crystal%20caverns%20splash%20page%20dgen1-6RPxHcIi1lHMpFEHGCwglRqzwKdNjW.png?Riu8"}[e]||"":{1:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Crystal%20Cavern%20Chapter%20marker-xVVl4RJLl7pqY1teeQdZ9YR8qRbIbf.png",11:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Volcanic%20Crystal%20Cavern%20Chapter%20marker-DrODhcdT2pkFF5SP0zLVzzpmHeZwBl.png",21:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Steampunk%20Crystal%20Cavern%20Chapter%20marker-Oerxv49ruukEeuSe6Dz9Epj2apX18R.png",31:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Electrified%20Crystal%20Cavern%20Chapter%20marker-GstidG6WUl0ZXoFwC2l5HOqWCrXgaA.png",41:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Galatic%20Crystal%20Cavern%20Chapter%20marker-HTsVFy9CSXYas98BckhvpCBkEV4AwP.png",51:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Beast%20Mode%20splash%20page-hnSUzR7voB81jfSXp0WpSwdDWEm4LD.png"}[e]||""}showPreloadChapterScreen(){}showChapterSplashScreen(e,t){console.log(`🖼️ Creating splash screen for level ${e} at`,performance.now()),this.instantLoadingScreen&&(this.instantLoadingScreen.destroy(),this.instantLoadingScreen=void 0),this.preloadChapterText&&(this.preloadChapterText.destroy(),this.preloadChapterText=void 0),this.preloadLoadingText&&(this.preloadLoadingText.destroy(),this.preloadLoadingText=void 0);const s=`chapter-${e}`;if(this.textures.exists(s))this.displayChapterSplash(e,t);else{console.log(`📥 Loading chapter splash on-demand: ${s}`);const i=this.getChapterSplashUrl(e);if(!i){console.warn(`⚠️ No splash URL found for level ${e}`),t();return}this.load.image(s,i),this.load.once("complete",()=>{console.log(`✅ Splash loaded: ${s}`),this.displayChapterSplash(e,t)}),this.load.start()}}displayChapterSplash(e,t){const s=`chapter-${e}`,i=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,s);console.log(`📷 Splash image created: ${s}`);const a=this.cameras.main.width/i.width,o=this.cameras.main.height/i.height,l=Math.max(a,o);i.setScale(l),i.setDepth(10001),i.setScrollFactor(0),i.alpha=1,console.log(`📐 Image scaled: ${l.toFixed(2)}x, showing immediately`),console.log("⏱️ Starting 2 second timer"),this.time.delayedCall(2e3,()=>{console.log("⏰ Timer complete, starting fade out");const r=this.add.graphics();r.fillStyle(0,0),r.fillRect(0,0,this.cameras.main.width,this.cameras.main.height),r.setDepth(10002),r.setScrollFactor(0),this.tweens.add({targets:i,alpha:0,duration:500,ease:"Power2"}),this.tweens.add({targets:r,alpha:1,duration:400,ease:"Power2.easeInOut",onComplete:()=>{console.log("🗑️ Destroying splash elements"),i.destroy(),this.tweens.add({targets:r,alpha:0,duration:300,delay:100,ease:"Power2.easeOut",onComplete:()=>{r.destroy(),t()}})}})})}initializeGameState(){this.levelManager||(this.levelManager=new fe);const e=this.game.registry.get("currentLevel")||1;this.levelManager.setCurrentLevel(e),localStorage.removeItem("treasureQuest_currentLevel"),this.isGameOver=!1,this.isLevelComplete=!1,this.currentFloor=0,this.highestFloorGenerated=5;const t=this.game.registry;t.has("lives")&&(console.warn("⚠️ Cleaning up old 'lives' registry key"),t.remove("lives")),t.has("levelProgression")&&t.get("levelProgression")===!0?(this.accumulatedScore=t.get("accumulatedScore")||0,this.score=0,this.lives=t.get("playerLives")||3,(this.lives<0||this.lives>this.MAX_LIVES)&&(console.error(`🔴 Invalid lives count detected: ${this.lives}, resetting to 3`),this.lives=3,t.set("playerLives",this.lives)),this.totalCoinsCollected=t.get("totalCoins"),this.totalGemsCollected=t.get("totalGems")||0,this.totalBlueGemsCollected=t.get("totalBlueGems")||0,this.totalDiamondsCollected=t.get("totalDiamonds")||0,this.livesEarned=t.get("livesEarned")||0,console.log(`🎮 Level progression - Lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`)):t.has("playerLives")&&t.get("playerLives")>0?(this.lives=t.get("playerLives"),(this.lives<0||this.lives>this.MAX_LIVES)&&(console.error(`🔴 Invalid lives count detected: ${this.lives}, resetting to 3`),this.lives=3,t.set("playerLives",this.lives)),this.accumulatedScore=t.get("accumulatedScore")||0,this.score=0,this.totalCoinsCollected=t.get("totalCoins"),this.totalGemsCollected=t.get("totalGems")||0,this.totalBlueGemsCollected=t.get("totalBlueGems")||0,this.totalDiamondsCollected=t.get("totalDiamonds")||0,this.livesEarned=t.get("livesEarned")||0,console.log(`🎮 Death restart - Lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`)):(this.lives=3,this.score=0,this.accumulatedScore=0,this.totalCoinsCollected=0,this.totalGemsCollected=0,this.totalBlueGemsCollected=0,this.totalDiamondsCollected=0,this.livesEarned=0,console.log(`🎮 New game started - Lives: ${this.lives}`),t.set("playerLives",this.lives),t.set("totalCoins",0),t.set("totalGems",0),t.set("totalBlueGems",0),t.set("totalDiamonds",0),t.set("livesEarned",0),t.set("accumulatedScore",0),t.set("currentScore",0),t.set("accumulatedDiamonds",0),[1,11,21,31,41,51].forEach(a=>{t.remove(`chapterSplashShown_${a}`)})),this.gemsCollectedThisLevel=0,this.blueGemsCollectedThisLevel=0,this.diamondsCollectedThisLevel=0,this.accumulatedDiamonds=t.get("accumulatedDiamonds")||0}async initializeGameAfterSplash(){this.backgroundManager=new ve(this);const e=this.levelManager?.getCurrentLevel()||1,t=this.levelManager?.isBonusLevel()||!1,s=this.backgroundManager.getChapterForLevel(e,t);s!=="crystal_cavern"&&await this.backgroundManager.loadChapterBackgrounds(s),this.currentBackground=this.backgroundManager.getBackgroundForLevel(e,t);const i=this.add.image(0,0,this.currentBackground);i.setOrigin(0,0),i.setDepth(-100),i.setScrollFactor(.05);const a=this.cameras.main.width,o=this.cameras.main.height,l=a/i.width,r=o/i.height,n=Math.max(l,r)*1.2;i.setScale(n);const c=(o-i.height*n)/2;i.setPosition((a-i.width*n)/2,c),this.backgroundSprite=i,this.backgroundInitialY=c,this.backgroundHeight=i.height*n,this.input.addPointer(2),this.setupFarcadeEventHandlers(),this.recentTiles=[],this.tileGrid.clear(),this.tileUsageCount=new Array(12).fill(0),this.platforms=this.physics.add.staticGroup(),this.ladders=this.physics.add.staticGroup(),this.spikes=this.physics.add.staticGroup(),this.cats=this.physics.add.group({classType:U,runChildUpdate:!0}),this.stalkerCats=this.physics.add.group({classType:U,runChildUpdate:!0}),this.baseBlus=this.physics.add.group({classType:ue,runChildUpdate:!0}),this.beetles=this.physics.add.group({classType:pe,runChildUpdate:!0}),this.rexEnemies=this.physics.add.group({classType:ge,runChildUpdate:!0}),this.coins=[],this.blueCoins=[],this.diamonds=[],this.treasureChests=[],this.crystalBalls=[],this.freeLifs=[],this.invincibilityPendants=[],this.levelHasCrystalBall=!1,this.createTestLevel();const d=3.5*p.game.tileSize,u=p.canvas.height-p.game.tileSize,g=u-29;console.log("👤 Player Spawn Calculation:",{canvasHeight:p.canvas.height,groundFloorY:u,spawnY:g,spawnX:d}),this.player=new Ee(this,100,p.canvas.height+100);const b=this.game.registry,y=b.has("playerLives"),f=b.get("levelProgression");!y||b.get("playerLives")===3||f?(this.player.body.enable=!1,this.startLevelIntro(d,g)):(this.player.setPosition(d,g),this.player.body.enable=!0,this.isLevelStarting=!1,this.changePlayerTexture("playerIdleEye1"),this.showStartBanner(),this.notifyFarcadeGameReady()),this.createCats(),this.createCeilingSpikes(),this.createAllCollectibles(),this.createLevelEndDoor(),this.physics.add.collider(this.player,this.platforms,void 0,this.shouldCollideWithPlatform,this),this.physics.add.collider(this.cats,this.platforms),this.physics.add.collider(this.beetles,this.platforms),this.physics.add.collider(this.rexEnemies,this.platforms),this.physics.add.collider(this.cats,this.spikes,void 0,(z,F)=>F.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.beetles,this.spikes,void 0,(z,F)=>F.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.rexEnemies,this.spikes,void 0,(z,F)=>F.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.stalkerCats,this.platforms),this.physics.add.collider(this.stalkerCats,this.spikes,void 0,(z,F)=>F.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.cats,this.cats,this.handleCatCatCollision,(z,F)=>{const W=z,K=F,ie=W.getCatColor()==="green"||W.getCatColor()==="yellow",we=K.getCatColor()==="green"||K.getCatColor()==="yellow";return!(ie||we)},this),this.physics.add.overlap(this.player,this.cats,this.handlePlayerCatInteraction,void 0,this),this.physics.add.overlap(this.player,this.stalkerCats,this.handlePlayerStalkerCatInteraction,void 0,this),this.physics.add.overlap(this.player,this.beetles,this.handlePlayerBeetleInteraction,void 0,this),this.physics.add.overlap(this.player,this.rexEnemies,this.handlePlayerRexInteraction,void 0,this),this.physics.add.collider(this.baseBlus,this.platforms),this.physics.add.collider(this.baseBlus,this.spikes,void 0,(z,F)=>F.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.player,this.baseBlus,this.handlePlayerBaseBluInteraction,void 0,this),this.playerSpikeOverlap=this.physics.add.overlap(this.player,this.spikes,this.handlePlayerSpikeCollision,void 0,this),this.physics.add.collider(this.player,this.spikes,void 0,(z,F)=>{const W=F,ie=z.body;return W.getData("isFloorSpike")?ie.velocity.y<0:!1},this),this.physics.add.overlap(this.player,this.ladders,this.handleLadderOverlap,void 0,this);const v=p.game.floorWidth*p.game.tileSize;this.physics.world.setBounds(0,-1e4,v,2e4),this.cameras.main.startFollow(this.player,!0,.1,.1),this.game.registry.get("isDgen1")||!1?this.cameras.main.followOffset.set(0,50):this.cameras.main.followOffset.set(0,100),this.createVisibilitySystem();const x=this.cameras.main.width,T=this.add.image(x/2,62,"hud-bg-200");T.setDisplaySize((x-16)*1.6,96*1.6),T.setOrigin(.5,.5),T.setDepth(98),T.setScrollFactor(0);const M=this.add.graphics();M.fillStyle(16777215),M.fillRoundedRect(8,10,x-16,96,12),M.setScrollFactor(0);const w=M.createGeometryMask();T.setMask(w);const P=this.add.graphics();P.lineStyle(2,8069026,1),P.strokeRoundedRect(8,10,x-16,96,12),P.setDepth(99),P.setScrollFactor(0),this.livesIcon=this.add.image(30,35,"heart-crystal"),this.livesIcon.setDisplaySize(16,16),this.livesIcon.setDepth(100),this.livesIcon.setScrollFactor(0),this.livesText=this.add.text(45,35,"x3",{fontSize:"14px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.livesText.setScrollFactor(0),this.comboText=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"",{fontSize:"13px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(200).setVisible(!1),this.comboText.setScrollFactor(0);const E=this.add.image(30,58,"crystal-hud-icon");E.setDisplaySize(16,16),E.setDepth(100),E.setScrollFactor(0),this.coinCounterText=this.add.text(45,58,"0/150",{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.coinCounterText.setScrollFactor(0);const B=this.add.image(30,81,"door-hud-icon");B.setDisplaySize(16,16),B.setDepth(100),B.setScrollFactor(0);const L=this.levelManager.getCurrentLevel(),X=this.levelManager.isBonusLevel()?"BONUS":L>=51?`${L}`:`${L}`;this.levelText=this.add.text(45,81,X,{fontSize:"14px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.levelText.setScrollFactor(0),this.scoreText=this.add.text(x/2,25,"0",{fontSize:"19px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5,0).setDepth(100),this.scoreText.setScrollFactor(0),this.comboText.setScrollFactor(0);const I=75,A=45,H=A*3,G=x/2-H/2;this.invincibilityTimerImage=this.add.image(G,I,"invincibility-timer"),this.invincibilityTimerImage.setDisplaySize(36,36),this.invincibilityTimerImage.setDepth(101),this.invincibilityTimerImage.setScrollFactor(0),this.invincibilityTimerImage.setVisible(!0),this.invincibilityTimerMask=this.add.graphics(),this.invincibilityTimerMask.setDepth(102),this.invincibilityTimerMask.setScrollFactor(0);const V=this.textures.exists("crystalBallTimer")?"crystalBallTimer":"invincibility-timer";this.crystalBallTimerImage=this.add.image(G+A,I,V),this.crystalBallTimerImage.setDisplaySize(36,36),this.crystalBallTimerImage.setDepth(101),this.crystalBallTimerImage.setScrollFactor(0),this.crystalBallTimerImage.setVisible(!0),this.crystalBallTimerMask=this.add.graphics(),this.crystalBallTimerMask.setDepth(102),this.crystalBallTimerMask.setScrollFactor(0);const he=this.textures.exists("cursedOrbTimer")?"cursedOrbTimer":"invincibility-timer";this.cursedOrbTimerImage=this.add.image(G+A*2,I,he),this.cursedOrbTimerImage.setDisplaySize(36,36),this.cursedOrbTimerImage.setDepth(101),this.cursedOrbTimerImage.setScrollFactor(0),this.cursedOrbTimerImage.setVisible(!0),this.cursedOrbTimerMask=this.add.graphics(),this.cursedOrbTimerMask.setDepth(102),this.cursedOrbTimerMask.setScrollFactor(0);const se=this.textures.exists("cursedTealOrbTimer")?"cursedTealOrbTimer":"invincibility-timer";this.cursedTealOrbTimerImage=this.add.image(G+A*3,I,se),this.cursedTealOrbTimerImage.setDisplaySize(36,36),this.cursedTealOrbTimerImage.setDepth(101),this.cursedTealOrbTimerImage.setScrollFactor(0),this.cursedTealOrbTimerImage.setVisible(!0),this.cursedTealOrbTimerMask=this.add.graphics(),this.cursedTealOrbTimerMask.setDepth(102),this.cursedTealOrbTimerMask.setScrollFactor(0),this.hamburgerMenuButton=this.add.text(x-30,48,"☰",{fontSize:"42px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(1,.5).setDepth(100),this.hamburgerMenuButton.setScrollFactor(0),this.updateLivesDisplay(),this.updateCoinCounterDisplay(),this.updateScoreDisplay(),this.touchControls=new Ie(this),this.player.setTouchControls(this.touchControls),this.input.keyboard.enabled=!0,this.touchControls.enable(),!this.registry.get("platform")&&!this.game.registry.get("platform")&&(window.platform?(this.game.registry.set("platform",window.platform),console.log("🎮 Platform copied from window to registry")):console.warn("⚠️ Platform not found anywhere when creating menu")),this.menuOverlay=new je(this),this.reopenMenuAfterInit&&this.time.delayedCall(100,()=>{this.menuOverlay.open(),this.reopenMenuAfterInit=!1});const N=25,Z=this.hamburgerMenuButton.getBounds();this.hamburgerMenuButton.setInteractive(new Phaser.Geom.Rectangle(-N,-N,Z.width+N*2,Z.height+N*2),Phaser.Geom.Rectangle.Contains),this.hamburgerMenuButton.input.hitArea.setPosition(-N/2,-N/2),this.hamburgerMenuButton.off("pointerdown"),this.hamburgerMenuButton.on("pointerdown",()=>{this.playSoundEffect("menu-toggle",.4),this.menuOverlay.toggle()}),this.hamburgerMenuButton.on("pointerover",()=>{this.hamburgerMenuButton.setScale(1.1),this.hamburgerMenuButton.setColor("#b8e60a")}),this.hamburgerMenuButton.on("pointerout",()=>{this.hamburgerMenuButton.setScale(1),this.hamburgerMenuButton.setColor("#9acf07")});const de=this.input.keyboard?.addKey("ESC");if(de&&de.on("down",()=>{this.menuOverlay.toggle()}),this.initializeBubbleSystem(),this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).isEndless&&this.showEndlessModePopup(),this.game.registry.get("backgroundMusicPlaying"))this.backgroundMusic=this.game.registry.get("backgroundMusicInstance");else{const z=this.registry.get("musicEnabled")!==!1;this.sound.context&&this.sound.context.state==="suspended"?(console.log("🔊 GameScene: Audio context suspended, attempting to resume..."),this.sound.context.resume().then(()=>{console.log("✅ GameScene: Audio context resumed, starting music"),this.startBackgroundMusic(z)}).catch(F=>{console.error("❌ GameScene: Failed to resume audio context:",F),this.startBackgroundMusic(z)})):(console.log("🔊 GameScene: Audio context state:",this.sound.context?.state||"unknown"),this.startBackgroundMusic(z))}this.levelManager?.getCurrentLevel()>=51&&this.showBeastModeLoadingIndicator()}startBackgroundMusic(e){try{if(!this.cache.audio.exists("background-music")){console.error("❌ Background music not loaded in cache!");return}this.backgroundMusic=this.sound.add("background-music",{loop:!0,volume:e?.3:0});const t=this.backgroundMusic.play();t&&typeof t.catch=="function"&&t.catch(s=>{console.error("❌ Background music play() failed:",s)}),console.log("🎵 GameScene: Background music started - actually playing:",this.backgroundMusic.isPlaying),setTimeout(()=>{console.log("🎵 Music status after 100ms - playing:",this.backgroundMusic.isPlaying,"paused:",this.backgroundMusic.isPaused)},100),this.game.registry.set("backgroundMusicPlaying",!0),this.game.registry.set("backgroundMusicInstance",this.backgroundMusic)}catch(t){console.error("❌ GameScene: Failed to play background music:",t)}}generateTileTextures(){const e=p.game.tileSize;for(let t=0;t<15;t++){const s=`platform-tile-${t}`;if(this.textures.exists(s))continue;const i=this.add.graphics();i.fillStyle(6965898,1),i.fillRect(0,0,e,e);const o=Math.random();if(o<.4?(i.fillStyle(9071274,.6),i.fillRect(Math.random()*12,Math.random()*12,8+Math.random()*8,8+Math.random()*8)):o<.6&&(i.fillStyle(11168410,.5),i.fillRect(Math.random()*12,Math.random()*12,6+Math.random()*10,6+Math.random()*10)),t<7){const l=[16738740,9662683,4251856,16766720,64154],r=l[t%l.length];i.lineStyle(2,r,.6);for(let n=0;n<3;n++){const c=6+n*8;i.lineBetween(2,c,e-2,c+Math.random()*4-2)}}if(t>=3&&t<=10){const l=[16716947,9662683,4251856,16766720,64154],r=l[t%l.length];i.fillStyle(r,.8);const n=3+t%4;for(let c=0;c<n;c++){const h=4+Math.random()*(e-8),d=4+Math.random()*(e-8),u=1.5+Math.random()*.5;i.fillCircle(h,d,u),i.fillStyle(16777215,.9),i.fillCircle(h-.5,d-.5,.5),i.fillStyle(r,.8)}}if(t>=5&&t<=12){const l=[4251856,16738740,9662683,16766720],r=l[t%l.length],n=1+t%2;for(let c=0;c<n;c++){const h=6+Math.random()*(e-12),d=6+Math.random()*(e-12);i.fillStyle(r,.7);for(let u=0;u<4;u++){const g=(Math.random()-.5)*6,b=(Math.random()-.5)*6,y=.8+Math.random()*.7;i.fillCircle(h+g,d+b,y)}i.fillStyle(r,.9),i.fillCircle(h,d,1.2),i.fillStyle(16777215,.8),i.fillCircle(h-.3,d-.3,.4)}}if(t>=8){const l=[12216520,10233776,6765239,4251856,16738740],r=l[t%l.length],n=(Math.random()-.5)*(e-12);i.fillStyle(r,.7),i.fillRect(e/2-4+n,0,8,e),i.fillStyle(r,.9),i.fillRect(e/2-3+n,2,2,e-4),i.fillRect(e/2+1+n,2,2,e-4),i.fillStyle(16777215,.8),i.fillRect(e/2-2+n,4,1,e-8),i.fillRect(e/2+2+n,4,1,e-8)}if(t%2===0){const l=t%3,r=[9662683,4251856,16738740];i.fillStyle(r[l],.8);const n=5+Math.random()*(e-10),c=5+Math.random()*(e-10);for(let h=0;h<4;h++){const d=n+Math.random()*10-5,u=c+Math.random()*10-5,g=2+Math.random()*3;i.fillCircle(d,u,g),i.fillStyle(16777215,.9),i.fillCircle(d-g/2,u-g/2,g/3),i.fillStyle(r[l],.8)}}if(t%2===1&&t>7){const l=[4251856,16766720,16738740,9662683,64154],r=l[t%l.length],n=1+t%2;for(let c=0;c<n;c++){const h=8+Math.random()*(e-16),d=8+Math.random()*(e-16),u=2+Math.random()*2;i.fillStyle(r,.8),i.fillRect(h-u/2,d-u/4,u,u/2),i.fillRect(h-u/3,d-u/2,u*.66,u),i.fillStyle(r,.95),i.fillCircle(h,d,u*.3),i.fillStyle(16777215,.9),i.fillCircle(h-u*.2,d-u*.2,u*.2)}}if(t%3===0){i.lineStyle(1,2762018,.5);const l=Math.random()*e;i.lineBetween(l,0,l+(Math.random()-.5)*12,e)}i.generateTexture(s,e,e),i.destroy()}}createMiningThemeBackground(){const t=p.game.floorWidth*p.game.tileSize+1e3,s=p.canvas.height*10,i=-500,a=-5e3,o=this.add.graphics();for(let l=a;l<s;l+=20){const r=Math.max(0,Math.min(1,(l-a)/(s-a))),n=Math.floor(26*(1-r)+42*r),c=Math.floor(10*(1-r)+26*r),h=Math.floor(42*(1-r)+74*r),d=n<<16|c<<8|h;o.fillStyle(d,1),o.fillRect(i,l,t,20)}for(let l=-15;l<30;l++){const r=l*400+100;o.fillStyle(6332671,.15),o.fillRect(i,r,t,8);const n=Math.floor(t/120);for(let c=0;c<=n;c++){const h=i+t/n*c+(Math.random()-.5)*40,d=[16739251,7058431,11796331,16757611,11758591],u=d[Math.floor(Math.random()*d.length)];o.fillStyle(u,.2),o.fillTriangle(h,r,h-6,r+30,h+6,r+30),o.fillStyle(16777215,.15),o.fillTriangle(h,r,h-2,r+10,h+2,r+10)}}for(let l=0;l<Math.floor(t/150);l++){const r=i+Math.random()*t,n=a+Math.random()*(s-a),c=[16728193,4244735,6942894,16755520,12216520],h=c[Math.floor(Math.random()*c.length)];o.fillStyle(h,.2);const d=100+Math.random()*150,u=Math.random()*Math.PI/3-Math.PI/6;for(let g=0;g<d;g+=8){const b=r+Math.cos(u)*g,y=n+Math.sin(u)*g;o.fillCircle(b,y,3+Math.random()*4),Math.random()>.7&&(o.fillStyle(16777215,.3),o.fillCircle(b+Math.random()*4-2,y+Math.random()*4-2,1),o.fillStyle(h,.2))}}for(let l=0;l<Math.floor(t/100);l++){const r=i+Math.random()*t,n=a+Math.random()*(s-a),c=Math.random();if(c<.3){const h=[16717636,15277667,10233776,6765239,4149685,2201331,48340,38536,5025616,9159498,13491257,16771899,16761095,16750592,16733986],d=h[Math.floor(Math.random()*h.length)];o.fillStyle(d,.25),o.fillCircle(r,n,8+Math.random()*6),o.fillStyle(16777215,.3),o.fillCircle(r-2,n-2,2)}else c<.6?(o.fillStyle(12216520,.2),o.fillCircle(r,n,6+Math.random()*4),o.fillStyle(16777215,.25),o.fillCircle(r-1,n-1,1.5)):(o.fillStyle(5025616,.2),o.fillCircle(r,n,4+Math.random()*3),o.fillStyle(16777215,.3),o.fillCircle(r-1,n-1,1))}for(let l=0;l<Math.floor(t/200);l++){const r=i+Math.random()*t,n=a+Math.random()*(s-a),c=[4251856,16738740,10025880,16753920],h=c[Math.floor(Math.random()*c.length)];o.fillStyle(h,.1),o.fillRect(r-20,n-5,40+Math.random()*30,10+Math.random()*8),o.fillStyle(h,.3),o.fillRect(r-10,n-2,20,4)}for(let l=0;l<Math.floor(t/60);l++){const r=i+Math.random()*t,n=a+Math.random()*(s-a),c=[4251856,16716947,9662683,65407,16766720],h=c[Math.floor(Math.random()*c.length)];o.fillStyle(h,.08),o.fillCircle(r,n,15),o.fillStyle(h,.15),o.fillCircle(r,n,8),o.fillStyle(h,.3),o.fillCircle(r,n,4),o.fillStyle(16777215,.4),o.fillCircle(r,n,2)}o.lineStyle(3,4251856,.3);for(let l=a+100;l<s;l+=400){const r=l+Math.random()*100,n=Math.floor(t/100);for(let c=0;c<n;c++){const h=i+t/n*c,d=i+t/n*(c+1),u=Math.sin(c*.5)*20;o.lineStyle(2,4251856,.15),o.lineBetween(h,r+u,d,r+Math.sin((c+1)*.5)*20),Math.random()>.7&&(o.fillStyle(16777215,.2),o.fillCircle(h+Math.random()*(d-h),r+u,1))}}for(let l=0;l<Math.floor(t/80);l++){const r=i+Math.random()*t,n=a+Math.random()*(s-a),c=40+Math.random()*60,h=[10233776,6765239,4149685,48340,5025616],d=h[Math.floor(Math.random()*h.length)];o.fillStyle(5917290,.15),o.fillCircle(r,n,c),o.fillStyle(d,.2),o.fillCircle(r,n,c*.7),o.fillStyle(d,.35),o.fillCircle(r,n,c*.3),o.fillStyle(16777215,.3),o.fillCircle(r-c*.2,n-c*.2,c*.15)}o.setDepth(-10),o.setScrollFactor(.5)}createTestLevel(){const e=p.game.tileSize,t=p.game.floorWidth,s=p.game.floorSpacing,i=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),a=i.isEndless?20:i.floorCount,o=i.isEndless?Math.max(a,Math.floor(p.canvas.height/s)):a,l=[],r=[];for(let c=0;c<o;c++){const h=p.canvas.height-e/2-c*s;if(c===0){for(let d=0;d<t;d++){const u=d*e+e/2;this.createPlatformTile(u,h,d===0,d===t-1)}l[c]=-1,r[c]={gapStart:-1,gapSize:0}}else if(!this.levelManager.isBonusLevel()&&Math.random()>.3){const u=Math.floor(Math.random()*(t-5))+2,g=Math.floor(Math.random()*2)+2;r[c]={gapStart:u,gapSize:g};for(let T=0;T<t;T++)(T<u||T>=u+g)&&this.createPlatformTile(T*e+e/2,h,T===0,T===t-1);this.levelManager.isBonusLevel()||this.createSpikesInGap(u,g,h,e);const b=u>3?Math.floor(Math.random()*(u-1))+1:-1,y=u+g<t-2?Math.floor(Math.random()*(t-u-g-2))+u+g+1:-1,f=t/3,m=c>1?l[c-1]:-1;let S=Math.floor(Math.random()*3);if(m!==-1){const T=Math.floor(m/f),M=[0,1,2].filter(w=>w!==T);S=M[Math.floor(Math.random()*M.length)]}const v=Math.floor(S*f),k=Math.floor((S+1)*f),x=[];b!==-1&&b>=v&&b<k&&x.push(b),y!==-1&&y>=v&&y<k&&x.push(y),l[c]=x.length>0?x[Math.floor(Math.random()*x.length)]:y!==-1?y:b}else{r[c]={gapStart:-1,gapSize:0};for(let m=0;m<t;m++)this.createPlatformTile(m*e+e/2,h);const u=t/3,g=c>1?l[c-1]:-1;let b=Math.floor(Math.random()*3);if(g!==-1){const m=Math.floor(g/u),S=[0,1,2].filter(v=>v!==m);b=S[Math.floor(Math.random()*S.length)]}const y=Math.max(2,Math.floor(b*u)),f=Math.min(t-2,Math.floor((b+1)*u));l[c]=Math.floor(Math.random()*(f-y))+y}}this.floorLayouts=r;const n=i.isEndless?-1:i.floorCount-1;for(let c=0;c<o-1;c++){if(!i.isEndless&&c+1>n)continue;const h=p.canvas.height-e-c*s,d=p.canvas.height-e-(c+1)*s,u=r[c],g=r[c+1],b=[];for(let y=1;y<t-1;y++){const f=this.hasPlatformAt(u,y),m=this.hasPlatformAt(g,y),S=this.hasDoorAt(y,c),v=this.hasDoorAt(y,c+1);f&&m&&!S&&!v&&b.push(y)}if(b.length>0){const y=[];if(c===0)if(b.length>=2){const f=b[Math.floor(Math.random()*b.length)];this.createContinuousLadder(f*e,h,d),y.push(f);const m=6,S=b.filter(v=>Math.abs(v-f)>=m);if(S.length>0){const v=S[Math.floor(Math.random()*S.length)];this.createContinuousLadder(v*e,h,d),y.push(v)}else{let v=0,k=-1;for(const x of b){const T=Math.abs(x-f);T>v&&x!==f&&(v=T,k=x)}k!==-1&&v>=3&&(this.createContinuousLadder(k*e,h,d),y.push(k))}}else{const f=b[0];this.createContinuousLadder(f*e,h,d),y.push(f)}else{const f=this.ladderPositions.get(c-1)||[],m=b.filter(k=>!f.some(x=>Math.abs(k-x)<3)),S=m.length>0?m:b,v=S[Math.floor(Math.random()*S.length)];this.createContinuousLadder(v*e,h,d),y.push(v)}this.storeLadderPositions(c,y)}}}storeLadderPositions(e,t){this.ladderPositions.set(e,t)}hasPlatformAt(e,t){return e.gapStart===-1?!0:t<e.gapStart||t>=e.gapStart+e.gapSize}selectSmartTileVariant(e,t){const s=p.game.tileSize,i=Math.floor(e/s),a=Math.floor(t/s),o=`${i},${a}`;if(this.tileGrid.has(o))return this.tileGrid.get(o);const l=[],r=[],n=[`${i-1},${a}`,`${i+1},${a}`,`${i},${a-1}`,`${i},${a+1}`,`${i-1},${a-1}`,`${i+1},${a-1}`,`${i-1},${a+1}`,`${i+1},${a+1}`];n.forEach(y=>{if(this.tileGrid.has(y)){const f=this.tileGrid.get(y);l.push(f.variant),r.push(f.flipX)}});const c=[[0,4,8],[1,5,9],[2,3,6,7,10,11]],h=y=>{for(const f of c)if(f.includes(y))return f;return null},d=[];for(let y=0;y<12;y++)for(const f of[!1,!0]){let m=100;n.slice(0,4).forEach(T=>{if(this.tileGrid.has(T)){const M=this.tileGrid.get(T);M.variant===y&&M.flipX===f?m-=80:M.variant===y&&(m-=40);const w=h(y),P=h(M.variant);w&&P&&w===P&&(m-=60)}}),n.slice(4).forEach(T=>{if(this.tileGrid.has(T)){const M=this.tileGrid.get(T);M.variant===y&&M.flipX===f?m-=30:M.variant===y&&(m-=15);const w=h(y),P=h(M.variant);w&&P&&w===P&&(m-=25)}});const k=Math.max(...this.tileUsageCount)||1,x=Math.max(0,k-this.tileUsageCount[y])*5;m+=x,this.recentTiles.includes(y)||(m+=20),m+=Math.random()*10,d.push({variant:y,flipX:f,score:m})}d.sort((y,f)=>f.score-y.score);const u=d.slice(0,Math.max(6,Math.floor(d.length*.25))),g=u[Math.floor(Math.random()*u.length)],b={variant:g.variant,flipX:g.flipX};return this.tileGrid.set(o,b),this.recentTiles.push(g.variant),this.tileUsageCount[g.variant]++,this.recentTiles.length>8&&this.recentTiles.shift(),b}createPlatformTile(e,t,s=!1,i=!1){const a=p.game.tileSize,o=this.selectSmartTileVariant(e,t),l=`floor-tile-${o.variant+1}`,r=this.add.sprite(e,t,l);r.setDisplaySize(32,32),r.setDepth(1),r.setFlipX(o.flipX);const n=this.add.sprite(e+3,t+3,l);n.setDisplaySize(32,32),n.setDepth(0),n.setTint(0),n.setAlpha(.3),n.setFlipX(o.flipX);const c=this.add.rectangle(e,t,a,a,0,0);c.setDepth(0),this.physics.add.existing(c,!0),this.platforms.add(c)}createContinuousLadder(e,t,s){const i=p.game.tileSize,a=t>=p.canvas.height-i*2,o=a?0:i*.25,l=i*.1,r=t-s+o+l,n=(t+o+s-l)/2;(this.game.registry.get("isDgen1")||!1)&&console.log("🪜 Ladder created:",{x:Math.round(e),bottomY:Math.round(t),topY:Math.round(s),ladderY:Math.round(n),ladderHeight:Math.round(r),isGroundFloor:a,canvasHeight:p.canvas.height});const h=this.add.rectangle(e+i/2,n,i*.8,r,16777215,0);if(h.setDepth(10),this.ladders.add(h),this.textures.exists("tealLadder")){const d=e+i/2,u=t-s+i*.5,g=(t+s)/2+1,b=this.add.image(d+1,g,"tealLadder");b.setDisplaySize(b.width*(u/b.height),u),b.setDepth(11)}else{const d=this.add.graphics(),u=e+i/2,g=t-s+i*.5,b=(t+s)/2+1,y=b-g/2,f=b+g/2;d.fillStyle(4251856,1),d.fillRect(u-2,y,4,g),d.fillRect(u-13,y+4,26,4),d.fillRect(u-13,f-8,26,4);const m=Math.floor(g/32);for(let S=1;S<m;S++){const v=y+S*(g/(m+1));d.fillRect(u-13,v,26,3)}d.setDepth(11)}}createSpikesInGap(e,t,s,i){for(let a=e;a<e+t;a++){const o=a*i+i/2,l=s;this.createSpikeSprite(o,l,i)}}createSpikeSprite(e,t,s){const i=t+s/2-1+1,a=this.add.image(e+3,i+3,"pink-floor-spike-tile");a.setDisplaySize(s,s),a.setOrigin(.5,1),a.setDepth(11),a.setTint(0),a.setAlpha(.3);const o=this.add.image(e,i,"pink-floor-spike-tile");o.setDisplaySize(s,s),o.setOrigin(.5,1),o.setDepth(12);const l=s,r=t,n=this.add.rectangle(e,r,s*.9,l,0,0);n.setVisible(!1),n.setData("isFloorSpike",!0),n.setData("visualSpikeHeight",s),n.setData("visualSpikeBaseY",i),this.spikes.add(n)}createCeilingSpikes(){const e=p.game.tileSize,t=p.game.floorSpacing;if(this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),this.levelManager.isBonusLevel())return;const s=1;for(let i=s;i<this.floorLayouts.length-1;i++){const a=this.floorLayouts[i];if(Math.random()>.8)continue;const o=p.canvas.height-e/2-(i+1)*t+e,l=[],r=this.getLadderPositionsForFloor(i);for(let c=2;c<p.game.floorWidth-2;c++){if(a.gapStart!==-1&&c>=a.gapStart-2&&c<a.gapStart+a.gapSize+2)continue;let h=!1;for(const d of r)if(Math.abs(c-d)<2){h=!0;break}if(!h){if(i===this.floorLayouts.length-2){const d=Math.floor(p.game.floorWidth/2);if(Math.abs(c-d)<2)continue}l.push(c)}}const n=Math.floor(Math.random()*3)+1;for(let c=0;c<Math.min(n,l.length/3)&&l.length!==0;c++){const h=Math.floor(Math.random()*l.length),d=l[h],u=Math.floor(Math.random()*3)+1;for(let g=0;g<u;g++){const b=d+g;if(b>=p.game.floorWidth-2)break;let y=!1;for(const m of r)if(Math.abs(b-m)<2){y=!0;break}if(y)continue;const f=l.indexOf(b);f>-1&&l.splice(f,1),this.createCeilingSpikeGraphics(b*e+e/2,o,e)}}}}createCeilingSpikeGraphics(e,t,s){const i=s*.5+6,a=t-s/2+1,o=this.add.image(e,a,"yellow-ceiling-spike-tile");o.setDisplaySize(s,s),o.setOrigin(.5,0),o.setDepth(12);const l=this.add.rectangle(e,a+i/2,24,i,0,0);l.setVisible(!1),l.setData("isCeilingSpike",!0),l.setData("sprite",o),l.setData("x",e),l.setData("y",a),this.physics.add.existing(l,!0),this.spikes.add(l)}getLadderPositionsForFloor(e){const t=[],s=p.game.tileSize,i=p.game.floorSpacing;return this.ladders.children.entries.forEach(a=>{const o=a,l=o.y+o.height/2,r=Math.floor((p.canvas.height-l)/i);if(r===e||r===e-1||r===e+1){const n=Math.floor(o.x/s);t.push(n)}}),t}createCats(){if(this.levelManager.isBonusLevel())return;const e=p.game.tileSize,t=p.game.floorSpacing,s=p.game.floorWidth,i=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),a=i.isEndless?999:i.floorCount-1,o=i.isEndless?Math.min(20,this.floorLayouts.length-1):a-1;for(let l=2;l<=o&&l<this.floorLayouts.length;l++){this.floorLayouts[l];const c=p.canvas.height-e/2-l*t-e/2-15,h=D.selectEnemiesForFloor(this.levelManager.getCurrentLevel(),l);if(h.length===0)continue;const d=this.levelManager.getCurrentLevel(),u=this.calculateEnemyZones(s,d),g=this.ladderPositions.get(l)||[],b=[],y=[...u].sort(()=>Math.random()-.5);let f=0;for(let m=0;m<h.length&&m<y.length;m++){const S=h[m],v=y[m];let k,x,T;if(D.isBaseBluType(S)){if(h.filter(P=>D.isBaseBluType(P)).length===1){const P=Math.random()<.5;k=e*(P?1:s-1)}else k=e*(f===0?1:s-1),f++;x=e*.5,T=e*(s-.5)}else if(D.isStalkerType(S)){let w=v;const P=g.some(B=>B>=v.start&&B<v.end),E=b.some(B=>B>=v.start&&B<v.end);if(P||E){const B=y.filter((L,j)=>{if(j<=m)return!1;const X=g.some(A=>A>=L.start&&A<L.end),I=b.some(A=>A>=L.start&&A<L.end);return!X&&!I});B.length>0&&(w=B[0])}k=e*(w.center+(Math.random()-.5)),x=e*.5,T=e*(s-.5)}else k=e*(v.center+(Math.random()-.5)*2),x=e*.5,T=e*(s-.5);const M=D.getSpeedMultiplier(this.levelManager.getCurrentLevel());if(D.isBaseBluType(S)){const w=new ue(this,k,c);w.setPlatformBounds(x,T);const P=e*(s/2);k<P?w.setInitialDirection(1):w.setInitialDirection(-1),typeof w.setSpeedMultiplier=="function"&&w.setSpeedMultiplier(M),this.baseBlus.add(w)}else if(D.isBeetleType(S)){const w=new pe(this,k,c,x,T);typeof w.setSpeedMultiplier=="function"&&w.setSpeedMultiplier(M),this.beetles.add(w)}else if(D.isRexType(S)){const w=new ge(this,k,c,x,T);typeof w.setSpeedMultiplier=="function"&&w.setSpeedMultiplier(M),this.rexEnemies.add(w)}else if(D.isStalkerType(S)){const w=new U(this,k,c,e*.5,e*(s-.5),"red",!0);w.setPlayerReference(this.player),this.setSmartEnemyDirection(w,k,s*e,m,h.length),typeof w.setSpeedMultiplier=="function"&&w.setSpeedMultiplier(M),this.stalkerCats.add(w)}else{let w=D.getColorForEnemyType(S);S===O.CHOMPER&&Math.random()<.5&&(w="purple");const P=new U(this,k,c,x,T,w);this.setSmartEnemyDirection(P,k,s*e,m,h.length),typeof P.setSpeedMultiplier=="function"&&P.setSpeedMultiplier(M),this.cats.add(P)}}}}getZoneSizeForLevel(e){return e<=10?6:e<=30?5:(e<=50,4)}calculateEnemyZones(e,t){const s=this.getZoneSizeForLevel(t),i=Math.floor(e/s),a=[];for(let o=0;o<i;o++)a.push({start:o*s,end:(o+1)*s,center:o*s+s/2});return a}calculateEnemyPositions(e,t,s,i){const a=[],l=s-3,r=Math.floor(this.currentFloorY/(i*5)),n=this.ladderPositions.get(r)||[];switch(t){case"spread":const h=Math.max(2.5,l/e);for(let m=0;m<e;m++){const S=1.5+h*(m+.5),v=Math.min(.5,(h-2.5)/2),k=(Math.random()-.5)*v,x=Math.max(1.5,Math.min(s-1.5,S+k)),T=6,M=Math.max(T,h*1.2),w=1.5+h*(m+.5);let P=Math.max(.5,w-M/2),E=Math.min(s-.5,w+M/2);for(const B of n)B>=P&&B<=E&&(B-P<E-B?P=Math.min(E-T,B+2):E=Math.max(P+T,B-2));a.push({x,leftBound:P,rightBound:E})}break;case"cluster":const d=s/2,u=Math.min(2,l/4);for(let m=0;m<e;m++){const S=Math.PI*2*m/e,v=Math.random()*u,k=Math.max(1.5,Math.min(s-1.5,d+Math.cos(S)*v)),x=6;let T=Math.max(.5,d-Math.max(u+2,x/2)),M=Math.min(s-.5,d+Math.max(u+2,x/2));for(const w of n)w>=T&&w<=M&&(w-T<M-w?T=Math.min(M-x,w+2):M=Math.max(T+x,w-2));a.push({x:k,leftBound:T,rightBound:M})}break;case"edges":const g=Math.ceil(e/2),b=Math.floor(e/2);for(let m=0;m<g;m++){const v=1.5+m*.8+Math.random()*1.5;let k=.5,x=Math.min(s/2+1,s-.5);const T=6;x-k<T&&(x=Math.min(k+T,s-.5));for(const M of n)M>=k&&M<=x&&(x=Math.max(k+T,M-2));a.push({x:v,leftBound:k,rightBound:x})}for(let m=0;m<b;m++){const S=m*.8,v=s-1.5-S-Math.random()*1.5;let k=Math.max(s/2-1,.5),x=s-.5;const T=6;x-k<T&&(k=Math.max(x-T,.5));for(const M of n)M>=k&&M<=x&&(k=Math.min(x-T,M+2));a.push({x:v,leftBound:k,rightBound:x})}break;case"random":default:const y=[],f=2.5;for(let m=0;m<e;m++){let S,v=0;const k=20;do if(S=1.5+Math.random()*l,v++,v>=k){S=1.5+l/(e+1)*(m+1);break}while(y.some(B=>Math.abs(B-S)<f));y.push(S);const x=6,T=3.5,M=Math.random()*2,w=Math.max(x/2,T+M);let P=Math.max(.5,S-w),E=Math.min(s-.5,S+w);if(E-P<x){const B=(P+E)/2;P=Math.max(.5,B-x/2),E=Math.min(s-.5,B+x/2)}for(let B=0;B<m;B++){const L=a[B],j=y[B];S<j&&E>L.leftBound?E=Math.min(E,L.leftBound-.5):S>j&&P<L.rightBound&&(P=Math.max(P,L.rightBound+.5))}for(const B of n)B>=P&&B<=E&&(B-P<E-B?P=Math.min(E-6,B+2):E=Math.max(P+6,B-2));a.push({x:S,leftBound:P,rightBound:E})}break}return a}setSmartEnemyDirection(e,t,s,i,a){const o=s/2,l=t<s*.25||t>s*.75;let r;a===1?r=.5:a===2?r=t<o?.7:.3:l?r=t<o?.75:.25:r=i%2===0?.3:.7,r+=(Math.random()-.5)*.3,r=Math.max(.1,Math.min(.9,r)),Math.random()<r&&typeof e.reverseDirection=="function"&&e.reverseDirection()}createTemporaryFloorGrid(){const e=p.game.tileSize,t=p.game.floorSpacing,s=p.canvas.width,i=this.add.graphics();i.lineStyle(2,65280,.7),i.setDepth(100);for(let a=0;a<this.floorLayouts.length;a++){const l=p.canvas.height-e/2-a*t-e/2;i.moveTo(0,l),i.lineTo(s,l),this.add.text(10,l-20,`Floor ${a} (Top:${Math.round(l)})`,{fontSize:"12px",color:"#00ff00",backgroundColor:"#000000aa",padding:{x:4,y:2}}).setDepth(101)}i.strokePath()}createStalkerCats(){const e=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());if(!e.enemyTypes.includes("red"))return;const t=p.game.tileSize,s=p.game.floorSpacing,i=p.game.floorWidth,a=e.isEndless?999:e.floorCount-1,o=e.isEndless?Math.min(25,this.floorLayouts.length-1):a-1;for(let l=2;l<=o&&l<this.floorLayouts.length;l++){const r=this.floorLayouts[l],h=p.canvas.height-t/2-l*s-t/2-15,d=l<20?1:2,u=Math.random()<.6?Math.floor(Math.random()*d)+1:0;if(u===0)continue;const g=[];if(r.gapStart===-1)for(let b=2;b<i-2;b++)g.push(b);else{for(let b=2;b<r.gapStart-1;b++)g.push(b);for(let b=r.gapStart+r.gapSize+1;b<i-2;b++)g.push(b)}for(let b=0;b<Math.min(u,g.length);b++){const y=Math.floor(Math.random()*g.length),f=g[y],m=f*t+t/2;g.splice(y,1);let S=t*.5,v=t*(i-.5);r.gapStart!==-1&&(f<r.gapStart?v=t*(r.gapStart-.5):S=t*(r.gapStart+r.gapSize+.5));const k=new U(this,m,h,S,v,"red",!0);k.setPlayerReference(this.player),this.stalkerCats.add(k)}}}handleCatCatCollision(e,t){const s=e,i=t,a=10;s.x<i.x?(s.setX(s.x-a),i.setX(i.x+a)):(i.setX(i.x-a),s.setX(s.x+a)),s.reverseDirection(),i.reverseDirection()}createAllCollectibles(){const e=p.game.tileSize,t=p.game.floorSpacing,i=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).collectibleTypes;if(this.levelManager.isBonusLevel()){this.createBonusLevelChests();return}for(let a=0;a<this.floorLayouts.length;a++){const o=this.floorLayouts[a],r=p.canvas.height-e/2-a*t-e-8,n=[];for(let b=1;b<p.game.floorWidth-1;b++)this.hasPlatformAt(o,b)&&!this.hasLadderAt(b,a)&&!this.hasDoorAt(b,a)&&n.push(b);if(n.length===0)continue;const c=[];if(i.includes("coin")&&a>0){const b=Math.floor(Math.random()*3)+2;this.placeCollectiblesOfType(n,b,"coin",r,a,c)}i.includes("blueCoin")&&a>0&&Math.random()<.2&&this.placeCollectiblesOfType(n,1,"blueCoin",r,a,c),i.includes("diamond")&&a>1&&Math.random()<.08&&this.placeCollectiblesOfType(n,1,"diamond",r,a,c),i.includes("freeLife")&&a>2&&Math.random()<.03&&this.placeCollectiblesOfType(n,1,"freeLife",r,a,c);const h=Math.random();if(i.includes("invincibilityPendant")&&!(a===0)&&h<.03&&this.placeCollectiblesOfType(n,1,"invincibilityPendant",r,a,c),i.includes("treasureChest")&&a>=3){const b=this.levelManager.getCurrentLevel();this.shouldSpawnChestOnFloor(b,a)&&this.placeCollectiblesOfType(n,1,"treasureChest",r,a,c)}const g=this.levelManager.getCurrentLevel();g>=3&&!this.levelHasCrystalBall&&a>=2&&Math.random()<.3&&(console.log("🔮 TRYING to spawn Crystal Ball - Level:",g,"Floor:",a,"HasCrystalBall:",this.levelHasCrystalBall),this.placeCollectiblesOfType(n,1,"crystalBall",r,a,c),this.levelHasCrystalBall=!0,console.log("🔮 Crystal Ball spawn attempted, levelHasCrystalBall now:",this.levelHasCrystalBall)),g>=11&&!this.levelHasCursedOrb&&a>=2&&Math.random()<.2&&(this.placeCollectiblesOfType(n,1,"cursedOrb",r,a,c),this.levelHasCursedOrb=!0),g>=21&&!this.levelHasCursedTealOrb&&a>=2&&Math.random()<.15&&(this.placeCollectiblesOfType(n,1,"cursedTealOrb",r,a,c),this.levelHasCursedTealOrb=!0)}}placeCollectiblesOfType(e,t,s,i,a,o){const l=p.game.tileSize,r=s==="treasureChest"?e.filter(n=>this.isSafeForTreasureChest(n,a)):e.filter(n=>!this.hasLadderAt(n,a)&&!this.hasDoorAt(n,a));for(let n=0;n<Math.min(t,r.length);n++){let c=0,h=-1;for(;c<20&&h===-1;){const u=Math.floor(Math.random()*r.length),g=r[u];if(!this.isPositionOccupiedWithVariety(g,s,o)){h=g,o.push({x:h,type:s});for(let b=r.length-1;b>=0;b--)Math.abs(r[b]-h)<2&&r.splice(b,1)}c++}if(h===-1)break;const d=h*l+l/2;switch(s){case"coin":const u=new oe(this,d,i);this.coins.push(u),this.physics.add.overlap(this.player,u.sprite,()=>this.handleCoinCollection(u),void 0,this);break;case"blueCoin":const g=new le(this,d,i);this.blueCoins.push(g),this.physics.add.overlap(this.player,g.sprite,()=>this.handleBlueCoinCollection(g),void 0,this);break;case"diamond":const b=new re(this,d,i);this.diamonds.push(b),this.physics.add.overlap(this.player,b.sprite,()=>this.handleDiamondCollection(b),void 0,this);break;case"freeLife":const y=new ne(this,d,i);this.freeLifes.push(y),this.physics.add.overlap(this.player,y.sprite,()=>this.handleFreeLifeCollection(y),void 0,this);break;case"invincibilityPendant":const f=new be(this,d,i);this.invincibilityPendants.push(f),this.physics.add.overlap(this.player,f.sprite,()=>{this.handleInvincibilityPendantCollection(f)},void 0,this);break;case"treasureChest":const m=new ye(this,d,i);this.treasureChests.push(m);break;case"crystalBall":console.log("🔮 SPAWNING Crystal Ball at",d,i,"floor:",a);const S=new Oe(this,d,i);this.crystalBalls.push(S),console.log("🔮 Crystal Ball created, total crystal balls:",this.crystalBalls.length),this.physics.add.overlap(this.player,S.sprite,()=>this.handleCrystalBallCollection(S),void 0,this);break;case"cursedOrb":const v=new me(this,d,i,"cursed");this.cursedOrbs.push(v),this.physics.add.overlap(this.player,v.sprite,()=>this.handleCursedOrbCollection(v),void 0,this);break;case"cursedTealOrb":const k=new me(this,d,i,"cursedTeal");this.cursedTealOrbs.push(k),this.physics.add.overlap(this.player,k.sprite,()=>this.handleCursedTealOrbCollection(k),void 0,this);break}}}hasLadderAt(e,t){return(this.ladderPositions.get(t)||[]).includes(e)}hasDoorAt(e,t){const s=this.doorPositions.get(t);return s===void 0?!1:Math.abs(e-s)<=2}createBonusLevelChests(){const e=p.game.tileSize,t=p.game.floorSpacing,s=[2,3];for(let i=0;i<s.length;i++){const a=s[i];if(a>=this.floorLayouts.length)continue;const o=this.floorLayouts[a],r=p.canvas.height-e/2-a*t-e-8,n=[];for(let u=1;u<p.game.floorWidth-1;u++)this.hasPlatformAt(o,u)&&!this.hasLadderAt(u,a)&&!this.hasDoorAt(u,a)&&n.push(u);if(n.length===0)continue;const c=Math.floor(Math.random()*n.length),h=n[c]*e+e/2,d=new ye(this,h,r);this.treasureChests.push(d)}this.createBonusLevelCollectibles(),this.createBonusLevelFreeLife()}createBonusLevelCollectibles(){const e=p.game.tileSize,t=p.game.floorSpacing;for(let s=1;s<this.floorLayouts.length-1;s++){const i=this.floorLayouts[s],o=p.canvas.height-e/2-s*t-e-8,l=[];for(let d=1;d<p.game.floorWidth-1;d++)this.hasPlatformAt(i,d)&&!this.hasLadderAt(d,s)&&!this.hasDoorAt(d,s)&&l.push(d);if(l.length===0)continue;const r=[...l].sort(()=>Math.random()-.5);if(r.length>0){const d=Math.min(Math.floor(r.length/3),r.length-1),u=r[d]*e+e/2,g=new re(this,u,o);this.diamonds.push(g),this.time.delayedCall(100,()=>{this.physics.add.overlap(this.player,g.sprite,()=>this.handleDiamondCollection(g),void 0,this)}),r.splice(d,1)}const n=Math.max(1,Math.floor(r.length/6));for(let d=0;d<5&&d<r.length;d++){const u=Math.min(d*n,r.length-1),g=r[u]*e+e/2,b=new le(this,g,o);this.blueCoins.push(b),this.physics.add.overlap(this.player,b.sprite,()=>this.handleBlueCoinCollection(b),void 0,this),r.splice(u,1)}let c=0;const h=2;for(let d=0;d<r.length;d++)if(c===0||d>=c+h){const u=r[d]*e+e/2,g=new oe(this,u,o);this.coins.push(g),this.physics.add.overlap(this.player,g.sprite,()=>this.handleCoinCollection(g),void 0,this),c=d}}}createBonusLevelFreeLife(){const e=p.game.tileSize,t=p.game.floorSpacing,s=3;if(s<this.floorLayouts.length){const i=this.floorLayouts[s],o=p.canvas.height-e/2-s*t-e-8,l=[];for(let r=1;r<p.game.floorWidth-1;r++)this.hasPlatformAt(i,r)&&!this.hasLadderAt(r,s)&&!this.hasDoorAt(r,s)&&l.push(r);if(l.length>0){const r=Math.min(2,l.length-1),n=l[r]*e+e/2,c=new ne(this,n,o);this.freeLifes.push(c),this.time.delayedCall(100,()=>{this.physics.add.overlap(this.player,c.sprite,()=>{this.handleFreeLifeCollection(c)},void 0,this)})}}}createLevel10TestingCollectibles(){const e=p.game.tileSize,t=p.game.floorSpacing,s=[];for(let i=1;i<this.floorLayouts.length-1;i++)s.push(i);for(let i of s){if(i>=this.floorLayouts.length)continue;const a=this.floorLayouts[i],l=p.canvas.height-e/2-i*t-e-8,r=[];for(let c=1;c<p.game.floorWidth-1;c++)this.hasPlatformAt(a,c)&&!this.hasLadderAt(c,i)&&!this.hasDoorAt(c,i)&&r.push(c);if(r.length===0)continue;const n=Math.min(3,r.length);for(let c=0;c<n;c++){const h=Math.floor(Math.random()*r.length),u=r.splice(h,1)[0]*e+e/2,g=new be(this,u,l);this.invincibilityPendants.push(g),this.physics.add.overlap(this.player,g.sprite,()=>this.handleInvincibilityPendantCollection(g),void 0,this)}}}shouldSpawnChestOnFloor(e,t){if(e<=4){const s=this.levelManager.getLevelConfig(e),i=Math.floor(s.floorCount/2);return t===i||t===i+1&&Math.random()<.5}else if(e<=6){const s=this.levelManager.getLevelConfig(e),i=Math.floor(s.floorCount/3),a=Math.floor(s.floorCount*2/3);return t===i||t===a}else return t%3===0||Math.random()<.35}isSafeForTreasureChest(e,t){const s=p.game.floorWidth,i=p.game.tileSize,o=Math.ceil((60+16)/i);if(e<o||e>=s-o)return!1;const l=this.floorLayouts[t];if(l&&l.gapStart!==-1){const d=l.gapStart+l.gapSize;if(e>=l.gapStart-o&&e<=d+o-1)return!1}const r=this.ladderPositions.get(t)||[],n=this.ladderPositions.get(t-1)||[],c=[...r,...n];for(const d of c)if(Math.abs(e-d)<=o)return!1;const h=this.doorPositions.get(t);return!(h!==void 0&&Math.abs(e-h)<=o+1)}isPositionOccupied(e,t,s){if(this.hasLadderAt(e,t))return!0;const i=this.doorPositions.get(t);if(i!==void 0&&Math.abs(e-i)<4)return!0;const a=this.ladderPositions.get(t)||[];for(const o of a)if(Math.abs(e-o)<2)return!0;return s.some(o=>Math.abs(o-e)<2)}isPositionOccupiedWithVariety(e,t,s){return s.some(o=>Math.abs(o.x-e)<2)?!0:s.some(o=>o.type===t&&Math.abs(o.x-e)<3)}handleCoinCollection(e){if(this.isLevelStarting||e.isCollected())return;this.score+=p.scoring.coinCollect,this.playSoundEffect("gem-collect",.5),this.totalCoinsCollected++,this.totalGemsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalGems",this.totalGemsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,p.scoring.coinCollect),this.triggerFarcadeHapticFeedback(),e.collect();const t=this.coins.indexOf(e);t>-1&&this.coins.splice(t,1)}handleBlueCoinCollection(e){if(this.isLevelStarting||e.isCollected())return;const t=500;this.score+=t,this.playSoundEffect("big-blue-gem-collect",.5),this.totalCoinsCollected+=5,this.totalBlueGemsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalBlueGems",this.totalBlueGemsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),this.triggerFarcadeHapticFeedback(),e.collect();const s=this.blueCoins.indexOf(e);s>-1&&this.blueCoins.splice(s,1)}handleDiamondCollection(e){if(this.isLevelStarting||e.isCollected())return;const t=1e3;this.score+=t,this.playSoundEffect("diamond-collect",.5),this.totalCoinsCollected+=10,this.totalDiamondsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalDiamonds",this.totalDiamondsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),this.triggerFarcadeHapticFeedback(),e.collect();const s=this.diamonds.indexOf(e);s>-1&&this.diamonds.splice(s,1)}handleFreeLifeCollection(e){if(this.isLevelStarting||e.isCollected())return;const t=2e3;this.score+=t,this.playSoundEffect("heart-collect",.5),this.lives<this.MAX_LIVES&&(this.lives++,this.game.registry.set("playerLives",this.lives),console.log(`💚 Free life collected! Lives: ${this.lives}`),this.showExtraLifePopup("Heart Crystal!")),this.updateScoreDisplay(),this.updateLivesDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),e.collect();const s=this.freeLifes.indexOf(e);s>-1&&this.freeLifes.splice(s,1)}handleInvincibilityPendantCollection(e){if(this.isLevelStarting||e.isCollected())return;const t=300;this.score+=t,this.playSoundEffect("powerup-collect",.5),this.activateInvincibility(),this.updateScoreDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),e.collect();const s=this.invincibilityPendants.indexOf(e);s>-1&&this.invincibilityPendants.splice(s,1)}handleCrystalBallCollection(e){if(console.log("🔮 CRYSTAL BALL COLLISION DETECTED!"),this.isLevelStarting){console.log("❌ Cannot collect - level is starting");return}if(e.isCollected()){console.log("❌ Cannot collect - already collected");return}console.log("🔮 COLLECTING Crystal Ball - activating power-up!"),this.playSoundEffect("powerup-collect",.5),this.player.activateCrystalBall(),e.collect();const t=this.crystalBalls.indexOf(e);t>-1&&(this.crystalBalls.splice(t,1),console.log("🔮 Crystal Ball removed from array, remaining:",this.crystalBalls.length)),window.FarcadeSDK?.singlePlayer?.actions?.hapticFeedback&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}handleCursedOrbCollection(e){if(console.log("💀 CURSED ORB COLLISION DETECTED!"),this.isLevelStarting){console.log("❌ Cannot collect - level is starting");return}if(e.isCollected()){console.log("❌ Cannot collect - already collected");return}this.playSoundEffect("cursed-orb-collect",.5),this.player.activateCursedOrb(),e.collect();const t=this.cursedOrbs.indexOf(e);t>-1&&this.cursedOrbs.splice(t,1),window.FarcadeSDK?.singlePlayer?.actions?.hapticFeedback&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}handleCursedTealOrbCollection(e){if(console.log("🌀 CURSED TEAL ORB COLLISION DETECTED!"),this.isLevelStarting){console.log("❌ Cannot collect - level is starting");return}if(e.isCollected()){console.log("❌ Cannot collect - already collected");return}this.playSoundEffect("cursed-orb-collect",.5),this.player.activateCursedTealOrb(),e.collect();const t=this.cursedTealOrbs.indexOf(e);t>-1&&this.cursedTealOrbs.splice(t,1),window.FarcadeSDK?.singlePlayer?.actions?.hapticFeedback&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}activateDarknessEffect(){console.log("💀 Activating darkness effect!"),this.darknessOverlay?this.darknessOverlay.setVisible(!0):(this.darknessOverlay=this.add.image(p.canvas.width/2,p.canvas.height/2-50,"visibilityOverlay"),this.darknessOverlay.setScrollFactor(0),this.darknessOverlay.setDepth(150),this.darknessOverlay.setOrigin(.5,.5)),this.darknessOverlay.setAlpha(0),this.tweens.add({targets:this.darknessOverlay,alpha:1,duration:500,ease:"Power2.easeIn"})}deactivateDarknessEffect(){console.log("💀 Deactivating darkness effect!"),this.darknessOverlay&&this.tweens.add({targets:this.darknessOverlay,alpha:0,duration:500,ease:"Power2.easeOut",onComplete:()=>{this.darknessOverlay&&this.darknessOverlay.setVisible(!1)}})}createCrystalBallProjectile(e,t,s,i=0){console.log("Creating crystal ball projectile at",e,t,"direction:",s,"player velocity:",i),this.playSoundEffect("crystal-ball-throw",.5);const a=new Le(this,e,t,s,i);this.crystalBallProjectiles.push(a),this.physics.add.overlap(a,this.cats,(o,l)=>this.handleProjectileEnemyCollision(o,l),void 0,this),this.physics.add.overlap(a,this.beetles,(o,l)=>this.handleProjectileEnemyCollision(o,l),void 0,this),this.physics.add.overlap(a,this.stalkerCats,(o,l)=>this.handleProjectileEnemyCollision(o,l),void 0,this),this.physics.add.overlap(a,this.baseBlus,(o,l)=>this.handleProjectileEnemyCollision(o,l),void 0,this),this.physics.add.collider(a,this.platforms),this.physics.add.collider(a,this.spikes),console.log("Crystal ball projectile created, total projectiles:",this.crystalBallProjectiles.length)}updateCrystalBallProjectiles(e,t){for(let s=this.crystalBallProjectiles.length-1;s>=0;s--){const i=this.crystalBallProjectiles[s];!i||!i.scene?this.crystalBallProjectiles.splice(s,1):i.update(e,t)}}handleProjectileEnemyCollision(e,t){console.log("💥 Crystal Ball projectile hit enemy!"),this.playSoundEffect("crystal-ball-hit-enemy",.5),t&&t.body&&(t.body.enable=!1,this.createCrystalBallDefeatEffect(t.x,t.y),this.tweens.add({targets:t,scaleX:0,scaleY:0,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>{t.defeat?t.defeat():t.destroy&&t.destroy()}}));const s=t.getPointValue?t.getPointValue():100;this.score+=s,this.updateScoreDisplay(),this.showPointPopup(t.x,t.y-20,s),console.log("💥 Enemy defeated by crystal ball, awarded",s,"points"),e.hitEnemy();const i=this.crystalBallProjectiles.indexOf(e);i>-1&&(this.crystalBallProjectiles.splice(i,1),console.log("💥 Projectile removed, remaining:",this.crystalBallProjectiles.length)),window.FarcadeSDK?.singlePlayer?.actions?.hapticFeedback&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}updateCrystalBallTimer(e,t){if(this.crystalBallTimerImage.setVisible(!0),console.log("Crystal ball timer update:",e,"ms remaining"),e>0){const s=e/t;if(this.crystalBallTimerMask.x=this.crystalBallTimerImage.x,this.crystalBallTimerMask.y=this.crystalBallTimerImage.y,this.crystalBallTimerMask.clear(),this.crystalBallTimerMask.fillStyle(4509863,.6),this.crystalBallTimerMask.beginPath(),this.crystalBallTimerMask.moveTo(0,0),this.crystalBallTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-s),!1),this.crystalBallTimerMask.lineTo(0,0),this.crystalBallTimerMask.closePath(),this.crystalBallTimerMask.fillPath(),e<=2e3){const i=Math.sin(Date.now()/100)*.5+.5;this.crystalBallTimerImage.setAlpha(.5+i*.5),console.log("Crystal ball timer WARNING - flashing")}else this.crystalBallTimerImage.setAlpha(1)}else this.crystalBallTimerMask.clear(),this.crystalBallTimerImage.setAlpha(1),console.log("Crystal ball timer - power-up expired, hiding timer")}updateCursedOrbTimer(e,t){if(e>0){this.cursedOrbTimerImage.setVisible(!0);const s=e/t;if(this.cursedOrbTimerMask.x=this.cursedOrbTimerImage.x,this.cursedOrbTimerMask.y=this.cursedOrbTimerImage.y,this.cursedOrbTimerMask.clear(),this.cursedOrbTimerMask.fillStyle(5768769,.7),this.cursedOrbTimerMask.beginPath(),this.cursedOrbTimerMask.moveTo(0,0),this.cursedOrbTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-s),!1),this.cursedOrbTimerMask.lineTo(0,0),this.cursedOrbTimerMask.closePath(),this.cursedOrbTimerMask.fillPath(),e<=2e3){const i=Math.sin(Date.now()/100)*.5+.5;this.cursedOrbTimerImage.setAlpha(.5+i*.5)}else this.cursedOrbTimerImage.setAlpha(1)}else this.cursedOrbTimerMask.clear(),this.cursedOrbTimerImage.setAlpha(1)}updateCursedTealOrbTimer(e,t){if(e>0){this.cursedTealOrbTimerImage.setVisible(!0);const s=e/t;if(this.cursedTealOrbTimerMask.x=this.cursedTealOrbTimerImage.x,this.cursedTealOrbTimerMask.y=this.cursedTealOrbTimerImage.y,this.cursedTealOrbTimerMask.clear(),this.cursedTealOrbTimerMask.fillStyle(4827036,.7),this.cursedTealOrbTimerMask.beginPath(),this.cursedTealOrbTimerMask.moveTo(0,0),this.cursedTealOrbTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-s),!1),this.cursedTealOrbTimerMask.lineTo(0,0),this.cursedTealOrbTimerMask.closePath(),this.cursedTealOrbTimerMask.fillPath(),e<=2e3){const i=Math.sin(Date.now()/100)*.5+.5;this.cursedTealOrbTimerImage.setAlpha(.5+i*.5)}else this.cursedTealOrbTimerImage.setAlpha(1)}else this.cursedTealOrbTimerMask.clear(),this.cursedTealOrbTimerImage.setAlpha(1)}activateInvincibility(){this.invincibilityTimer&&this.invincibilityTimer.destroy(),this.invincibilityActive=!0,this.invincibilityTimeRemaining=10,this.invincibilityWarningPlayed=!1,this.player.setSpeedMultiplier(1.5),this.invincibilityTimer=this.time.addEvent({delay:100,callback:()=>this.updateInvincibilityTimer(),loop:!0}),this.addPlayerGoldenAura(),this.startTimerSparkles(),this.enableSpikeWalking()}updateInvincibilityTimer(){if(this.invincibilityTimeRemaining-=.1,!this.invincibilityWarningPlayed&&this.invincibilityTimeRemaining<=2&&this.invincibilityTimeRemaining>0&&(this.invincibilityWarningPlayed=!0,console.log("⏰ Timer warning for invincibility")),this.invincibilityTimeRemaining<=0)this.invincibilityActive=!1,this.invincibilityTimeRemaining=0,this.invincibilityTimer&&(this.invincibilityTimer.destroy(),this.invincibilityTimer=null),this.invincibilityTimerMask.clear(),this.stopTimerSparkles(),this.removePlayerGoldenAura(),this.player.setSpeedMultiplier(1),this.disableSpikeWalking();else if(this.updateInvincibilityMask(),this.invincibilityTimeRemaining<=3){const e=Math.sin(this.invincibilityTimeRemaining*10)*.2+.8;this.invincibilityTimerImage.setAlpha(e)}}updateInvincibilityMask(){this.invincibilityTimerMask.x=this.invincibilityTimerImage.x,this.invincibilityTimerMask.y=this.invincibilityTimerImage.y;const e=this.invincibilityTimeRemaining/10;this.invincibilityTimerMask.clear(),this.invincibilityTimerMask.fillStyle(16766720,.6),this.invincibilityTimerMask.beginPath(),this.invincibilityTimerMask.moveTo(0,0),this.invincibilityTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-e),!1),this.invincibilityTimerMask.lineTo(0,0),this.invincibilityTimerMask.closePath(),this.invincibilityTimerMask.fillPath()}addPlayerGoldenAura(){this.playerGoldenAura||!this.player||(this.playerGoldenAura=this.add.circle(this.player.x,this.player.y,25,16766720),this.playerGoldenAura.setAlpha(.3),this.playerGoldenAura.setDepth(this.player.depth-1),this.tweens.add({targets:this.playerGoldenAura,scaleX:1.4,scaleY:1.4,alpha:.1,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createPlayerParticleTrail())}removePlayerGoldenAura(){this.playerGoldenAura&&(this.playerGoldenAura.destroy(),this.playerGoldenAura=null),this.playerParticleTrail.forEach(e=>e.destroy()),this.playerParticleTrail=[]}startTimerSparkles(){this.invincibilityTimerSparkleTimer&&this.invincibilityTimerSparkleTimer.destroy(),this.invincibilityTimerSparkleTimer=this.time.addEvent({delay:300+Math.random()*200,callback:()=>this.createTimerSparkle(),loop:!0})}stopTimerSparkles(){this.invincibilityTimerSparkleTimer&&(this.invincibilityTimerSparkleTimer.destroy(),this.invincibilityTimerSparkleTimer=null)}createTimerSparkle(){if(!this.invincibilityTimerImage||!this.invincibilityActive)return;const e=this.invincibilityTimerImage.x,t=this.invincibilityTimerImage.y,s=e+(Math.random()-.5)*50,i=t+(Math.random()-.5)*50,a=this.add.graphics();a.fillStyle(16766720,.9),a.beginPath();for(let l=0;l<8;l++){const r=l/8*Math.PI*2,n=l%2===0?3:1.5,c=Math.cos(r)*n,h=Math.sin(r)*n;l===0?a.moveTo(c,h):a.lineTo(c,h)}a.closePath(),a.fillPath();const o=this.add.container(s,i);o.add(a),o.setDepth(103),o.setScrollFactor(0),this.tweens.add({targets:o,scaleX:2,scaleY:2,alpha:0,rotation:Math.PI,duration:600,ease:"Power2",onComplete:()=>{o.destroy()}})}createPlayerParticleTrail(){for(let e=0;e<8;e++){const t=this.add.graphics();t.setDepth(this.player.depth+1),t.fillStyle(16766720,.8),t.fillCircle(0,0,2),this.playerParticleTrail.push(t),this.animateParticle(t,e)}}animateParticle(e,t){if(!this.player||!this.invincibilityActive){e.destroy();return}const s=Math.PI*2/8*t+this.time.now*.003,i=20+Math.sin(this.time.now*.005+t)*5;e.setPosition(this.player.x+Math.cos(s)*i,this.player.y+Math.sin(s)*i),this.invincibilityActive&&this.time.delayedCall(50,()=>this.animateParticle(e,t))}enableSpikeWalking(){this.playerSpikeOverlap&&(this.playerSpikeOverlap.active=!1),this.playerSpikeCollider=this.physics.add.collider(this.player,this.spikes,void 0,(e,t)=>t.getData("isFloorSpike"),this)}disableSpikeWalking(){this.playerSpikeCollider&&(this.physics.world.removeCollider(this.playerSpikeCollider),this.playerSpikeCollider=null),this.playerSpikeOverlap&&(this.playerSpikeOverlap.active=!0)}shouldCollideWithPlatform(){return!this.player.getIsClimbing()}handlePlayerCatInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;const s=e,i=t,a=s.body,o=i.body,l=a.velocity.y>0,r=a.bottom<=o.top+5;l&&r?(this.justKilledCat=!0,this.handleCatKill(s,i),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.justKilledCat||this.handlePlayerDamage(s,i)}handlePlayerBaseBluInteraction(e,t){if(this.isGameOver)return;const s=e,i=t,a=s.body,o=i.body;if(this.invincibilityActive&&i.canBeKilledByInvinciblePlayer()){const n=i.handleInvinciblePlayerKill();this.score+=n,this.updateScoreDisplay(),this.showPointPopup(i.x,i.y-20,n),this.gameStats.enemyKills.blu++,this.gameStats.totalEnemiesDefeated++,this.playSoundEffect("squish-baseblu",.5),a.setVelocityY(p.game.jumpVelocity*.5),this.baseBlus.remove(i);return}const l=a.velocity.y>0,r=a.bottom<=o.top+10;if(l&&r)i.handlePlayerBounce(),i.startStun(),a.setVelocityY(p.game.jumpVelocity*.7);else{i.startStun();const n=a.x<o.x?-1:1;a.setVelocityX(n*100)}}handlePlayerBeetleInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;const s=e,i=t,a=s.body,o=i.body,l=a.velocity.y>0,r=a.y+a.height/2,h=o.y+o.height/2-r>5||a.bottom<=o.top+12;if(l&&h){this.justKilledCat=!0,this.handleBeetleKill(s,i),this.time.delayedCall(100,()=>{this.justKilledCat=!1});return}this.invincibilityActive?(this.justKilledCat=!0,this.handleBeetleKill(s,i),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.handlePlayerDamage(s,i)}handlePlayerStalkerCatInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;const s=e,i=t;if(!i.canDamagePlayer())return;const a=s.body,o=i.body,l=a.velocity.y>0,r=a.bottom<=o.top+5;l&&r?(this.justKilledCat=!0,this.handleStalkerCatKill(s,i),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.justKilledCat||this.handlePlayerDamage(s,i)}handlePlayerSpikeCollision(e,t){if(this.isGameOver||this.invincibilityActive)return;const s=e,i=s.body,a=t;if(a.getData("isCeilingSpike")){if(i.velocity.y<-50){const l=a.getData("graphics");l&&this.tweens.add({targets:l,x:l.x+2,duration:50,yoyo:!0,repeat:3,onComplete:()=>{l.x=a.getData("x")-p.game.tileSize/2}}),this.handlePlayerDamage(s)}}else a.getData("isFloorSpike")?(a.getData("visualSpikeHeight"),a.getData("visualSpikeBaseY"),i.velocity.y>50&&this.handlePlayerDamage(s)):i.velocity.y>50&&this.handlePlayerDamage(s)}handleCatKill(e,t){if(t.isSquished)return;const s=t.getCatColor();if(e.getIsClimbing()){let c;switch(s){case"yellow":c=O.CATERPILLAR;break;case"blue_caterpillar":c=O.BLUE_CATERPILLAR;break;case"blue":c=O.CHOMPER;break;case"purple":c=O.CHOMPER;break;case"red":c=O.SNAIL;break;case"green":c=O.JUMPER;break;default:c=O.CHOMPER;break}const h=D.getPointValue(c);this.score+=h,this.updateScoreDisplay(),e.setVelocityY(p.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,h);return}let i;switch(s){case"yellow":i=O.CATERPILLAR;break;case"blue_caterpillar":i=O.BLUE_CATERPILLAR;break;case"blue":i=O.CHOMPER;break;case"red":i=O.SNAIL;break;case"green":i=O.JUMPER;break;default:i=O.CHOMPER;break}const a=D.getPointValue(i),o=Math.max(1,this.comboCount),l=a*o;this.score+=l,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(p.game.jumpVelocity*.7);const r=this.getEnemyTypeName(t);r!=="unknown"&&r in this.gameStats.enemyKills?(this.gameStats.enemyKills[r]++,this.gameStats.totalEnemiesDefeated++,console.log(`✅ Kill tracked: ${r} | Total ${r}: ${this.gameStats.enemyKills[r]} | Total enemies: ${this.gameStats.totalEnemiesDefeated}`)):console.error(`❌ Kill NOT tracked! Enemy type: ${r}`);let n="squish-chomper";switch(s){case"yellow":n="squish-caterpillar";break;case"blue_caterpillar":n="squish-baseblu";break;case"blue":case"purple":n="squish-chomper";break;case"red":n="squish-snail";break;case"green":n="squish-jumper";break}this.playSoundEffect(n,.5),t.squish(),this.showPointPopup(t.x,t.y-20,l)}handleBeetleKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){const o=D.getPointValue(O.BEETLE);this.score+=o,this.updateScoreDisplay(),e.setVelocityY(p.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,o);return}const s=D.getPointValue(O.BEETLE),i=Math.max(1,this.comboCount),a=s*i;this.score+=a,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(p.game.jumpVelocity*.7),this.gameStats.enemyKills.rollz++,this.gameStats.totalEnemiesDefeated++,this.playSoundEffect("squish-beetle",.5),t.squish(),this.showPointPopup(t.x,t.y-20,a)}handlePlayerRexInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;const s=e,i=t,a=s.body,o=i.body,l=a.velocity.y>0,n=o.top-a.bottom>5||a.bottom<=o.top+12;if(l&&n){this.justKilledCat=!0,this.handleRexKill(s,i),this.time.delayedCall(100,()=>{this.justKilledCat=!1});return}this.invincibilityActive?(this.justKilledCat=!0,this.handleRexKill(s,i),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.handlePlayerDamage(s,i)}handleRexKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){this.score+=500,this.updateScoreDisplay(),e.setVelocityY(p.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,500);return}const s=500,i=Math.max(1,this.comboCount),a=s*i;this.score+=a,this.updateScoreDisplay(),this.comboCount++,this.comboText&&(this.comboCount>1?(this.comboText.setText(`COMBO x${this.comboCount}`),this.comboText.setVisible(!0)):this.comboText.setVisible(!1)),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(this.COMBO_WINDOW,()=>{this.comboCount=0,this.comboText&&this.comboText.setVisible(!1)}),e.setVelocityY(p.game.jumpVelocity*.7),this.gameStats.enemyKills.rex++,this.gameStats.totalEnemiesDefeated++,this.playSoundEffect("squish-rex",.5),t.squish(),this.showPointPopup(t.x,t.y-20,a)}handleInvincibilityEnemyKill(e,t){if(t.isSquished)return;let s=200;if(t.constructor.name==="Beetle")s=75;else if(t.constructor.name==="Cat"){const o=t.getCatColor();let l;switch(o){case"yellow":l=O.CATERPILLAR;break;case"blue_caterpillar":l=O.BLUE_CATERPILLAR;break;case"blue":l=O.CHOMPER;break;case"red":l=t.isStalker?O.STALKER:O.SNAIL;break;case"green":l=O.JUMPER;break;default:l=O.CHOMPER;break}s=D.getPointValue(l)}const i=s*3;this.score+=i,this.updateScoreDisplay(),e.setVelocityY(p.game.jumpVelocity*.5);let a="squish-chomper";if(t.constructor.name==="Beetle")a="squish-beetle";else if(t.constructor.name==="Cat")switch(t.getCatColor()){case"yellow":a="squish-caterpillar";break;case"blue_caterpillar":a="squish-baseblu";break;case"blue":a="squish-chomper";break;case"red":a=t.isStalker?"squish-stalker":"squish-snail";break;case"green":a="squish-jumper";break}this.playSoundEffect(a,.5),t.squish(),this.showInvincibilityPointPopup(t.x,t.y-20,i)}handleStalkerCatKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){this.score+=200,this.updateScoreDisplay(),e.setVelocityY(p.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,200);return}const s=200,i=Math.max(1,this.comboCount),a=s*i;this.score+=a,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(p.game.jumpVelocity*.7),this.playSoundEffect("squish-stalker",.5),t.squish(),this.showPointPopup(t.x,t.y-20,a)}updateScoreDisplay(){const e=this.accumulatedScore+this.score;this.scoreText.setText(`${e}`)}updateComboDisplay(){this.comboCount>1&&(this.comboText.setText(`COMBO x${this.comboCount}!`),this.comboText.setVisible(!0),this.tweens.add({targets:this.comboText,scaleX:1.2,scaleY:1.2,duration:100,ease:"Power2",yoyo:!0}))}resetCombo(){this.comboCount=0,this.comboText.setVisible(!1),this.comboTimer&&(this.comboTimer.destroy(),this.comboTimer=null)}createDebugGridlines(){const e=this.add.graphics();e.lineStyle(1,65280,.3),e.setDepth(9999),e.setScrollFactor(1);const t=p.game.tileSize,s=p.canvas.height,i=p.game.floorSpacing,a=s-t;e.lineStyle(2,16711680,.5),e.beginPath(),e.moveTo(-1e3,a),e.lineTo(2e3,a),e.stroke();const o=this.add.text(10,a-20,`Ground Floor (Y=${a})`,{fontSize:"12px",color:"#ff0000",backgroundColor:"#000000"});o.setDepth(1e4),o.setScrollFactor(1);for(let l=1;l<=10;l++){const r=a-l*i;e.lineStyle(1,65535,.4),e.beginPath(),e.moveTo(-1e3,r),e.lineTo(2e3,r),e.stroke();const n=this.add.text(10,r-15,`Floor ${l} (Y=${r})`,{fontSize:"10px",color:"#00ffff",backgroundColor:"#000000"});n.setDepth(1e4),n.setScrollFactor(1)}e.lineStyle(1,65280,.2);for(let l=0;l<2e3;l+=t)e.beginPath(),e.moveTo(-1e3,l),e.lineTo(2e3,l),e.stroke();for(let l=-t;l>-2e3;l-=t)e.beginPath(),e.moveTo(-1e3,l),e.lineTo(2e3,l),e.stroke();console.log("📏 Debug Gridlines Created:",{groundFloor:a,floorSpacing:i,tileSize:t,canvasHeight:s,floor1Y:a-i,floor2Y:a-2*i,floor3Y:a-3*i})}createVisibilitySystem(){this.visibilityMask=this.add.image(0,0,"visibilityOverlay"),this.visibilityMask.setDepth(98),this.visibilityMask.setOrigin(.5,.5)}updateVisibilitySystem(){if(!this.visibilityMask)return;const t=this.levelManager.getCurrentLevel()%10===9;this.visibilityMask.setVisible(t);const s=this.player.x,i=this.player.y,a=s,o=i-192;this.visibilityMask.setPosition(a,o)}showPointPopup(e,t,s){const i=this.add.text(e,t,`+${s}`,{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(150);this.tweens.add({targets:i,alpha:0,duration:1200,ease:"Power1.easeOut",onComplete:()=>{i.destroy()}})}createCrystalBallDefeatEffect(e,t){for(let s=0;s<6;s++){const i=this.add.graphics();i.fillStyle(4509863,1),i.fillCircle(0,0,2);const a=s/6*Math.PI*2;i.x=e,i.y=t,i.setDepth(25);const o=15+Math.random()*10;this.tweens.add({targets:i,x:e+Math.cos(a)*o,y:t+Math.sin(a)*o,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>i.destroy()})}}createPortalSuckAnimation(e,t,s){const i=this.add.graphics();i.setDepth(25);const a=3;for(let l=0;l<a;l++){const r=this.add.graphics();r.setDepth(24+l);const n=l*120*Math.PI/180;r.lineStyle(2,10053375,.8),this.tweens.add({targets:r,rotation:n+Math.PI*4,scaleX:{from:2,to:0},scaleY:{from:2,to:0},alpha:{from:.8,to:0},duration:800,ease:"Power2.easeIn",onUpdate:()=>{r.clear(),r.lineStyle(3,10053375,r.alpha);const c=[],h=3,d=15*r.scaleX;r.x=e,r.y=t;for(let u=0;u<h*Math.PI*2;u+=.1){const g=u/(h*Math.PI*2)*d,b=Math.cos(u+r.rotation)*g,y=Math.sin(u+r.rotation)*g;c.push({x:b,y})}if(c.length>1){r.beginPath(),r.moveTo(c[0].x,c[0].y);for(let u=1;u<c.length;u++)r.lineTo(c[u].x,c[u].y);r.strokePath()}},onComplete:()=>{r.destroy()}})}const o=this.add.graphics();o.setDepth(26),o.fillStyle(4509863,.6),o.fillCircle(e,t,5),this.tweens.add({targets:o,scaleX:{from:0,to:3,duration:400},scaleY:{from:0,to:3,duration:400},yoyo:!0,ease:"Power2.easeInOut",onComplete:()=>{o.destroy(),i.destroy(),s&&s()}})}showInvincibilityPointPopup(e,t,s){const i=this.add.text(e,t,`+${s}`,{fontSize:"18px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(150);this.tweens.add({targets:i,alpha:0,y:t-30,scaleX:1.5,scaleY:1.5,duration:1500,ease:"Power2.easeOut",onComplete:()=>{i.destroy()}})}handlePlayerDamage(e,t){if(this.isGameOver)return;if(this.invincibilityActive){t&&t.squish&&this.handleInvincibilityEnemyKill(e,t);return}this.playSoundEffect("player-dies-enemy",.5),this.resetCombo(),e.getCrystalBallActive&&e.getCrystalBallActive()&&(console.log("🔮 Player died - shutting off Crystal Ball power-up"),e.stopCrystalBallParticles&&e.stopCrystalBallParticles(),this.updateCrystalBallTimer(0,2e4));const s=this.lives;this.lives--,this.gameStats.livesLost++,this.game.registry.set("playerLives",this.lives),this.updateLivesDisplay(),console.log(`💔 Player died! Lives: ${s} -> ${this.lives}`),this.triggerFarcadeHapticFeedback(),e.setVelocity(0,0),e.setTint(16711680),e.body.enable=!1,this.lives>0?this.showLostLifePopup():(this.isGameOver=!0,this.showGameOverScreen())}handleLadderOverlap(e,t){const s=e;if(s.checkLadderProximity(t)&&(s.getIsClimbing()||s.startClimbing(t)),s.getIsClimbing()){const i=t,a=i.y-i.height/2,o=i.y+i.height/2;(s.y<a-32||s.y>o+8)&&s.exitClimbing()}}updateTreasureChestInteraction(){for(let e=this.treasureChests.length-1;e>=0;e--){const t=this.treasureChests[e];if(!t.canInteract())continue;if(Phaser.Math.Distance.Between(this.player.x,this.player.y,t.sprite.x,t.sprite.y)<32&&this.player.body.blocked.down){this.openTreasureChest(t);break}}}updateDoorPrompt(){if(!this.door||!this.player||!this.player.body)return;const t=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).floorCount-1,i=this.player.body.blocked?.down||!1,o=Phaser.Math.Distance.Between(this.player.x,this.player.y,this.door.x,this.door.y)<80,l=this.currentFloor===t;o&&l&&i?(this.door.showPrompt(this.player),(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP).isDown||this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).isDown||this.touchControls?.upPressed)&&!this.isLevelComplete&&this.completeLevel()):this.door.hidePrompt()}openTreasureChest(e){if(this.isLevelStarting)return;const t=e.open();this.playSoundEffect("treasure-chest-open",.5),this.gameStats.treasureChestsOpened++,this.score+=2500,this.updateScoreDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-30,2500),this.triggerFarcadeHapticFeedback(),this.spawnTreasureChestContents(e.sprite.x,e.sprite.y,t),this.tweens.add({targets:e.sprite,alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{const s=this.treasureChests.indexOf(e);s>-1&&this.treasureChests.splice(s,1),e.destroy()}})}spawnTreasureChestContents(e,t,s){const i=[{x:e-60,y:t},{x:e+60,y:t},{x:e-45,y:t},{x:e+45,y:t},{x:e-30,y:t},{x:e+30,y:t},{x:e-15,y:t},{x:e+15,y:t},{x:e,y:t-30},{x:e,y:t+15}];let a=0;for(let o=0;o<s.coins&&!(a>=i.length);o++){const l=i[a++],r=new oe(this,l.x,l.y);this.coins.push(r),this.physics.add.overlap(this.player,r.sprite,()=>this.handleCoinCollection(r),void 0,this),this.tweens.add({targets:r.sprite,scaleX:1.3,scaleY:1.3,duration:300,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<s.blueCoins&&!(a>=i.length);o++){const l=i[a++],r=new le(this,l.x,l.y);this.blueCoins.push(r),this.physics.add.overlap(this.player,r.sprite,()=>this.handleBlueCoinCollection(r),void 0,this),this.tweens.add({targets:r.sprite,scaleX:1.4,scaleY:1.4,duration:400,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<s.diamonds&&!(a>=i.length);o++){const l=i[a++],r=new re(this,l.x,l.y);this.diamonds.push(r),this.physics.add.overlap(this.player,r.sprite,()=>this.handleDiamondCollection(r),void 0,this),this.tweens.add({targets:r.sprite,scaleX:1.5,scaleY:1.5,duration:500,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<s.freeLifs&&!(a>=i.length);o++){const l=i[a++],r=new ne(this,l.x,l.y);this.freeLifes.push(r),this.physics.add.overlap(this.player,r.sprite,()=>this.handleFreeLifeCollection(r),void 0,this),this.tweens.add({targets:r.sprite,scaleX:1.5,scaleY:1.5,duration:500,ease:"Back.easeOut",yoyo:!0})}}playSoundEffect(e,t=.5){if(this.registry.get("sfxEnabled")!==!1)if(this.sound.context&&this.sound.context.state==="suspended")console.log("🔇 Audio context suspended, trying to resume for sound:",e),this.sound.context.resume().then(()=>{try{this.sound.play(e,{volume:t})}catch(i){console.warn("⚠️ Failed to play sound effect:",e,i)}}).catch(i=>{console.error("❌ Failed to resume audio context for sound:",e,i)});else try{this.sound.play(e,{volume:t})}catch(i){console.warn("⚠️ Failed to play sound effect:",e,i)}}update(e,t){if(this.isGameOver||!this.touchControls||!this.player||!this.player.body||!this.cats||!this.stalkerCats||!this.baseBlus||!this.beetles||!this.ladders)return;this.updateBackgroundPosition(),this.touchControls.update(),this.updateTreasureChestInteraction(),this.updateDoorPrompt(),this.player.update(e,t),this.updateCrystalBallProjectiles(e,t),this.playerGoldenAura&&this.invincibilityActive&&this.playerGoldenAura.setPosition(this.player.x,this.player.y),this.updateVisibilitySystem(),this.cats&&this.cats.children&&(this.cats.children.entries.forEach(r=>{r.update(this.time.now,this.game.loop.delta)}),this.checkAndReplaceStuckChompers()),this.stalkerCats&&this.stalkerCats.children&&this.stalkerCats.children.entries.forEach(r=>{r.update(this.time.now,this.game.loop.delta)}),this.baseBlus&&this.baseBlus.children&&this.baseBlus.children.entries.forEach(r=>{r.update(this.time.now,this.game.loop.delta)}),this.beetles&&this.beetles.children&&this.beetles.children.entries.forEach(r=>{r.update(e,t)}),this.rexEnemies&&this.rexEnemies.children&&this.rexEnemies.children.entries.forEach(r=>{r.update(e,t)});let s=!1;this.ladders&&this.ladders.children&&this.ladders.children.entries.forEach(r=>{this.physics.world.overlap(this.player,r)&&(s=!0)}),s||this.player.clearNearbyLadder(),this.player.getIsClimbing()&&!s&&this.player.exitClimbing();const i=p.game.tileSize,a=p.game.floorSpacing,o=Math.max(0,Math.floor((p.canvas.height-this.player.y-i/2)/a));o!==this.currentFloor&&(this.currentFloor=o,this.gameStats.highestFloor=Math.max(this.gameStats.highestFloor,o)),this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).isEndless&&this.currentFloor>=this.highestFloorGenerated-3&&this.generateNextFloors()}generateNextFloors(){const e=p.game.tileSize,t=p.game.floorWidth,s=p.game.floorSpacing,i=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());i.isEndless||i.floorCount;let a;i.isEndless?a=5:a=Math.min(5,Math.max(0,i.floorCount-1-this.highestFloorGenerated));for(let o=0;o<a;o++){const l=this.highestFloorGenerated+o+1,r=p.canvas.height-e/2-l*s,n=Math.random()>.3;let c;if(n){const y=Math.floor(Math.random()*(t-5))+2,f=Math.floor(Math.random()*2)+2;c={gapStart:y,gapSize:f};for(let m=0;m<t;m++)(m<y||m>=y+f)&&this.createPlatformTile(m*e+e/2,r);this.levelManager.isBonusLevel()||this.createSpikesInGap(y,f,r,e)}else{c={gapStart:-1,gapSize:0};for(let y=0;y<t;y++)this.createPlatformTile(y*e+e/2,r)}this.floorLayouts[l]=c;const h=!i.isEndless&&l>=i.floorCount-1;if(l>0&&this.floorLayouts[l-1]&&!h){const y=this.floorLayouts[l-1],f=[];for(let m=1;m<t-1;m++)this.hasPlatformAt(y,m)&&this.hasPlatformAt(c,m)&&f.push(m);if(f.length>0){const m=f[Math.floor(Math.random()*f.length)],S=-(l-1)*s+p.canvas.height-e,v=-l*s+p.canvas.height-e;this.createContinuousLadder(m*e,S,v),this.storeLadderPositions(l-1,[m])}}const d=r-e-8,u=[];for(let y=1;y<t-1;y++)this.hasPlatformAt(c,y)&&u.push(y);if(u.length>0){const y=i.collectibleTypes,f=[];if(y.includes("coin")&&l>0){const m=Math.floor(Math.random()*3)+2;this.placeCollectiblesOfType(u,m,"coin",d,l,f)}if(y.includes("blueCoin")&&l>0&&Math.random()<.2&&this.placeCollectiblesOfType(u,1,"blueCoin",d,l,f),y.includes("diamond")&&l>1&&Math.random()<.08&&this.placeCollectiblesOfType(u,1,"diamond",d,l,f),y.includes("treasureChest")&&l>=3){const m=this.levelManager.getCurrentLevel();this.shouldSpawnChestOnFloor(m,l)&&this.placeCollectiblesOfType(u,1,"treasureChest",d,l,f)}}const g=i.enemyTypes,b=[];if(g.includes("blue")&&b.push("blue"),g.includes("yellow")&&b.push("yellow"),g.includes("green")&&b.push("green"),g.includes("red")&&b.push("red"),b.length>0&&l>1&&Math.random()>.5){const y=b[Math.floor(Math.random()*b.length)];if(c.gapStart===-1){const m=r-e/2-15,S=new U(this,t/2*e,m,e*1.5,e*(t-1.5),y);this.cats.add(S),enemiesCreated++}else if(c.gapStart>3){const m=r-e/2-15,S=new U(this,c.gapStart/2*e,m,e*.5,e*(c.gapStart-.5),y);S.getCatColor()==="green"&&(S.platformBounds={left:e*.5,right:e*(c.gapStart-.5)}),this.cats.add(S),enemiesCreated++}}}this.highestFloorGenerated+=a}waitForAssetsAndStartIntro(e,t){const s=()=>{const i=this.registry.get("assetsReady"),a=this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot"),o=this.textures.exists("playerRunLeftFoot")&&this.textures.exists("playerRunRightFoot");i&&a&&o?this.startLevelIntro(e,t):this.time.delayedCall(100,s)};s()}startLevelIntro(e,t){this.isLevelStarting=!0;const s=p.game.tileSize,i=s/2,a=p.canvas.height-s/2,o=p.canvas.height-s,l=o;console.log("🎬 Level Intro Start:",{targetX:e,targetY:t,originalTargetY:t,canvasHeight:p.canvas.height,groundFloorY:o,platformTop:l,floorY:a,playerPhysicsHeight:30,playerShouldEndAt:l-15}),t=l-29,console.log("🎯 Adjusted Target:",{originalTargetY:arguments[1],adjustedTargetY:t,platformTop:l,willStandAt:t+15});const r=p.canvas.height+80,n=150,c=l-5,h=c+n/2,d=n,u=c;console.log("🎨 Intro Ladder Visual Alignment:",{visualTopEdge:h-d/2,visualBottomEdge:h+d/2,visualCenter:h,visualHeight:d,groundFloorY:l,shiftedUp:5}),console.log("🪜 Intro Ladder Setup:",{ladderTop:Math.round(u),ladderBottom:Math.round(r),visualHeight:Math.round(d),visualCenterY:Math.round(h),targetY:Math.round(t),platformTop:l,matchesGameplay:!0});let g;if(this.textures.exists("tealLadder"))g=this.add.image(i,h,"tealLadder"),g.setDisplaySize(g.width*(d/g.height),d),g.setDepth(5),console.log("🖼️ Ladder Sprite Positioned:",{x:i,y:h,displayHeight:d,topEdge:h-d/2});else{g=this.add.graphics();const y=h-d/2,f=h+d/2;g.fillStyle(4251856,1),g.fillRect(i-2,y,4,d),g.fillRect(i-13,y+4,26,4),g.fillRect(i-13,f-4,26,4);const m=Math.floor(d/32);for(let S=1;S<m;S++){const v=y+S*(d/(m+1));g.fillRect(i-13,v,26,3)}g.setDepth(5)}const b=p.canvas.height+60;this.player.x=i,this.player.y=b,this.player.body&&(this.player.body.enable=!1,console.log("⚠️ Physics disabled for intro animation")),console.log("🎭 Player Intro Position:",{playerStartY:b,ladderBottom:r,ladderTop:u,visualHeight:d,targetY:t,willClimbTo:t,physicsEnabled:this.player.body?.enable||!1}),this.textures.exists("playerClimbLeftFoot")?this.player.setTexture("playerClimbLeftFoot"):this.player.setTexture("playerIdleEye1"),this.player.setDisplaySize(48,64),this.animatePlayerClimbing(i,t,()=>{console.log("🎯 Starting bounce animation at Y:",Math.round(this.player.y)),this.animatePlayerBouncing(e,t,()=>{console.log("✅ Intro animation complete! Player at:",{x:Math.round(this.player.x),y:Math.round(this.player.y),targetY:Math.round(t),aboutToEnablePhysics:!0}),this.player.setPosition(e,t),this.player.body.reset(e,t),this.player.body.enable=!0,this.isLevelStarting=!1,console.log("⚡ Physics re-enabled! Player now at:",{x:Math.round(this.player.x),y:Math.round(this.player.y),bodyY:Math.round(this.player.body.y),bodyBottom:Math.round(this.player.body.bottom),bodyOffset:{x:this.player.body.offset.x,y:this.player.body.offset.y},velocity:this.player.body.velocity,gravity:this.physics.world.gravity,shouldBeStandingAt:l}),this.game.registry.set("levelProgression",!1),this.notifyFarcadeGameReady(),this.tweens.add({targets:g,alpha:0,duration:500,onComplete:()=>{g.destroy()}}),this.showStartBanner()})})}animatePlayerClimbing(e,t,s){console.log("🧗 Climbing Animation Start:",{currentY:Math.round(this.player.y),targetY:Math.round(t),distanceToClimb:Math.round(this.player.y-t)}),this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot")||console.warn("⚠️ Climb sprites not loaded! Using fallback animation");let a=0;const l=this.time.addEvent({delay:120,callback:()=>{this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot")&&(a%2===0?this.player.setTexture("playerClimbLeftFoot"):this.player.setTexture("playerClimbRightFoot"),this.player.setDisplaySize(48,64)),a++},loop:!0});this.tweens.add({targets:this.player,y:t,duration:2e3,ease:"Linear",onUpdate:r=>{},onComplete:()=>{l.destroy(),s()}})}animatePlayerBouncing(e,t,s){console.log("🏀 Bounce Animation Start:",{currentPos:{x:Math.round(this.player.x),y:Math.round(this.player.y)},targetPos:{x:Math.round(e),y:Math.round(t)}}),this.player.setFlipX(!1);const i=this.textures.exists("playerJumpRightFoot")?"playerJumpRightFoot":"playerIdleEye1";this.player.setTexture(i),this.tweens.add({targets:this.player,x:e,duration:800,ease:"Power2.easeOut",onComplete:()=>{this.changePlayerTexture("playerIdleEye1"),this.time.delayedCall(300,()=>{this.player.onBubbleTrigger&&this.player.onBubbleTrigger()}),s()}}),this.tweens.add({targets:this.player,y:t-25,duration:200,ease:"Power2.easeOut",yoyo:!0,repeat:1,onComplete:()=>{this.player.y=t}})}showStartBanner(){const e=this.levelManager.getCurrentLevel(),t=this.levelManager.getLevelConfig(e),s=e%10===9,i=this.levelManager.isBonusLevel(),a=i?"BONUS LEVEL!":t.isEndless?"ENDLESS MODE!":`LEVEL ${e}`,o=this.add.text(p.canvas.width/2,p.canvas.height/2-(s&&!i?120:100),a,{fontSize:"28px",color:i?"#00ff00":"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0);let l=null;s&&!t.isEndless&&!i&&(l=this.add.text(p.canvas.width/2,p.canvas.height/2-85,"DARK MODE!",{fontSize:"18px",color:"#9932cc",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0));const r=this.add.text(p.canvas.width/2,p.canvas.height/2-50,"GO!",{fontSize:"36px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0).setAlpha(0);this.time.delayedCall(500,()=>{this.tweens.add({targets:r,alpha:1,duration:300,yoyo:!0,hold:500,onComplete:()=>{o.destroy(),r.destroy(),l&&l.destroy()}})})}showEndlessModePopup(){const e=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,350,200,2894892,.95).setDepth(250).setScrollFactor(0),t=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,354,204,16777215).setDepth(249).setScrollFactor(0);t.setStrokeStyle(3,16777215),t.setFillStyle();const s=this.add.text(p.canvas.width/2,p.canvas.height/2-50,"ENDLESS MODE UNLOCKED!",{fontSize:"24px",color:"#ff44ff",fontFamily:"Arial Black",fontStyle:"bold",align:"center"}).setOrigin(.5).setDepth(251).setScrollFactor(0),i=this.add.text(p.canvas.width/2,p.canvas.height/2+10,`No more levels!
Climb as high as you can!
Difficulty has plateaued.`,{fontSize:"16px",color:"#ffffff",fontFamily:"Arial",align:"center"}).setOrigin(.5).setDepth(251).setScrollFactor(0);this.time.delayedCall(3e3,()=>{e.destroy(),t.destroy(),s.destroy(),i.destroy()})}createLevelEndDoor(){const e=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());if(!e.isEndless&&e.floorCount>0){const t=p.game.tileSize,s=p.game.floorSpacing,i=e.floorCount-1,a=p.canvas.height-t/2-i*s,o=this.findSafeDoorPosition(i),r=a-t/2-50,n=this.levelManager.getCurrentLevel()===1;this.door=new De(this,o,r,n),this.storeDoorPosition(i,Math.floor(o/t)),this.physics.add.overlap(this.player,this.door,this.handleDoorOverlap,void 0,this)}}findSafeDoorPosition(e){const t=p.game.tileSize,s=p.game.floorWidth,i=this.floorLayouts[e],a=3,o=this.ladderPositions.get(e)||[],l=[];for(let n=2;n<s-2-a;n++){let c=!0;for(let h=0;h<a;h++)if(!this.hasPlatformAt(i,n+h)){c=!1;break}if(c){for(const h of o)if(Math.abs(n-h)<4){c=!1;break}}c&&l.push(n)}let r;if(l.length>0){const n=Math.floor(s/2);r=l.reduce((c,h)=>Math.abs(h-n)<Math.abs(c-n)?h:c)}else r=Math.floor(s/2)-Math.floor(a/2);return(r+a/2)*t}storeDoorPosition(e,t){this.doorPositions||(this.doorPositions=new Map),this.doorPositions.set(e,t)}handleDoorOverlap(e,t){const s=t,i=e,o=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).floorCount-1,r=i.body.blocked.down;this.currentFloor===o&&r?(s.showPrompt(i),(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP).isDown||this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).isDown||this.touchControls?.upPressed)&&!this.isLevelComplete&&this.completeLevel()):s.hidePrompt()}completeLevel(){this.isLevelComplete||(this.isLevelComplete=!0,this.playSoundEffect("door-open",.5),this.player.body.enable=!1,this.showLevelCompleteScreen())}showLevelCompleteScreen(){const e=this.levelManager.getCurrentLevel();this.triggerFarcadeHapticFeedback(),this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.7).setDepth(299).setScrollFactor(0);const t=this.add.graphics();t.fillStyle(4854924,1),t.lineStyle(2,8069026,1),t.fillRoundedRect(p.canvas.width/2-175,p.canvas.height/2-140,350,280,12),t.strokeRoundedRect(p.canvas.width/2-175,p.canvas.height/2-140,350,280,12),t.setDepth(300).setScrollFactor(0),this.add.text(p.canvas.width/2,p.canvas.height/2-95,`LEVEL ${e}
COMPLETE!`,{fontSize:"22px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0),this.add.text(p.canvas.width/2,p.canvas.height/2-10,`Score: ${this.accumulatedScore+this.score}
Floors Climbed: ${this.currentFloor}`,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0);const s=this.levelManager.shouldHaveBonusAfter(e),i=this.levelManager.isBonusLevel();let a="";if(s&&!i)a="Next: BONUS LEVEL!";else if(i)a=`Next: Level ${e+1}`;else{const l=e+1;a=this.levelManager.getLevelConfig(l).isEndless?"Next: BEAST MODE!":`Next: Level ${l}`}this.add.text(p.canvas.width/2,p.canvas.height/2+50,a,{fontSize:"12px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0);const o=this.add.rectangle(p.canvas.width/2,p.canvas.height/2+100,150,40,2142890).setDepth(301).setScrollFactor(0);o.setInteractive({useHandCursor:!0}),o.setStrokeStyle(2,1608322),this.add.text(p.canvas.width/2,p.canvas.height/2+100,"CONTINUE",{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(302).setScrollFactor(0),o.on("pointerdown",()=>{this.playSoundEffect("continue-button",.5);const l=this.game.registry;l.set("levelProgression",!0);const r=this.accumulatedScore+this.score;l.set("accumulatedScore",r),l.set("totalCoins",this.totalCoinsCollected),l.set("totalGems",this.totalGemsCollected),l.set("totalBlueGems",this.totalBlueGemsCollected),l.set("totalDiamonds",this.totalDiamondsCollected),l.set("livesEarned",this.livesEarned),l.set("accumulatedCoins",this.totalCoinsCollected),l.set("accumulatedGems",this.totalGemsCollected),l.set("accumulatedBlueGems",this.totalBlueGemsCollected),l.set("accumulatedDiamonds",this.totalDiamondsCollected);const n=this.levelManager.isBonusLevel(),c=this.levelManager.getCurrentLevel();!n&&this.levelManager.shouldHaveBonusAfter(c);const h=this.levelManager.nextLevel(),d=this.levelManager.isBonusLevel();if(console.log(`📊 Level transition: ${c} -> ${h} (Bonus: ${d})`),console.log(`💚 Current lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`),l.set("currentLevel",h),this.backgroundManager.isChapterTransition(h,d)){const u=this.backgroundManager.getChapterForLevel(h,d);this.backgroundManager.loadChapterBackgrounds(u).then(()=>{const g=this.backgroundManager.getChapterForLevel(h-1,!1);this.backgroundManager.unloadChapterBackgrounds(g)})}h===51?this.showBeastModeNotification(()=>{l.set("isReplay",!0),this.scene.restart()}):n&&!d&&h>1?(console.log("📍 Transitioning from bonus to chapter, showing splash for level",h),l.set("showChapterSplash",!0),l.set("chapterSplashLevel",h),l.set("isReplay",!0),this.scene.restart()):(l.set("isReplay",!0),this.scene.restart())})}showChapterTransition(e,t){const s=this.backgroundManager.getChapterName(e),i=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.7).setDepth(299).setScrollFactor(0),a=this.add.graphics();a.fillStyle(4854924,1),a.lineStyle(2,8069026,1),a.fillRoundedRect(p.canvas.width/2-150,p.canvas.height/2-60,300,120,12),a.strokeRoundedRect(p.canvas.width/2-150,p.canvas.height/2-60,300,120,12),a.setDepth(300).setScrollFactor(0);const o=this.add.text(p.canvas.width/2,p.canvas.height/2-20,"ENTERING",{fontSize:"14px",color:"#FFD700",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(301).setScrollFactor(0),l=this.add.text(p.canvas.width/2,p.canvas.height/2+10,s.toUpperCase(),{fontSize:"16px",color:"#9ACF07",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(301).setScrollFactor(0);i.setAlpha(0),a.setAlpha(0),o.setAlpha(0),l.setAlpha(0),this.tweens.add({targets:[i,a,o,l],alpha:1,duration:500,onComplete:()=>{this.time.delayedCall(1500,()=>{this.tweens.add({targets:[i,a,o,l],alpha:0,duration:500,onComplete:()=>{i.destroy(),a.destroy(),o.destroy(),l.destroy(),t()}})})}})}showBeastModeNotification(e){const t=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.8).setDepth(299).setScrollFactor(0),s=this.add.graphics();s.fillStyle(4854924,1),s.lineStyle(2,8069026,1),s.fillRoundedRect(p.canvas.width/2-200,p.canvas.height/2-100,400,200,12),s.strokeRoundedRect(p.canvas.width/2-200,p.canvas.height/2-100,400,200,12),s.setDepth(300).setScrollFactor(0);const i=this.add.text(p.canvas.width/2,p.canvas.height/2-40,"BEAST MODE",{fontSize:"24px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(301).setScrollFactor(0),a=this.add.text(p.canvas.width/2,p.canvas.height/2,"ACTIVATED",{fontSize:"16px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(301).setScrollFactor(0),o=this.add.text(p.canvas.width/2,p.canvas.height/2+30,"Infinite floors at maximum difficulty!",{fontSize:"10px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0);this.triggerFarcadeHapticFeedback(),this.tweens.add({targets:i,scaleX:1.1,scaleY:1.1,duration:500,yoyo:!0,repeat:-1,ease:"Power2"}),this.time.delayedCall(3e3,()=>{t.destroy(),s.destroy(),i.destroy(),a.destroy(),o.destroy(),e()})}updateCoinCounterDisplay(){const e=this.totalCoinsCollected%this.COINS_PER_EXTRA_LIFE;this.coinCounterText.setText(`${e}/${this.COINS_PER_EXTRA_LIFE}`)}updateLivesDisplay(){const e=this.lives,t=e>0?`x${e}`:"GAME OVER";this.livesText.setText(t),this.livesIcon&&this.livesIcon.setVisible(e>0)}showBeastModeLoadingIndicator(){this.beastModeLoadingText=this.add.text(this.cameras.main.width/2,100,"BEAST MODE: LOADING CHAOS... 0%",{fontSize:"16px",color:"#ff00ff",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:3}),this.beastModeLoadingText.setOrigin(.5),this.beastModeLoadingText.setScrollFactor(0),this.beastModeLoadingText.setDepth(200),this.beastModeLoadingTimer=this.time.addEvent({delay:500,repeat:-1,callback:()=>{if(this.backgroundManager&&this.beastModeLoadingText){const e=this.backgroundManager.getBeastModeLoadingProgress();this.backgroundManager.isBeastModeFullyLoaded()?(this.beastModeLoadingText.setText("BEAST MODE: FULLY LOADED!"),this.beastModeLoadingText.setColor("#00ff00"),this.time.delayedCall(2e3,()=>{this.beastModeLoadingText&&(this.beastModeLoadingText.destroy(),this.beastModeLoadingText=void 0),this.beastModeLoadingTimer&&(this.beastModeLoadingTimer.destroy(),this.beastModeLoadingTimer=void 0)})):this.beastModeLoadingText.setText(`BEAST MODE: LOADING CHAOS... ${e.percentage}%`)}}})}checkForExtraLife(){const e=Math.floor(this.totalCoinsCollected/this.COINS_PER_EXTRA_LIFE);if(e>this.livesEarned){const t=e-this.livesEarned;console.log(`💎 Checking extra lives: ${t} new lives to award (${this.totalCoinsCollected} gems / ${this.COINS_PER_EXTRA_LIFE})`);for(let s=0;s<t;s++)if(this.lives<this.MAX_LIVES){const i=this.lives;this.lives++,this.livesEarned++,this.game.registry.set("playerLives",this.lives),this.game.registry.set("livesEarned",this.livesEarned),this.updateLivesDisplay(),console.log(`💚 Extra life earned from gems! Lives: ${i} -> ${this.lives}`),this.playSoundEffect("heart-collect",.5),this.showExtraLifePopup("150 Gems!")}else this.livesEarned++,this.game.registry.set("livesEarned",this.livesEarned),console.log(`💛 Extra life earned but at max (${this.MAX_LIVES})`)}}showExtraLifePopup(e=""){const t=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-50,"EXTRA LIFE!",{fontSize:"20px",color:"#00ff00",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:0,stroke:!1,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0);let s=null;e&&(s=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-20,e,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:0,stroke:!1,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0));const i=s?[t,s]:[t];this.tweens.add({targets:i,y:"-=30",alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{t.destroy(),s&&s.destroy()}})}showLostLifePopup(){this.physics.pause(),this.touchControls.disable(),this.input.keyboard.enabled=!1,this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.7).setDepth(199).setScrollFactor(0);const e=280,t=180,s=this.cameras.main.width/2,i=this.cameras.main.height/2,a=this.add.graphics();a.fillStyle(4854924,1),a.lineStyle(2,8069026,1),a.fillRoundedRect(s-e/2,i-t/2,e,t,12),a.strokeRoundedRect(s-e/2,i-t/2,e,t,12),a.setDepth(200).setScrollFactor(0),this.add.text(s,i-45,"LIFE LOST!",{fontSize:"22px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,i-10,`Lives Remaining: ${this.lives}`,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0);const o=this.add.rectangle(s,i+40,140,35,2142890).setDepth(201).setScrollFactor(0);o.setInteractive({useHandCursor:!0}),o.setStrokeStyle(2,1608322),this.add.text(s,i+40,"CONTINUE",{fontSize:"12px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(202).setScrollFactor(0),o.on("pointerdown",()=>{this.playSoundEffect("continue-button",.5),this.game.registry.set("isDeathRetry",!0),this.scene.restart()}),o.on("pointerover",()=>{o.setFillStyle(6750054)}),o.on("pointerout",()=>{o.setFillStyle(4521796)})}showGameOverScreen(){this.playSoundEffect("game-over",.5),this.physics.pause(),this.touchControls.disable(),this.input.keyboard.enabled=!1,this.accumulatedScore+this.score,this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.7).setDepth(199).setScrollFactor(0);const e=380,t=470,s=this.cameras.main.width/2,i=this.cameras.main.height/2,a=this.add.graphics();a.fillStyle(4854924,1),a.lineStyle(2,8069026,1),a.fillRoundedRect(s-e/2,i-t/2,e,t,12),a.strokeRoundedRect(s-e/2,i-t/2,e,t,12),a.setDepth(200).setScrollFactor(0),this.add.text(s,i-190,"GAME OVER!",{fontSize:"24px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,i-155,`Score: ${this.accumulatedScore+this.score}`,{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,i-125,"📊 PERFORMANCE STATS",{fontSize:"12px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,i-100,`Floors Climbed: ${this.gameStats.highestFloor}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,i-80,`Level Reached: ${this.levelManager.getCurrentLevel()}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,i-60,`Gems Collected: ${this.totalGemsCollected+this.totalBlueGemsCollected+this.totalDiamondsCollected}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,i-40,`Treasure Chests: ${this.gameStats.treasureChestsOpened}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,i-10,"⚔️ ENEMIES DEFEATED",{fontSize:"12px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0);let o=i+15;this.add.text(s,o,`Caterpillar: ${this.gameStats.enemyKills.caterpillar}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,o+18,`Rollz: ${this.gameStats.enemyKills.rollz}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,o+36,`Chomper: ${this.gameStats.enemyKills.chomper}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,o+54,`Snail: ${this.gameStats.enemyKills.snail}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,o+72,`Bouncer: ${this.gameStats.enemyKills.bouncer}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,o+90,`Stalker: ${this.gameStats.enemyKills.stalker}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,o+108,`Rex: ${this.gameStats.enemyKills.rex}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,o+126,`Blu: ${this.gameStats.enemyKills.blu}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),this.add.text(s,o+148,`Total Enemies: ${this.gameStats.totalEnemiesDefeated}`,{fontSize:"11px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0);const l=this.add.rectangle(s,i+195,150,40,2142890).setDepth(201).setScrollFactor(0);l.setInteractive({useHandCursor:!0}),l.setStrokeStyle(2,1608322);const r=this.add.text(s,i+195,"CONTINUE",{fontSize:"14px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(202).setScrollFactor(0);l.on("pointerdown",()=>{console.log("🔄 Continue button clicked!");const n=p.buildType==="dgen1";console.log("🎮 Build type check:",{buildType:p.buildType,isDgen1:n}),console.log("🚀 Restarting game for dgen1 build..."),this.restartGame()}),l.on("pointerover",()=>{l.setFillStyle(2475971),r.setScale(1.1)}),l.on("pointerout",()=>{l.setFillStyle(2142890),r.setScale(1)}),this.input.keyboard.on("keydown-R",()=>{this.restartGame()})}changePlayerTexture(e){this.textures.exists(e)&&(this.player.setTexture(e),this.player.setDisplaySize(48,64))}initializeBubbleSystem(){this.createPlaceholderBubbles(),this.player.setBubbleTriggerCallback(()=>{this.showRandomBubble()}),this.player.setMovementStartCallback(()=>{this.hideBubble()})}createDebugGrid(){this.children.list.forEach(r=>{r.getData&&r.getData("debugGrid")&&r.destroy()});const e=this.add.graphics();e.setDepth(200),e.setScrollFactor(1),e.setData("debugGrid",!0);const t=this.player.x,s=this.player.y,i=20,a=200;e.lineStyle(1,16711680,.5);for(let r=t-a;r<=t+a;r+=i)e.lineBetween(r,s-a,r,s+a);for(let r=s-a;r<=s+a;r+=i)e.lineBetween(t-a,r,t+a,r);e.lineStyle(2,65280,.8),e.lineBetween(t,s-a,t,s+a),e.lineBetween(t-a,s,t+a,s);const o=40;for(let r=t-a;r<=t+a;r+=o)for(let n=s-a;n<=s+a;n+=o){const c=r-t,h=n-s;this.add.text(r,n,`${c},${h}`,{fontSize:"8px",color:"#ffffff",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:1,y:1}}).setOrigin(.5).setDepth(201).setScrollFactor(1).setData("debugGrid",!0)}const l=this.add.circle(t,s,3,16711680);l.setDepth(202).setScrollFactor(1),l.setData("debugGrid",!0),this.time.delayedCall(1e4,()=>{this.children.list.forEach(r=>{r.getData&&r.getData("debugGrid")&&r.destroy()})})}createPlaceholderBubbles(){}showRandomBubble(){this.speechBubble||this.thoughtBubble||this.showSpeechBubble()}showSpeechBubble(){const e=this.add.image(0,0,"talking-bubble");e.setDepth(150),e.setScrollFactor(1),e.x=this.player.x+20+e.width*.5,e.y=this.player.y+20-e.height*.5,this.speechBubble=e,this.player.notifyBubbleActive(!0),this.bubbleTimer=this.time.delayedCall(this.BUBBLE_DISPLAY_TIME,()=>{this.hideBubble()})}showThoughtBubble(){const e=this.add.image(0,0,"thoughtBubblePlaceholder");e.setDepth(150),e.setScrollFactor(1);const t=-105*(Math.PI/180),s=45,i=(Math.random()-.5)*8,a=(Math.random()-.5)*8;e.x=this.player.x+Math.cos(t)*s+i,e.y=this.player.y+Math.sin(t)*s+a,this.thoughtBubble=e,this.player.notifyBubbleActive(!0),this.bubbleTimer=this.time.delayedCall(this.BUBBLE_DISPLAY_TIME,()=>{this.hideBubble()})}hideBubble(){this.speechBubble&&(this.speechBubble.destroy(),this.speechBubble=null),this.thoughtBubble&&(this.thoughtBubble.destroy(),this.thoughtBubble=null),this.bubbleTimer&&(this.bubbleTimer.destroy(),this.bubbleTimer=null),this.player.notifyBubbleActive(!1)}updateBackgroundPosition(){if(!this.backgroundSprite)return;const t=this.cameras.main.scrollY*.05;let s=this.backgroundInitialY-t;const i=p.canvas.height,a=this.backgroundHeight,o=0,l=i-a;a>i?(s=Math.min(o,s),s=Math.max(l,s)):s=o,this.backgroundSprite.setY(s)}getEnemyTypeName(e){if(e.constructor.name==="Cat"){const t=e.getCatColor?e.getCatColor():e.catColor||e.color||e.getData?.("color"),s=e.getIsStalker?e.getIsStalker():e.isStalker||e.getData?.("isStalker");switch(console.log(`🎯 Enemy type detection - Color: ${t}, Stalker: ${s}`),t){case"yellow":return"caterpillar";case"blue_caterpillar":return"caterpillar";case"blue":return"chomper";case"purple":return"chomper";case"red":return s?"stalker":"snail";case"green":return"bouncer";default:return console.warn("❌ Unknown enemy color:",t),"unknown"}}else{if(e.constructor.name==="Beetle")return"rollz";if(e.constructor.name==="Rex")return"rex";if(e.constructor.name==="BaseBlu")return"blu"}return"unknown"}notifyFarcadeGameReady(){try{typeof window<"u"&&window.FarcadeSDK&&window.FarcadeSDK.singlePlayer.actions.ready()}catch{}}notifyFarcadeGameOver(e){try{typeof window<"u"&&window.FarcadeSDK&&window.FarcadeSDK.singlePlayer.actions.gameOver({score:e})}catch{}}triggerFarcadeHapticFeedback(){try{typeof window<"u"&&window.FarcadeSDK&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}catch{}}setupFarcadeEventHandlers(){try{if(typeof window<"u"&&window.FarcadeSDK){const e=window.FarcadeSDK;e.singlePlayer.events.on("play_again",()=>{this.restartGame()}),e.singlePlayer.events.on("toggle_mute",()=>{})}}catch{}}restartGame(){this.game.registry.set("isDeathRetry",!1),this.game.registry.set("isLevelProgression",!1),this.game.registry.set("currentLevel",1),this.game.registry.set("playerLives",3),this.game.registry.set("totalCoins",0),this.game.registry.set("livesEarned",0),this.game.registry.set("accumulatedScore",0),this.scene.restart()}checkAndReplaceStuckChompers(){this.cats&&this.cats.children.entries.forEach(e=>{if(e instanceof U){const t=e,s=t.getData("stuckRecoveryCount")||0;if(t.getCatColor()===ce.BLUE&&s>=3){console.warn("Replacing chronically stuck Chomper with Snail at position",t.x,t.y);const i=t.x,a=t.y,o=t.platformBounds;t.destroy();const l=new U(this,i,a,o.left,o.right,ce.RED,!1);this.cats.add(l),console.log("Successfully replaced stuck Chomper with Snail")}}})}shutdown(){this.backgroundSprite=null,this.backgroundInitialY=0,this.backgroundHeight=0}}class Te{ready(){typeof window<"u"&&window.Farcade&&window.Farcade.gameReady()}gameOver(e){typeof window<"u"&&window.Farcade&&window.Farcade.gameOver(e)}haptic(e){typeof window<"u"&&window.Farcade&&window.Farcade.haptic(e)}mute(){typeof window<"u"&&window.Farcade&&window.Farcade.mute()}unmute(){typeof window<"u"&&window.Farcade&&window.Farcade.unmute()}async saveScore(e){this.gameOver(e)}async getHighScore(){return 0}async connectWallet(){return console.log("Wallet connection not available on Remix platform"),null}}class Ce{web3Manager=null;walletAddress=null;walletConnected=!1;constructor(){this.initializeWeb3()}async initializeWeb3(){try{const{getWeb3Manager:e}=await xe(async()=>{const{getWeb3Manager:s}=await import("./Web3Utils-B9S0Ym5F.js").then(i=>i.aJ);return{getWeb3Manager:s}},[]),t="eeb2e2fdeb3d0163fd4f3a84733c3fcf";this.web3Manager=e(t),await this.web3Manager.initialize(),this.web3Manager.isConnected()&&(this.walletAddress=this.web3Manager.getAddress(),this.walletConnected=!0,console.log("✅ Wallet already connected:",this.walletAddress)),this.hideWalletButton()}catch{console.log("Web3 initialization optional - game continues normally")}}ready(){console.log("🎮 Game ready on dgen1 platform"),localStorage.getItem("bz_audioMuted")==="true"&&window.game&&(window.game.sound.mute=!0)}gameOver(e){console.log(`🎯 Game Over - Score: ${e}`),this.saveToLocalStorage(e),this.walletConnected&&console.log(`💰 Would save score ${e} for wallet ${this.walletAddress}`)}haptic(e){if("vibrate"in navigator){const t=e==="heavy"?100:50;navigator.vibrate(t)}}mute(){window.game&&(window.game.sound.mute=!0),localStorage.setItem("bz_audioMuted","true")}unmute(){window.game&&(window.game.sound.mute=!1),localStorage.setItem("bz_audioMuted","false")}async saveScore(e){const t=JSON.parse(localStorage.getItem("bz_scores")||"[]");t.push({score:e,date:Date.now(),wallet:this.walletAddress||"anonymous"}),t.sort((s,i)=>i.score-s.score),t.splice(10),localStorage.setItem("bz_scores",JSON.stringify(t)),localStorage.setItem("bz_highScore",t[0]?.score.toString()||"0")}async getHighScore(){const e=localStorage.getItem("bz_highScore");return e?parseInt(e):0}async saveGameState(e){const t={...e,timestamp:Date.now()};localStorage.setItem("bz_saveState",JSON.stringify(t))}async loadGameState(){const e=localStorage.getItem("bz_saveState");if(!e)return null;const t=JSON.parse(e);return Date.now()-t.timestamp>1440*60*1e3?(localStorage.removeItem("bz_saveState"),null):t}saveToLocalStorage(e){this.saveScore(e);const t=JSON.parse(localStorage.getItem("bz_stats")||"{}");t.gamesPlayed=(t.gamesPlayed||0)+1,t.totalScore=(t.totalScore||0)+e,t.bestScore=Math.max(t.bestScore||0,e),t.lastPlayed=Date.now(),localStorage.setItem("bz_stats",JSON.stringify(t))}async connectWallet(){if(this.web3Manager||await this.initializeWeb3(),this.web3Manager){const e=await this.web3Manager.connect();if(e)return this.walletAddress=e,this.walletConnected=!0,e}return null}async disconnectWallet(){this.web3Manager&&(await this.web3Manager.disconnect(),this.walletAddress=null,this.walletConnected=!1)}showWalletButton(){this.web3Manager&&this.web3Manager.showWalletButton&&this.web3Manager.showWalletButton()}hideWalletButton(){this.web3Manager&&this.web3Manager.hideWalletButton&&this.web3Manager.hideWalletButton()}async showWalletAccount(){this.web3Manager&&this.walletConnected&&await this.web3Manager.showAccount()}}function ke(){return window.location.hostname.includes("dgen1")||window.location.search.includes("dgen1=true")||window.location.port==="3001"||window.game&&window.game.registry?.get("isDgen1")||window.innerWidth===720&&window.innerHeight===720?(console.log("🎮 Detected dgen1 platform (port:",window.location.port,", registry:",window.game?.registry?.get("isDgen1"),")"),new Ce):(console.log("🎮 Using Remix/Farcade platform (port:",window.location.port,")"),new Te)}const qe=Object.freeze(Object.defineProperty({__proto__:null,Dgen1Platform:Ce,RemixPlatform:Te,detectPlatform:ke},Symbol.toStringTag,{value:"Module"})),ee=document.getElementById("gameCanvas"),ze=[Me,Pe,Be,Ge],te={type:Phaser.WEBGL,width:J.canvas.width,height:J.canvas.height,scale:{mode:Phaser.Scale.NONE,parent:"gameContainer",autoCenter:Phaser.Scale.CENTER_BOTH,width:720,height:720,resolution:1},canvas:ee,backgroundColor:"#2e2348",scene:ze,physics:{default:"arcade",arcade:{gravity:{y:J.game.gravity},debug:!1}},audio:{disableWebAudio:!1,noAudio:!1},fps:{target:60},pixelArt:!0,antialias:!1,render:{pixelArt:!0,roundPixels:!0}},q=new Phaser.Game(te)(window).game=q,Y=ke();q.registry.set("platform",Y);q.registry.set("isDgen1",!0)(window).platform=Y;q.registry.set("isReplay",!1);const _=document.getElementById("gameCanvas"),Q=document.getElementById("gameContainer");console.log("🎮 dgen1 Version Initialized",{canvas:`${J.canvas.width}x${J.canvas.height}`,viewport:`${window.innerWidth}x${window.innerHeight}`,platform:"dgen1",platformObject:Y,wallet:typeof window.ethereum<"u"?"available":"not found"});console.log("📐 Canvas & Container Metrics:",{canvasElement:{width:_?.width,height:_?.height,clientWidth:_?.clientWidth,clientHeight:_?.clientHeight,offsetWidth:_?.offsetWidth,offsetHeight:_?.offsetHeight,style:{width:_?.style.width,height:_?.style.height}},container:{clientWidth:Q?.clientWidth,clientHeight:Q?.clientHeight,offsetWidth:Q?.offsetWidth,offsetHeight:Q?.offsetHeight},devicePixelRatio:window.devicePixelRatio,phaserConfig:{width:te.width,height:te.height,resolution:te.scale?.resolution}})(window).gamePlatform=Y;console.log("🌐 Platform stored globally as window.gamePlatform");q.events.once("ready",()=>{Y.ready(),console.log("🎮 DGEN1 TEST MODE READY!"),console.log("📱 Touch controls enabled for desktop - you can click the on-screen buttons!"),console.log("🎯 Click the D-pad (left bottom) to move"),console.log("🦘 Click the Jump button (right bottom) to jump"),console.log("⌨️ Keyboard also works: Arrow keys + Space/Up to jump"),Y.loadGameState&&Y.loadGameState().then(t=>{t&&(console.log("💾 Found saved game state:",t),q.registry.set("savedState",t))}),Y.getHighScore().then(t=>{t>0&&(console.log("🏆 High score:",t),q.registry.set("highScore",t))});let C=!1;const e=()=>{q.sound.context&&(q.sound.context.state==="suspended"?q.sound.context.resume().then(()=>{console.log("🔊 Audio context resumed"),C=!0}).catch(t=>{console.warn("� Could not resume audio:",t)}):q.sound.context.state==="running"&&(C||(console.log("🔊 Audio context ready"),C=!0)))};ee.addEventListener("click",e,{passive:!0}),ee.addEventListener("touchstart",e,{passive:!1}),ee.addEventListener("touchend",e,{passive:!1}),document.addEventListener("keydown",e,{passive:!0}),document.addEventListener("visibilitychange",()=>{document.hidden||e()}),setInterval(()=>{const t=q.scene.getScenes(!0)[0];if(t&&t.scene.key==="GameScene"){const s=t;if(s.player&&!s.isGameOver){const i={level:s.levelManager?.getCurrentLevel()||1,score:s.score||0,lives:s.lives||3,gems:s.totalCoinsCollected||0};Y.saveGameState&&(Y.saveGameState(i),console.log("💾 Auto-saved game state"))}}},J.platform.saveInterval)});window.addEventListener("beforeunload",()=>{const C=q.scene.getScenes(!0)[0];if(C&&C.scene.key==="GameScene"){const e=C;if(e.player&&!e.isGameOver){const t={level:e.levelManager?.getCurrentLevel()||1,score:e.score||0,lives:e.lives||3,gems:e.totalCoinsCollected||0};Y.saveGameState&&(Y.saveGameState(t),console.log("💾 Saved game state on exit"))}}});export{xe as _};
